<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <!-- RD version: 0.42.0  -->
    <!--  filepage  -->
  <meta charset="utf-8">
          
  <!-- Use the .htaccess and remove these lines to avoid edge case issues.
       More info: h5bp.com/b/378 -->
  <!-- meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" -->


	<title>File: configure.ac [Ruby 2.7.1]</title>
  <link rel="stylesheet" href="./css/associated.css" type="text/css" >
  <link rel="stylesheet" href="./css/inuit.css" >
  <link rel="stylesheet" href="./css/grid.inuit.css" >
  <link rel="stylesheet" href="./css/2011.css" type="text/css" >
  <link rel="stylesheet" href="./css/rdoc.css" type="text/css" >
    <link rel="stylesheet" href="./css/carbon17.css" type="text/css" >

  <!-- rel_prefix  = '' -->
    
    <!-- WHY? -->
    
    
  <!-- rel_prefix = '.'   asset_rel_prefix = '.'  --> 
  <link rel="stylesheet" href="css/extra.css" type="text/css" >
  <script  src="/js/extra.js"  ></script>


</head>

<body class="file">
<div id='actionbar' >
<div class='wrapper'>
<ul class='grids g0'></ul></div>



</div> <!-- end action bar -->
<!-- VERSION HEADER for 2.7.1 NOT FOUND -->          <div class='wrapper'>
<!-- carbon17 added here 2017-09-09 -->
 

  <div id="metadata">
    <div id="home-metadata">
      <header>
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
      </header>
		</div>

		<div id="project-metadata">
			
			
			<div id="fileindex-section" class="section project-section">
				<h3 class="section-header">Files</h3>
				<ul>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./_lib/racc/rdoc/grammar_en_rdoc.html">grammar.en.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./_test/rdoc/test_ja_rdoc.html">test.ja.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./COPYING_ja.html">COPYING.ja</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./README_EXT.html">README.EXT</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./README_EXT_ja.html">README.EXT.ja</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./configure_ac.html">configure.ac</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/bug_triaging_rdoc.html">bug_triaging.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/contributing_rdoc.html">contributing.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/contributors_rdoc.html">contributors.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/dtrace_probes_rdoc.html">dtrace_probes.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/extension_ja_rdoc.html">extension.ja.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/extension_rdoc.html">extension.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/globals_rdoc.html">globals.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/keywords_rdoc.html">keywords.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/maintainers_rdoc.html">maintainers.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/marshal_rdoc.html">marshal.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/regexp_rdoc.html">regexp.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/security_rdoc.html">security.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/signals_rdoc.html">signals.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/standard_library_rdoc.html">standard_library.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax_rdoc.html">syntax.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/assignment_rdoc.html">assignment.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/calling_methods_rdoc.html">calling_methods.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/comments_rdoc.html">comments.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/control_expressions_rdoc.html">control_expressions.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/exceptions_rdoc.html">exceptions.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/literals_rdoc.html">literals.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/methods_rdoc.html">methods.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/miscellaneous_rdoc.html">miscellaneous.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/modules_and_classes_rdoc.html">modules_and_classes.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/precedence_rdoc.html">precedence.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./doc/syntax/refinements_rdoc.html">refinements.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./lex_c_blt.html">lex.c.blt</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./sample/drb/README_ja_rdoc.html">README.ja.rdoc</a></li>
				
        <!-- local_rel_prefix -->
					<li class="file"><a href="./sample/drb/README_rdoc.html">README.rdoc</a></li>
				
				</ul>
			</div>
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="./images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" ></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value="" class="quicksearch-field" >
				</fieldset>
				</form>

				<ul class="link-list">
				
        <!--  local_rel_prefix -->
					<li><a href="./ARGF.html">ARGF</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./ArgumentError.html">ArgumentError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Array.html">Array</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./BasicObject.html">BasicObject</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Binding.html">Binding</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Class.html">Class</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./ClosedQueueError.html">ClosedQueueError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Comparable.html">Comparable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Complex.html">Complex</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./ConditionVariable.html">ConditionVariable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Continuation.html">Continuation</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Data.html">Data</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Dir.html">Dir</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./ENV.html">ENV</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./EOFError.html">EOFError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Encoding.html">Encoding</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Encoding/CompatibilityError.html">Encoding::CompatibilityError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Encoding/Converter.html">Encoding::Converter</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Encoding/ConverterNotFoundError.html">Encoding::ConverterNotFoundError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Encoding/InvalidByteSequenceError.html">Encoding::InvalidByteSequenceError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Encoding/UndefinedConversionError.html">Encoding::UndefinedConversionError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./EncodingError.html">EncodingError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Enumerable.html">Enumerable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Enumerator.html">Enumerator</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Enumerator/ArithmeticSequence.html">Enumerator::ArithmeticSequence</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Enumerator/Chain.html">Enumerator::Chain</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Enumerator/Generator.html">Enumerator::Generator</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Enumerator/Lazy.html">Enumerator::Lazy</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Enumerator/Producer.html">Enumerator::Producer</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Enumerator/Yielder.html">Enumerator::Yielder</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Errno.html">Errno</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Exception.html">Exception</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./FalseClass.html">FalseClass</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Fiber.html">Fiber</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./FiberError.html">FiberError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./File.html">File</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./File/Constants.html">File::Constants</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./File/Stat.html">File::Stat</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./FileTest.html">FileTest</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Float.html">Float</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./FloatDomainError.html">FloatDomainError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./FrozenError.html">FrozenError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./GC.html">GC</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./GC/Profiler.html">GC::Profiler</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Hash.html">Hash</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IO.html">IO</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IO/EAGAINWaitReadable.html">IO::EAGAINWaitReadable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IO/EAGAINWaitWritable.html">IO::EAGAINWaitWritable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IO/EINPROGRESSWaitReadable.html">IO::EINPROGRESSWaitReadable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IO/EINPROGRESSWaitWritable.html">IO::EINPROGRESSWaitWritable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IO/EWOULDBLOCKWaitReadable.html">IO::EWOULDBLOCKWaitReadable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IO/EWOULDBLOCKWaitWritable.html">IO::EWOULDBLOCKWaitWritable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IO/WaitReadable.html">IO::WaitReadable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IO/WaitWritable.html">IO::WaitWritable</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IOError.html">IOError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./IndexError.html">IndexError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Integer.html">Integer</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Interrupt.html">Interrupt</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Kernel.html">Kernel</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./KeyError.html">KeyError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./LoadError.html">LoadError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./LocalJumpError.html">LocalJumpError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Marshal.html">Marshal</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./MatchData.html">MatchData</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Math.html">Math</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Math/DomainError.html">Math::DomainError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Method.html">Method</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Module.html">Module</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Mutex.html">Mutex</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./NameError.html">NameError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./NilClass.html">NilClass</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./NoMatchingPatternError.html">NoMatchingPatternError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./NoMemoryError.html">NoMemoryError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./NoMethodError.html">NoMethodError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./NotImplementedError.html">NotImplementedError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Numeric.html">Numeric</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Object.html">Object</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./ObjectSpace.html">ObjectSpace</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./ObjectSpace/WeakMap.html">ObjectSpace::WeakMap</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Pool.html">Pool</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Proc.html">Proc</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Process.html">Process</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Process/GID.html">Process::GID</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Process/Status.html">Process::Status</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Process/Sys.html">Process::Sys</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Process/UID.html">Process::UID</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Queue.html">Queue</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Random.html">Random</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Random/Formatter.html">Random::Formatter</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Range.html">Range</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./RangeError.html">RangeError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Rational.html">Rational</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Regexp.html">Regexp</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./RegexpError.html">RegexpError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Ripper.html">Ripper</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./RubyVM.html">RubyVM</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./RubyVM/AbstractSyntaxTree.html">RubyVM::AbstractSyntaxTree</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./RubyVM/AbstractSyntaxTree/Node.html">RubyVM::AbstractSyntaxTree::Node</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./RubyVM/InstructionSequence.html">RubyVM::InstructionSequence</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./RubyVM/MJIT.html">RubyVM::MJIT</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./RuntimeError.html">RuntimeError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./ScriptError.html">ScriptError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./SecurityError.html">SecurityError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Signal.html">Signal</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./SignalException.html">SignalException</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./SizedQueue.html">SizedQueue</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./StandardError.html">StandardError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./StopIteration.html">StopIteration</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./String.html">String</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Struct.html">Struct</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Symbol.html">Symbol</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./SyntaxError.html">SyntaxError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./SystemCallError.html">SystemCallError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./SystemExit.html">SystemExit</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./SystemStackError.html">SystemStackError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Thread.html">Thread</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Thread/Backtrace/Location.html">Thread::Backtrace::Location</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./ThreadError.html">ThreadError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./ThreadGroup.html">ThreadGroup</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Time.html">Time</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./TracePoint.html">TracePoint</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./TrueClass.html">TrueClass</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./TypeError.html">TypeError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./UnboundMethod.html">UnboundMethod</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./UncaughtThrowError.html">UncaughtThrowError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./UnicodeNormalize.html">UnicodeNormalize</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./Warning.html">Warning</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./ZeroDivisionError.html">ZeroDivisionError</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./fatal.html">fatal</a></li>
				
        <!--  local_rel_prefix -->
					<li><a href="./unknown.html">unknown</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>
  <div class='adzbox'  id="azk83167">
      
  </div> 
	<div id="documentation">
		
<p>dnl <a href="Process.html">Process</a> this file with autoconf to produce a
configure script. AC_INIT() { AC_CONFIG_AUX_DIR(tool)
AC_CONFIG_MACRO_DIRS(tool/m4)</p>

<p>AC_PREREQ(2.67)</p>

<p>dnl   override AC_CHECKING dnl   placed here due to aclocal(1)&#39;s dnl  
ignoring this definition in separate files <a
href="AC_CHECKING">AC_DEFUN(</a>,[dnl <a
href="_COLORIZE_RESULT_PREPARE">AC_REQUIRE(</a>)dnl AS_MESSAGE([checking
${msg_checking}$1${msg_reset}…])])dnl</p>

<p>AC_DISABLE_OPTION_CHECKING</p>

<p><a href="cflags">AC_ARG_VAR(</a>, [additional CFLAGS (ignored when CFLAGS
is given)]) <a href="cppflags">AC_ARG_VAR(</a>, [additional CPPFLAGS
(ignored when CPPFLAGS is given)]) <a href="cxxflags">AC_ARG_VAR(</a>,
[additional CXXFLAGS (ignored when CXXFLAGS is given)])</p>

<p>: “environment section” &amp;&amp; { HAVE_BASERUBY=yes BASERUBY_VERSION=
AC_ARG_WITH(baseruby,</p>

<pre>AS_HELP_STRING([--with-baseruby=RUBY], [use RUBY as baseruby; RUBY is the pathname of ruby]),
[AS_CASE([&quot;$withval&quot;],
    [*ruby*],[BASERUBY=$withval],
    [no],[HAVE_BASERUBY=no],
    [AC_MSG_ERROR(need ruby)])
],
[
        AC_PATH_PROG([BASERUBY], [ruby], [false])
])</pre>

<p>AS_IF([test “$HAVE_BASERUBY” = yes -a “`RUBYOPT=- $BASERUBY -e &#39;print
42&#39; 2&gt;/dev/null`” = 42], [</p>

<pre>AS_IF([test &quot;`RUBYOPT=- $BASERUBY --disable=gems -e &#39;print 42&#39; 2&gt;/dev/null`&quot; = 42], [
    BASERUBY=&quot;$BASERUBY --disable=gems&quot;
    BASERUBY_VERSION=`$BASERUBY -v`
])
$BASERUBY -C &quot;$srcdir&quot; tool/downloader.rb -d tool -e gnu config.guess config.sub &gt;&amp;AS_MESSAGE_FD</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">BASERUBY</span>=<span class="ruby-string">&quot;echo executable host ruby is required.  use --with-baseruby option.; false&quot;</span>
<span class="ruby-constant">HAVE_BASERUBY</span>=<span class="ruby-identifier">no</span>
</pre>

<p>]) AC_SUBST(BASERUBY) AC_SUBST(HAVE_BASERUBY)</p>

<p>: ${GIT=git} HAVE_GIT=yes AC_ARG_WITH(git,</p>

<pre>AS_HELP_STRING([--without-git], [never use git]),
[AS_CASE([$withval],
    [no],  [GIT=never-use HAVE_GIT=no],
    [yes], [],
    [GIT=$withval])])</pre>

<p>AS_IF([test x“$HAVE_GIT” = xyes], [command -v “$GIT” &gt; /dev/null ||
HAVE_GIT=no]) AC_SUBST(GIT) AC_SUBST(HAVE_GIT)</p>

<p>eval `sed -n -e [&#39;s/^@%:@define <a href="A-Z_">RUBY_</a>*<a
href="A-Z">VERSION_(</a>[<a href="A-Z_0-9">A-Z]</a>*) ([<a
href="0-9">0-9]</a>*)$/1=2/p&#39;] \</p>

<pre> -e [&#39;s/^@%:@define \(RUBY_PATCHLEVEL\) \(.*\)/\1=\2/p&#39;] \
$srcdir/include/ruby/version.h $srcdir/version.h`</pre>

<p>for v in MAJOR MINOR TEENY; do</p>

<pre>AS_IF([eval &quot;test \&quot;\$$v\&quot; = &#39;&#39;&quot;], [
    AC_MSG_ERROR(could not determine $v number from version.h)
])</pre>

<p>done AC_SUBST(MAJOR) AC_SUBST(MINOR) AC_SUBST(TEENY)
AC_SUBST(RUBY_API_VERSION, &#39;$(MAJOR).$(MINOR)&#39;)
AC_SUBST(RUBY_PROGRAM_VERSION, &#39;$(MAJOR).$(MINOR).$(TEENY)&#39;)</p>

<p>dnl checks for alternative programs AC_CANONICAL_BUILD RUBY_RM_RECURSIVE
AC_ARG_WITH(gcc,</p>

<pre>AS_HELP_STRING([--without-gcc], [never use gcc]),
[
AS_CASE([$withval],
    [no],  [: ${CC=cc}],
    [yes], [: ${CC=gcc}],
           [CC=$withval])])</pre>

<p>dnl If the user switches compilers, we can&#39;t believe the cache
AS_IF([test ! -z “$ac_cv_prog_CC” -a ! -z “$CC” -a “$CC” !=
“$ac_cv_prog_CC”], [</p>

<pre>AC_MSG_ERROR(cached CC is different -- throw away $cache_file</pre>

<p>(it is also a good idea to do &#39;make clean&#39; before compiling)) ])
test -z “$CC” || ac_cv_prog_CC=“$CC”</p>

<p>AS_IF([test “$program_prefix” = NONE], [</p>

<pre>program_prefix=</pre>

<p>]) AS_IF([test “$prefix” -ef .], [</p>

<pre>AC_MSG_ERROR(--prefix cannot be the current working directory.)</pre>

<p>]) RUBY_BASE_NAME=`echo ruby | sed “$program_transform_name”`
RUBYW_BASE_NAME=`echo rubyw | sed “$program_transform_name”`
AC_SUBST(RUBY_BASE_NAME) AC_SUBST(RUBYW_BASE_NAME)
AC_SUBST(RUBY_VERSION_NAME, &#39;${RUBY_BASE_NAME}-${ruby_version}&#39;)</p>

<p>AC_CANONICAL_TARGET test x“$target_alias” = x &amp;&amp; target_os=`echo
$target_os | sed &#39;s/linux-gnu$/linux/;s/linux-gnu/linux-/&#39;`
ac_install_sh=&#39;&#39; # unusable for extension libraries.</p>

<p>AC_ARG_WITH(os-version-style,</p>

<pre>AS_HELP_STRING([--with-os-version-style=TYPE],
               [OS version number for target and target_os [[full]]]
               [(full|teeny|minor+0|minor|major+0|major|none)]),
[os_version_style=$withval],
[os_version_style=full
    AS_CASE($target_os, [[*[0-9].*]],
        [AS_CASE([`/usr/bin/ruby -e &#39;puts RUBY_PLATFORM&#39; 2&gt;/dev/null`],
            [[*-*[0-9].*.0]], [os_version_style=minor+0],
            [[*-*[0-9].*.*]], [os_version_style=full],
            [[*-*[0-9].0]  ], [os_version_style=major+0],
            [[*-*[0-9].*]  ], [os_version_style=minor],
            [[*-*[0-9]]    ], [os_version_style=major],
        )])
])</pre>

<p>os_version_style_transform= AS_CASE(“${os_version_style}”,</p>

<pre>[full|teeny], [],
[minor+0], [os_version_style_transform=[&#39;s/\([0-9]\.[0-9][0-9]*\)\.[0-9][.0-9]*$/\1.0/&#39;]],
[minor],   [os_version_style_transform=[&#39;s/\([0-9]\.[0-9][0-9]*\)\.[0-9][.0-9]*$/\1/&#39;]],
[major+0], [os_version_style_transform=[&#39;s/\([0-9]\)\.[0-9][.0-9]*$/\1.0/&#39;]],
[major],   [os_version_style_transform=[&#39;s/\([0-9]\)\.[0-9][.0-9]*$/\1/&#39;]],
[none],    [os_version_style_transform=[&#39;s/[0-9]*\.[0-9][.0-9]*$//&#39;]],
[AC_MSG_ERROR(unknown --with-os-version-style: $withval)])</pre>

<p>AS_IF([test -z “$target_alias” -a -n “$os_version_style_transform”],</p>

<pre>[
target=`echo ${target} | sed &quot;$os_version_style_transform&quot;`
target_os=`echo ${target_os} | sed &quot;$os_version_style_transform&quot;`
])</pre>

<p>AC_ARG_WITH(arch,</p>

<pre> AS_HELP_STRING([--with-arch=ARCHS],
                [build an Apple/NeXT Multi Architecture Binary (MAB);
                   ARCHS is a comma-delimited list of architectures for
                   which to build; if this option is disabled or omitted
                   entirely, then the package will be built only for the
                   target platform]),
[target_archs=&quot;$withval&quot;], [unset target_archs])</pre>

<p>AC_ARG_ENABLE(load-relative,</p>

<pre>AS_HELP_STRING([--enable-load-relative], [resolve load paths at run time]),
[load_relative=$enableval])</pre>

<p>AC_ARG_PROGRAM</p>

<p>dnl Checks for programs.</p>

<p>cflagspat= test -z “$optflags” ||</p>

<pre>cflagspat=&quot;$cflagspat;s|&quot;`eval echo &#39;&quot;&#39;&quot;${optflags}&quot;&#39;&quot;&#39; | sed &#39;s/[[][|.*]]/\\&amp;/g;s/^    /;s/ *$/ /&#39;`&#39;| |g&#39;</pre>

<p>test -z “$debugflags” ||</p>

<pre>cflagspat=&quot;$cflagspat;s|&quot;`eval echo &#39;&quot;&#39;&quot;${debugflags}&quot;&#39;&quot;&#39; | sed &#39;s/[[][|.*]]/\\&amp;/g;s/^    /;s/ *$/ /&#39;`&#39;| |g&#39;</pre>

<p>test -z “$warnflags” ||</p>

<pre>cflagspat=&quot;$cflagspat;s|&quot;`eval echo &#39;&quot;&#39;&quot;${warnflags}&quot;&#39;&quot;&#39; | sed &#39;s/[[][|.*]]/\\&amp;/g;s/^ */ /;s/ *$/ /&#39;`&#39;| |g&#39;</pre>

<p>AS_IF([test -z “${CFLAGS+set}”], [</p>

<pre class="ruby"><span class="ruby-identifier">cflags</span>=<span class="ruby-value">%x`echo &quot; $cflags &quot; | sed &quot;$cflagspat;s/^ *//;s/ *$//&quot;`</span>
<span class="ruby-identifier">orig_cflags</span>=<span class="ruby-string">&quot;$cflags&quot;</span>
<span class="ruby-identifier">cflags</span>=<span class="ruby-string">&quot;$cflags &quot;</span><span class="ruby-string">&#39;${optflags} ${debugflags} ${warnflags}&#39;</span>
</pre>

<p>]) dnl AS_IF([test -z “${CXXFLAGS+set}”], [ dnl     cxxflags=`echo “
$cxxflags ” | sed “$cflagspat;s/^ *//;s/ *$//”` dnl    
orig_cxxflags=“$cxxflags” dnl     cxxflags=“$cxxflags ”&#39;${optflags}
${debugflags} ${warnflags}&#39; dnl ])</p>

<p><a href=""$host_os:$build_os"">AS_CASE(</a>, [darwin*:darwin*], [</p>

<pre>AC_CHECK_TOOLS(CC, [clang gcc cc])
# Following Apple deployed clang are broken
# clang version 1.0 (http://llvm.org/svn/llvm-project/cfe/tags/Apple/clang-23 exported)
# Apple clang version 2.0 (tags/Apple/clang-137) (based on LLVM 2.9svn)
# Apple clang version 2.1 (tags/Apple/clang-163.7.1) (based on LLVM 3.0svn)
AS_IF([! $CC -E -xc - &lt;&lt;SRC &gt;/dev/null], [
    @%:@if defined __APPLE_CC__ &amp;&amp; defined __clang_major__ &amp;&amp; __clang_major__ &lt; 3
    @%:@error premature clang
    @%:@endif</pre>

<p>SRC</p>

<pre>    AC_MSG_ERROR([clang version 3.0 or later is required])
])],</pre>

<p>[openbsd*:openbsd*], [</p>

<pre class="ruby"><span class="ruby-constant">AC_CHECK_TOOLS</span>(<span class="ruby-constant">CC</span>, [<span class="ruby-identifier">cc</span>])
</pre>

<p>]) AS_IF([test x“${build}” != x“${host}”], [</p>

<pre class="ruby"><span class="ruby-constant">AC_CHECK_TOOL</span>(<span class="ruby-constant">CC</span>, <span class="ruby-identifier">gcc</span>)
</pre>

<p>])</p>

<p>AC_PROG_CC_C99 <a href="$CC">AS_CASE(</a>, [gcc-*], [</p>

<pre>gcc_prefix=gcc- gcc_suffix=`echo &quot;$CC&quot; | sed &#39;s/^gcc//&#39;`
AC_PROG_CXX(g++${gcc_suffix})],</pre>

<p>[clang-*|clang], [</p>

<pre>gcc_prefix=clang- gcc_suffix=`echo &quot;$CC&quot; | sed &#39;s/^clang//&#39;`
AC_PROG_CXX(clang++${gcc_suffix})],</pre>

<p>[gcc_prefix= gcc_suffix=])</p>

<p>dnl Select the appropriate C++ compiler in OS X <a
href=""$build_os:${CXX}"">AS_CASE(</a>,</p>

<pre>[darwin1*.*:], [
    AC_MSG_CHECKING([CXX for $CC])
    AS_CASE([&quot;/$CC &quot;],
        [*@&lt;:@\ /@:&gt;@&quot;gcc-4.2 &quot;*], [pat=&#39;gcc-4\.2&#39; CXX=g++-4.2],
        [*@&lt;:@\ /@:&gt;@&quot;gcc &quot;*],     [pat=gcc CXX=g++],
        [*@&lt;:@\ /@:&gt;@&quot;cc &quot;*],      [pat=cc CXX=c++],
        [*@&lt;:@\ /@:&gt;@&quot;icc &quot;*],     [pat=icc CXX=icpc],
        [*@&lt;:@\ /@:&gt;@&quot;clang &quot;*],   [pat=clang CXX=clang++])
    AS_IF([test &quot;${CXX}&quot;], [
        CXX=`echo &quot;/$CC &quot; | sed [&quot;s:\([ /]\)${pat}:\1$CXX:; s:^/::; s: *$::&quot;]`
    ])
    AC_MSG_RESULT([$CXX])],
[openbsd*:*], [
    AC_CHECK_TOOLS(CXX, [c++])
])</pre>

<p>test -z “$CXX” || ac_cv_prog_CXX=“$CXX”</p>

<p><a href=""$target_os"">AS_CASE(</a>, [darwin*], [</p>

<pre>AC_MSG_CHECKING(if minimum required OS X version is supported)
AC_TRY_CPP([@%:@include &lt;AvailabilityMacros.h&gt;
    @%:@if MAC_OS_X_VERSION_MIN_REQUIRED &lt; __MAC_10_5
    @%:@error pre OS X 10.5
    [!&lt;===== pre OS X 10.5 =====&gt;]
    @%:@endif
    ],
    [macosx_min_required=yes],
    [AC_MSG_RESULT(no)
    AC_MSG_ERROR([Unsupported OS X version is required])])
AC_MSG_RESULT(${macosx_min_required})</pre>

<p>])</p>

<p>AC_PROG_CXX RUBY_MINGW32 AC_PROG_GCC_TRADITIONAL AC_SUBST(GCC) <a
href=""$target_os"">AS_CASE(</a>, [solaris*], [<a
href="LD">AC_PATH_TOOL(</a>, [ld], [/usr/ccs/bin/ld],
[/usr/ccs/bin:$PATH])], [<a href="LD">AC_CHECK_TOOL(</a>, [ld], [ld])])
AC_SUBST(LD) AS_IF([test “$GCC” = yes], [</p>

<pre>linker_flag=-Wl,
: ${optflags=-O3}
gcc_major=`echo =__GNUC__ | $CC -E -xc - | sed &#39;/^=/!d;s///&#39;`
gcc_minor=`echo =__GNUC_MINOR__ | $CC -E -xc - | sed &#39;/^=/!d;s///&#39;`
test -n &quot;$gcc_major&quot; || gcc_major=0
test -n &quot;$gcc_minor&quot; || gcc_minor=0
icc_version=`echo =__ICC | $CC -E -xc - | sed &#39;/^=/!d;s///;/^__ICC/d&#39;`
test -n &quot;$icc_version&quot; || icc_version=0
# RUBY_APPEND_OPTIONS(XCFLAGS, [&quot;-include ruby/config.h&quot; &quot;-include ruby/missing.h&quot;])</pre>

<p>], [</p>

<pre>linker_flag=</pre>

<p>])</p>

<p>AS_IF([test “$GCC” = yes -a “$gcc_major” -lt 3 ], [</p>

<pre>AC_MSG_ERROR([too old GCC])</pre>

<p>])</p>

<p>RUBY_PROG_GNU_LD RUBY_CPPOUTFILE</p>

<p>: ${OUTFLAG=&#39;-o &#39;} : ${COUTFLAG=${OUTFLAG}} :
${CSRCFLAG=&#39;&#39;} AC_SUBST(OUTFLAG) AC_SUBST(COUTFLAG)
AC_SUBST(CSRCFLAG)</p>

<p>: ${MJIT_CC=$CC} AS_IF([test “x$cross_compiling” = xno], [</p>

<pre>AC_PATH_PROG([MJIT_CC], ${MJIT_CC})
AS_CASE([$target_os],
    [*mingw*], [command -v cygpath &gt; /dev/null &amp;&amp; MJIT_CC=`cygpath -ma $MJIT_CC`])
shift 2
MJIT_CC=&quot;$MJIT_CC${1+ }$*&quot;</pre>

<p>])</p>

<p><a href=""$build_os"">AS_CASE(</a>,</p>

<pre>[darwin1*.*], [
  # Xcode linker warns for deprecated architecture and wrongly
  # installed TBD files.
  CC_WRAPPER=&quot;&quot;
  echo &#39;int main(void) {return 0;}&#39; &gt; conftest.c
  AS_IF([$CC -framework Foundation -o conftest conftest.c 2&gt;&amp;1 |
         grep &#39;^ld: warning: text-based stub file&#39; &gt;/dev/null], [
      CC_WRAPPER=`cd -P &quot;$srcdir/tool&quot; &amp;&amp; pwd`/darwin-cc
      CC=&quot;$CC_WRAPPER $CC&quot;
  ])
  rm -fr conftest*
])</pre>

<p>cc_version= for option in –version -v -V -qversion; do</p>

<pre>cc_version_message=`$CC $option 2&gt;&amp;1`
cc_version_status=$?
AS_CASE($cc_version_status, [0], [:], [continue])
AS_CASE($cc_version_message, [*Warning*], [continue])
cc_version=&#39;$(CC) &#39;$option
break</pre>

<p>done AC_SUBST(CC_VERSION, $cc_version) AC_SUBST(CC_VERSION_MESSAGE,
$cc_version_message)</p>

<p>: ${DLDFLAGS=“$LDFLAGS”}</p>

<p>RUBY_UNIVERSAL_ARCH AS_IF([test “$target_cpu” != “$host_cpu” -a “$GCC” =
yes -a “$cross_compiling” = no -a “$universal_binary” = no], [</p>

<pre class="ruby"><span class="ruby-constant">RUBY_DEFAULT_ARCH</span>(<span class="ruby-string">&quot;$target_cpu&quot;</span>)
</pre>

<p>])</p>

<p><a href=""$target_os"">AS_CASE(</a>, [darwin*], [ if libtool 2&gt;&amp;1 |
grep no_warning_for_no_symbols &gt; /dev/null; then</p>

<pre>ac_cv_prog_ac_ct_RANLIB=:
ac_cv_prog_ac_ct_AR=&#39;libtool -static&#39;
rb_cv_arflags=&#39;-no_warning_for_no_symbols -o&#39;</pre>

<p>fi ]) AC_CHECK_TOOLS(RANLIB, [${gcc_prefix}ranlib${gcc_suffix} ranlib], :)
AC_CHECK_TOOLS(AR, [${gcc_prefix}ar${gcc_suffix} ar]) AS_IF([test -z
“$AR”], [</p>

<pre class="ruby"><span class="ruby-constant">AC_CHECK_PROGS</span>(<span class="ruby-constant">AR</span>, <span class="ruby-identifier">aal</span>, <span class="ruby-identifier">ar</span>)
</pre>

<p>]) AC_CACHE_CHECK([for $AR flags], [rb_cv_arflags], [</p>

<pre>AS_IF([$AR rcD conftest.a &gt; /dev/null 2&gt;&amp;1 &amp;&amp; rm conftest.a],
    [rb_cv_arflags=rcD], [rb_cv_arflags=rcu])</pre>

<p>]) AC_SUBST(ARFLAGS, [“$rb_cv_arflags ”])</p>

<p>AC_CHECK_TOOL(AS, as) ASFLAGS=$ASFLAGS AC_SUBST(ASFLAGS)</p>

<p><a href=""$target_os"">AS_CASE(</a>,[cygwin*|mingw*],
[ac_cv_prog_ac_ct_OBJCOPY=“:”])</p>

<p># BSD&#39;s ports and MacPorts prefix GNU binutils with &#39;g&#39;
AC_CHECK_TOOLS(OBJDUMP, [objdump gobjdump]) AC_CHECK_TOOLS(OBJCOPY,
[objcopy gobjcopy])</p>

<p><a href=""$target_os"">AS_CASE(</a>, [cygwin*|mingw*], [</p>

<pre>AC_CHECK_TOOL(WINDRES, windres)
AC_CHECK_TOOL(DLLWRAP, dllwrap)
target=`echo $target | sed &quot;s/^$target_cpu-/-/&quot;`
target_alias=`echo $target_alias | sed &quot;s/^$target_cpu-/-/&quot;`
target_cpu=`echo $target_cpu | sed s/i.86/i386/`
AS_CASE([&quot;$target&quot;], [-*], [ target=&quot;$target_cpu${target}&quot;])
AS_CASE([&quot;$target_alias&quot;], [-*], [ target_alias=&quot;$target_cpu${target_alias}&quot;])
AS_CASE([&quot;$target_os&quot;],
[mingw*], [
    test &quot;$rb_cv_msvcrt&quot; = &quot;&quot; &amp;&amp; unset rb_cv_msvcrt
    AC_CACHE_CHECK(for mingw32 runtime DLL, rb_cv_msvcrt, [
    AC_TRY_LINK([@%:@include &lt;stdio.h&gt;],
                [FILE* volatile f = stdin; return 0;],
                [rb_cv_msvcrt=`$OBJDUMP -p conftest$ac_exeext |
                               tr A-Z a-z |
                               sed -n &#39;/^[[         ]]*dll name: \(msvc.*\)\.dll$/{s//\1/p;q;}&#39;`],
                [rb_cv_msvcrt=msvcrt])
    test &quot;$rb_cv_msvcrt&quot; = &quot;&quot; &amp;&amp; rb_cv_msvcrt=msvcrt])
    RT_VER=`echo &quot;$rb_cv_msvcrt&quot; | tr -cd [0-9]`
    test &quot;$RT_VER&quot; = &quot;&quot; &amp;&amp; RT_VER=60
    AC_DEFINE_UNQUOTED(RUBY_MSVCRT_VERSION, $RT_VER)
    sysconfdir=
])
: ${enable_shared=yes}
],</pre>

<p>[aix*],     [AC_CHECK_TOOL(NM, nm, /usr/ccs/bin/nm, /usr/ccs/bin:$PATH)],
[hiuxmpp*], [AC_DEFINE(<em>HIUX_MPP</em>)])    # by TOYODA Eizi
&lt;toyoda@npd.kishou.go.jp&gt; AC_CHECK_TOOLS(NM,
[${gcc_prefix}nm${gcc_suffix} nm])</p>

<p>AC_PROG_LN_S AC_PROG_MAKE_SET AC_PROG_INSTALL AC_PROG_MKDIR_P AS_IF([test
“x$MKDIR_P” = “x -d”], [</p>

<pre>AS_IF([test x&quot;$as_mkdir_p&quot; != xfalse], [
  MKDIR_P=&#39;mkdir -p&#39;
  echo &quot;use &#39;mkdir -p&#39; as MKDIR_P&quot;
], [
  AC_MSG_ERROR([mkdir -p is required])
])</pre>

<p>]) MAKEDIRS=“$MKDIR_P” AC_SUBST(MAKEDIRS)</p>

<p><a href="DTRACE">AC_CHECK_PROG(</a>, [${ac_tool_prefix}dtrace],
[${ac_tool_prefix}dtrace]) AS_IF([test
“$cross_compiling:$ac_cv_prog_DTRACE” = no: -a -n “$ac_tool_prefix”], [</p>

<pre class="ruby"><span class="ruby-constant">AC_CHECK_PROG</span>([<span class="ruby-constant">DTRACE</span>], [<span class="ruby-identifier">dtrace</span>], [<span class="ruby-identifier">dtrace</span>])
</pre>

<p>])</p>

<p>AC_CHECK_PROGS(DOT, dot) AC_CHECK_PROGS(DOXYGEN, doxygen)</p>

<p>AC_CHECK_PROG(PKG_CONFIG, pkg-config, [pkg-config], [], [],</p>

<pre>[`&quot;$as_dir/$ac_word$ac_exec_ext&quot; --print-errors --version &gt; /dev/null 2&gt;&amp;1 || echo &quot;$as_dir/$ac_word$ac_exec_ext&quot;`])</pre>

<p># checks for UNIX variants that set C preprocessor variables
AC_USE_SYSTEM_EXTENSIONS</p>

<p>AC_SUBST(RM, [&#39;rm -f&#39;]) AC_SUBST(CP, [&#39;cp&#39;])
RMDIRS=&#39;$(top_srcdir)/tool/rmdirs&#39; RMDIR=rmdir mkdir
“rmdirs_$$_test” “rmdirs_$$_test/a” rmdir –ignore-fail-on-non-empty
“rmdirs_$$_test” 2&gt;/dev/null &amp;&amp; RMDIR=&#39;rmdir
–ignore-fail-on-non-empty&#39; $RMDIR -p “rmdirs_$$_test/a” 2&gt;/dev/null
&amp;&amp; { test -d “rmdirs_$$_test” || RMDIRS=“$RMDIR -p”; } rmdir
“rmdirs_$$_test/a” “rmdirs_$$_test” 2&gt;/dev/null AC_SUBST(RMDIR)
AC_SUBST(RMDIRS) AC_SUBST(RMALL, [&#39;rm -fr&#39;])</p>

<p>AC_MSG_CHECKING([for cd using physical directory]) rm -fr conf$$.dir mkdir
conf$$.dir &amp;&amp; (cd conf$$.dir &amp;&amp; mkdir src build &amp;&amp;
cd src &amp;&amp; $as_ln_s ../build . &gt; /dev/null 2&gt;&amp;1 &amp;&amp;
cd build &amp;&amp; for chdir in &#39;cd -P&#39; &#39;PWD= cd&#39;; do</p>

<pre>/bin/sh -c &quot;$chdir ../src &amp;&amp; echo &#39;$chdir&#39; &gt; cdcmd&quot; 2&gt; /dev/null &amp;&amp; break</pre>

<p>done) AS_IF([test -f conf$$.dir/src/cdcmd], [</p>

<pre>read CHDIR &lt; conf$$.dir/src/cdcmd 2&gt; /dev/null</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">CHDIR</span>=<span class="ruby-identifier">cd</span>
</pre>

<p>]) rm -fr conf$$.dir <a href="$CHDIR">AC_MSG_RESULT(</a>) AC_SUBST(CHDIR) }</p>

<p>: “compiler section” &amp;&amp; { RUBY_WERROR_FLAG([</p>

<pre>AC_MSG_CHECKING([whether CFLAGS is valid])
AC_TRY_COMPILE([], [],
    [AC_MSG_RESULT(yes)],
    [
    AC_MSG_RESULT(no)
    AC_MSG_ERROR([something wrong with CFLAGS=&quot;$CFLAGS&quot;])
    ]
)

AC_MSG_CHECKING([whether LDFLAGS is valid])
{
    mkdir tmp.$$.try_link &amp;&amp;
    cd tmp.$$.try_link &amp;&amp;
    cp ../confdefs.h . &amp;&amp;
    echo &#39;&lt;?xml?&gt;&lt;plist&gt;&lt;dict&gt;&lt;key&gt;CFBundleIdentifier&lt;/key&gt;&lt;string&gt;&lt;/string&gt;&lt;/dict&gt;&lt;/plist&gt;&#39; &gt; Info.plist &amp;&amp;
    :
} || AC_MSG_ERROR([failed to make temporary directory])
AC_TRY_LINK([], [],
    [AC_MSG_RESULT(yes)],
    [
    cd .. &amp;&amp; rm -fr tmp.$$.try_link
    AC_MSG_RESULT(no)
    AC_MSG_ERROR([something wrong with LDFLAGS=&quot;$LDFLAGS&quot;])
    ]
)
cd .. &amp;&amp; rm -fr tmp.$$.try_link</pre>

<p>])</p>

<p>: ${RPATHFLAG=&#39;&#39;} rpathflag=&#39;&#39; AS_IF([test x“${RPATHFLAG}”
= x], [</p>

<pre>AS_CASE([&quot;$target_os&quot;],
    [hpux*], [AS_IF([test &quot;$rb_cv_prog_gnu_ld&quot; = no], [rpathflag=&#39;+b &#39;])],
    [aix*], [rpathflag=&#39;-blibpath:&#39;],
    [for rpathflag in -R &quot;-rpath &quot;; do
        AS_CASE(&quot;$rpathflag&quot;,
                [*&quot; &quot;], [AS_CASE([&quot;${linker_flag}&quot;],
                                 [*,], [rpathflag=`echo &quot;$rpathflag&quot; | tr &#39; &#39; ,`])])
        rpathflag=&quot;${linker_flag}${rpathflag}&quot;
        RUBY_TRY_LDFLAGS([${rpathflag}.], [], [rpathflag=])
        AS_IF([test &quot;x${rpathflag}&quot; != x], [])
    done])</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-identifier">rpathflag</span>=<span class="ruby-value">%x`echo &quot;$RPATHFLAG&quot; | sed &#39;s/%.*//&#39;`</span>
</pre>

<p>])</p>

<p><a href="$RUBY_PATCHLEVEL">AS_CASE(</a>, [-*],</p>

<pre>[RUBY_DEVEL=yes], [RUBY_DEVEL=no])</pre>

<p>particular_werror_flags=$RUBY_DEVEL AC_ARG_ENABLE(werror,</p>

<pre>AS_HELP_STRING([--disable-werror],
               [don&#39;t make warnings into errors
               even if a compiler support -Werror feature
               [[disabled by default unless development version]]]),
[particular_werror_flags=$enableval])</pre>

<p>rb_cv_warnflags=“$warnflags” <a
href=""$GCC:${warnflags+set}:${extra_warnflags:+set}:"">AS_CASE(</a>,
[yes::*|yes:*:set:], [# GCC &amp;&amp; (!warnflags || extra_warnflags)</p>

<pre>AS_IF([test $gcc_major -ge 4], [
    extra_warnflags=&quot;$extra_warnflags -Werror=extra-tokens&quot;
])
AS_IF([test $gcc_major -ge 5 -a $gcc_major -le 6], [
    extra_warnflags=&quot;$extra_warnflags -Wno-maybe-uninitialized&quot;
])
# ICC doesn&#39;t support -Werror=
AS_IF([test $icc_version -gt 0], [
    particular_werror_flags=no
])
for wflag in \
             -Werror=deprecated-declarations \
             -Werror=division-by-zero \
             -Werror=duplicated-cond \
             -Werror=implicit-function-declaration \
             -Werror=implicit-int \
             -Werror=misleading-indentation \
             -Werror=pointer-arith \
             -Werror=shorten-64-to-32 \
             -Werror=write-strings \
             -Wimplicit-fallthrough=0 \
             -Wmissing-noreturn \
             -Wno-cast-function-type \
             -Wno-constant-logical-operand \
             -Wno-long-long \
             -Wno-missing-field-initializers \
             -Wno-overlength-strings \
             -Wno-packed-bitfield-compat \
             -Wno-parentheses-equality \
             -Wno-self-assign \
             -Wno-tautological-compare \
             -Wno-unused-parameter \
             -Wno-unused-value \
             -Wsuggest-attribute=format \
             -Wsuggest-attribute=noreturn \
             -Wunused-variable \
             -diag-disable=175,188,2259 \
             $extra_warnflags \
             ; do
    AS_IF([test &quot;$particular_werror_flags&quot; != yes], [
        wflag=`echo x$wflag | sed &#39;s/^x-Werror=/-W/;s/^x//&#39;`
    ])
    ok=no
    RUBY_TRY_CFLAGS($wflag, [
        RUBY_APPEND_OPTIONS(warnflags, $wflag)
        ok=yes
    ])
    AS_CASE([$ok:$wflag], [no:-Werror=*], [
        wflag=`echo x$wflag | sed &#39;s/^x-Werror=/-W/&#39;`
        RUBY_TRY_CFLAGS($wflag, [
            RUBY_APPEND_OPTIONS(warnflags, $wflag)
            particular_werror_flags=no
        ])
    ])
done
AS_CASE([&quot; $warnflags &quot;],[*&quot; -Wno-missing-field-initializers &quot;*], [wflag=&quot;-Wall -Wextra&quot;],
                         [wflag=-Wall])
RUBY_TRY_CFLAGS($wflag, [warnflags=&quot;$wflag${warnflags+ $warnflags}&quot;])
# Disable warnflags while conftest. -Werror=* flags might make bad OS capability guess.
rb_cv_warnflags=&quot;$warnflags&quot;
warnflags=</pre>

<p>]) RUBY_TRY_CFLAGS(-Qunused-arguments,
[RUBY_APPEND_OPTIONS(rb_cv_wsuppress_flags, -Qunused-arguments)])</p>

<p>AC_ARG_WITH(compress-debug-sections,</p>

<pre>AS_HELP_STRING([--with-compress-debug-sections=type],
    [enable debug section compression]),
[compress_debug_sections=$withval], [compress_debug_sections=])</pre>

<p>AS_IF([test “$GCC” = yes], [</p>

<pre># -D_FORTIFY_SOURCE
# When defined _FORTIFY_SOURCE, glibc enables some additional sanity
# argument check. The performance drop is very little and Ubuntu enables
# _FORTIFY_SOURCE=2 by default. So, let&#39;s support it for protecting us from
# a mistake of silly C extensions.

# TODO: check if link succeeds with _FORTIFY_SOURCE=2.
AS_CASE([&quot;$target_os&quot;],
[mingw*], [
    fortify_source=no
])
AC_ARG_ENABLE(fortify_source,
              AS_HELP_STRING([--disable-fortify-source],
                             [disable -D_FORTIFY_SOURCE=2 option, which causes link error on mingw]),
              [fortify_source=$enableval])
AS_IF([test &quot;x$fortify_source&quot; != xno], [
RUBY_TRY_CFLAGS(-D_FORTIFY_SOURCE=2, [RUBY_APPEND_OPTION(XCFLAGS, -D_FORTIFY_SOURCE=2)])
])

: ${MJIT_HEADER_FLAGS=&#39;-P -dD&#39;}

# -fstack-protector
AS_CASE([&quot;$target_os&quot;],
[mingw*], [
    stack_protector=no
])
AS_IF([test -z &quot;${stack_protector+set}&quot;], [
    AS_FOR(option, opt, [-fstack-protector-strong -fstack-protector], [
        RUBY_TRY_CFLAGS(option, [stack_protector=yes])
        AS_IF([test &quot;x$stack_protector&quot; = xyes], [
            RUBY_TRY_LDFLAGS(option, [], [stack_protector=])
        ])
        AS_IF([test &quot;x$stack_protector&quot; = xyes], [stack_protector=option; break])
    ])
])
AS_CASE([&quot;$stack_protector&quot;], [-*], [
    RUBY_APPEND_OPTION(XCFLAGS, $stack_protector)
    RUBY_APPEND_OPTION(XLDFLAGS, $stack_protector)
    RUBY_APPEND_OPTION(LDFLAGS, $stack_protector)
])

AS_CASE(&quot;${compress_debug_sections:-zlib}&quot;,
[none|no], [], [
RUBY_TRY_LDFLAGS(${linker_flag}--compress-debug-sections=${compress_debug_sections:-zlib},
                 [compress_debug_sections=${compress_debug_sections:-zlib}],
                 [compress_debug_sections=no])
])
AS_IF([test &quot;x$compress_debug_sections&quot; != xno], [
    RUBY_APPEND_OPTION(DLDFLAGS, ${linker_flag}--compress-debug-sections=$compress_debug_sections)
])

AS_CASE([&quot;$target_os&quot;],[mingw*], [
  # On  Windows  platforms,   system  provided  headers  are  VC++
  # optimized.  That  is, C++  habits are often  contaminated into
  # various  headers.  Most frequent  situation is  the use  of //
  # comments.   We  bypass  ANSI   C  mode  for  them.   Otherwise
  # extension libs cannot include those headers.

  # Since math.h in some mingw64 wrongly declares frexp and modf
  # to be pure, the variables pointed by the second arguments are
  # considered uninitialized unexpectedly.
  AC_CACHE_CHECK([whether frexp and modf are broken],
    rb_cv_mingw64_broken_frexp_modf,
    [
      save_CFLAGS=&quot;$CFLAGS&quot;
      AS_IF([test &quot;$particular_werror_flags&quot; = &quot;yes&quot;], [
        CFLAGS=&quot;$CFLAGS -Werror=uninitialized&quot;
      ], [
        CFLAGS=&quot;$CFLAGS -Werror -Wuninitialized&quot;
      ])
      AC_TRY_COMPILE([@%:@include &lt;math.h&gt;
        int foo(double x)
        {
          int exp;
          frexp(x, &amp;exp);
          return exp;
        }], [if (foo(0.0)) return 1;],
        [rb_cv_mingw64_broken_frexp_modf=no],
        [rb_cv_mingw64_broken_frexp_modf=yes])
      CFLAGS=&quot;$save_CFLAGS&quot;
    ])
  AS_IF([test &quot;$rb_cv_mingw64_broken_frexp_modf&quot; = yes], [
    AC_DEFINE(RUBY_MINGW64_BROKEN_FREXP_MODF)
  ])
],
[cygwin*|darwin*|netbsd*], [
  # need lgamma_r(), finite()
])

# ANSI (no XCFLAGS because this is C only)
AS_CASE([&quot;$target_os&quot;],
[solaris*], [
  # Because &quot;-std=gnu99&quot; affects existence of functions on Solaris,
  # &quot;-std=gnu99&quot; will be appended to CPPFLAGS.
    for ansi_options in -std=gnu99; do
        RUBY_TRY_CFLAGS(${ansi_options}, [
            RUBY_APPEND_OPTIONS(CPPFLAGS, ${ansi_options})
        ], [ansi_options=])
        test &quot;x${ansi_options}&quot; = x || break
    done
],
[
  # ANSI (no XCFLAGS because this is C only)
  rb_tmp_std_check=`echo $CC $CFLAGS $optflags $warnflags $debugflags | fgrep std= | tr -d  &#39;\015&#39;`
  AS_IF([test &quot;x$rb_tmp_std_check&quot; = &quot;x&quot;],
  [
    for ansi_options in -std=gnu99; do
        RUBY_TRY_CFLAGS(${ansi_options}, [
            RUBY_APPEND_OPTIONS(warnflags, ${ansi_options})
            RUBY_APPEND_OPTIONS(strict_warnflags, ${ansi_options})
        ], [ansi_options=])
        test &quot;x${ansi_options}&quot; = x || break
    done
  ])
])

# suppress annoying -Wstrict-overflow warnings
RUBY_TRY_CFLAGS(-fno-strict-overflow, [RUBY_APPEND_OPTION(XCFLAGS, -fno-strict-overflow)])

test &quot;${debugflags+set}&quot; || {RUBY_TRY_CFLAGS(-ggdb3, [debugflags=-ggdb3])}
test &quot;${debugflags+set}&quot; || {RUBY_TRY_CFLAGS(-ggdb, [debugflags=-ggdb])}
test &quot;${debugflags+set}&quot; || {RUBY_TRY_CFLAGS(-g3, [debugflags=-g3])}</pre>

<p>]) test $ac_cv_prog_cc_g = yes &amp;&amp; : ${debugflags=-g} AS_IF([test
“x$RUBY_DEVEL” = xyes], [RUBY_APPEND_OPTION(XCFLAGS, -DRUBY_DEVEL=1)])</p>

<p>AS_IF([test “$GCC” = “”], [</p>

<pre>AS_CASE([&quot;$target_os&quot;],[aix*],[warnflags=&quot;$warnflags -qinfo=por&quot; rb_cv_warnflags=&quot;$rb_cv_warnflags -qinfo=por&quot;])</pre>

<p>]) AS_IF([test “$GCC” = yes], [</p>

<pre>AS_IF([test &quot;$gcc_major&quot; -ge 4], [
    RUBY_TRY_CFLAGS(-fvisibility=hidden, [visibility_option=yes], [visibility_option=no])
])
AC_SUBST(WERRORFLAG, &quot;-Werror&quot;)
AS_IF([test &quot;$visibility_option&quot; = yes], [
    RUBY_APPEND_OPTION(XCFLAGS, -fvisibility=hidden)
    AC_DEFINE(RUBY_SYMBOL_EXPORT_BEGIN, [_Pragma(&quot;GCC visibility push(default)&quot;)])
    AC_DEFINE(RUBY_SYMBOL_EXPORT_END,   [_Pragma(&quot;GCC visibility pop&quot;)])
], [
    RUBY_TRY_LDFLAGS([-Wl,-unexported_symbol,_Init_*], [visibility_option=ld], [visibility_option=no])
])
test &quot;$visibility_option&quot; = no || OBJCOPY=:</pre>

<p>])</p>

<p>AS_IF([test “$GCC” = yes], [</p>

<pre># optflags

AS_CASE([&quot;$target_os&quot;], [mingw*], [
    RUBY_TRY_CFLAGS(-fno-omit-frame-pointer, [optflags=&quot;${optflags+$optflags }-fno-omit-frame-pointer&quot;])
    RUBY_TRY_CFLAGS(-static-libgcc, [static_libgcc=yes], [static_libgcc=no])
    AS_IF([test &quot;$static_libgcc&quot; = yes], [
        RUBY_APPEND_OPTION(EXTLDFLAGS, -static-libgcc)
    ])
])

# disable fast-math
for oflag in -fno-fast-math; do
    RUBY_TRY_CFLAGS($oflag, [RUBY_APPEND_OPTION(CFLAGS, $oflag)])
done
for oflag in -fexcess-precision=standard -fp-model\ precise; do
    RUBY_TRY_CFLAGS($oflag, [RUBY_APPEND_OPTION(XCFLAGS, $oflag)])
done</pre>

<p>])</p>

<p><a href=""$target_cpu"">AS_CASE(</a>, [[<a href="3-6">i</a>86*]], [</p>

<pre>AC_CACHE_CHECK([for __sync_val_compare_and_swap], [rb_cv_gcc_compiler_cas], [
    AC_TRY_LINK([unsigned long atomic_var;],
        [__sync_val_compare_and_swap(&amp;atomic_var, 0, 1);],
        [rb_cv_gcc_compiler_cas=yes],
        [
        save_CFLAGS=&quot;$CFLAGS&quot; CFLAGS=&quot;$CFLAGS -march=i486&quot;
        AC_TRY_LINK([unsigned long atomic_var;],
            [__sync_val_compare_and_swap(&amp;atomic_var, 0, 1);],
            [rb_cv_gcc_compiler_cas=i486],
            [rb_cv_gcc_compiler_cas=no])
        CFLAGS=&quot;$save_CFLAGS&quot;
        ])
])
AS_IF([test &quot;$rb_cv_gcc_compiler_cas&quot; = i486], [ARCH_FLAG=&quot;-march=i486&quot;])</pre>

<p>])</p>

<p>AC_ARG_WITH(opt-dir,</p>

<pre>AS_HELP_STRING([--with-opt-dir=DIR-LIST],
               [add optional headers and libraries directories separated by $PATH_SEPARATOR]),
[
        val=`echo &quot;$PATH_SEPARATOR$withval&quot; | sed &quot;s|$PATH_SEPARATOR\([[^$PATH_SEPARATOR]*]\)| -I\1/include|g;s/^ //&quot;`
        CPPFLAGS=&quot;$CPPFLAGS $val&quot;
        val=`echo &quot;$PATH_SEPARATOR$withval&quot; | sed &quot;s|$PATH_SEPARATOR\([[^$PATH_SEPARATOR]*]\)| -L\1/lib${rpathflag:+ $rpathflag\\\\1/lib}|g;s/^ //&quot;`
        LDFLAGS=&quot;$LDFLAGS $val&quot;
        LDFLAGS_OPTDIR=&quot;$val&quot;
        OPT_DIR=&quot;$withval&quot;
], [OPT_DIR=])</pre>

<p>test -z “${ac_env_CFLAGS_set}” -a -n “${cflags+set}” &amp;&amp; eval
CFLAGS=“&quot;$cflags $ARCH_FLAG&quot;” test -z “${ac_env_CXXFLAGS_set}” -a
-n “${cxxflags+set}” &amp;&amp; eval CXXFLAGS=“&quot;$cxxflags
$ARCH_FLAG&quot;” }</p>

<p>AC_CACHE_CHECK([whether compiler has statement and declarations in
expressions],</p>

<pre>rb_cv_have_stmt_and_decl_in_expr,
[AC_TRY_COMPILE([],[ __extension__ ({ int a = 0; a; }); ],
[rb_cv_have_stmt_and_decl_in_expr=yes],
[rb_cv_have_stmt_and_decl_in_expr=no])])</pre>

<p>AS_IF([test “$rb_cv_have_stmt_and_decl_in_expr” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_STMT_AND_DECL_IN_EXPR</span>)
</pre>

<p>])</p>

<p>: “header and library section” &amp;&amp; { AC_ARG_WITH(winnt-ver,</p>

<pre>AS_HELP_STRING([--with-winnt-ver=0xXXXX], [target Windows NT version (default to 0x0600)]),
[with_winnt_ver=&quot;$withval&quot;], [with_winnt_ver=&quot;0x0600&quot;])</pre>

<p><a href=""$target_os"">AS_CASE(</a>, [mingw*], [</p>

<pre class="ruby"><span class="ruby-constant">RUBY_APPEND_OPTION</span>(<span class="ruby-constant">CPPFLAGS</span>, <span class="ruby-operator">-</span><span class="ruby-constant">D_WIN32_WINNT</span>=<span class="ruby-identifier">$with_winnt_ver</span>)
<span class="ruby-constant">RUBY_APPEND_OPTION</span>(<span class="ruby-constant">CPPFLAGS</span>, <span class="ruby-operator">-</span><span class="ruby-constant">D__MINGW_USE_VC2005_COMPAT</span>)
</pre>

<p>])</p>

<p><a href=""$target_os"">AS_CASE(</a>, [freebsd*], [</p>

<pre>AC_CACHE_CHECK([whether pthread should be enabled by default],
  rb_cv_enable_pthread_default,
  [AC_TRY_CPP([</pre>

<p>include &lt;osreldate.h&gt; if __FreeBSD_version &lt; 502102 error pthread
should be disabled on this platform endif</p>

<pre>    ],
    rb_cv_enable_pthread_default=yes,
    rb_cv_enable_pthread_default=no)])
enable_pthread=$rb_cv_enable_pthread_default
],</pre>

<p>[mingw*], [</p>

<pre>enable_pthread=no
],</pre>

<p>[</p>

<pre>enable_pthread=yes
])</pre>

<p>dnl Checks for libraries. <a href=""$target_os"">AS_CASE(</a>,[<strong><a
href="ac_cv_func_daemon=no">bsd|dragonfly*],[],</a></strong>)</p>

<p>AS_UNSET(ORIG_LIBS) POSTLINK=: AC_SUBST(POSTLINK) <a
href=""$target_os"">AS_CASE(</a>, [nextstep*], [  ], [openstep*], [  ],
[rhapsody*], [  ], [darwin*], [</p>

<pre>ORIG_LIBS=&quot;$LIBS&quot;
RUBY_PREPEND_OPTION(LIBS, -lobjc)
RUBY_APPEND_OPTIONS(CPPFLAGS, -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT)
AC_CACHE_CHECK([whether syscall(2) is deprecated], rb_cv_syscall_deprecated,
    [RUBY_WERROR_FLAG([
        AC_TRY_COMPILE([@%:@include &lt;unistd.h&gt;],
                       [if (syscall(0)) return 1;],
            [rb_cv_syscall_deprecated=no],
            [rb_cv_syscall_deprecated=yes])])])
AS_IF([test $rb_cv_syscall_deprecated = yes], [
    ac_cv_func___syscall=no
    ac_cv_func_syscall=no
    ac_cv_header_sys_syscall_h=no
    ac_cv_header_syscall_h=no
])
ac_cv_func_getcontext=no
ac_cv_func_setcontext=no
incs=`$CC -v -E -xc - &lt; /dev/null 2&gt;&amp;1 | sed [&#39;1,/^@%:@include &lt;/d;s/^ *//;s|[^./][^/]*/\.\./||g;/\/include$/!d;s||/lib|;/\/usr\/lib/d&#39;]`
for d in `$CC -print-search-dirs | sed -e &#39;/^libraries: */!d;s///&#39; | tr : &#39;\012&#39; | fgrep -v /../ | sed -n &#39;s|^\(/.*/lib\)/$|\1|p&#39;`; do
    incs=`echo &quot;$incs&quot; | fgrep -v &quot;$d&quot;`
done
for d in $incs; do
    test -d &quot;$d&quot; &amp;&amp; RUBY_APPEND_OPTIONS(LDFLAGS, &quot;-L$d&quot;)
done
ac_cv_type_getgroups=gid_t # getgroups() on Rosetta fills garbage
ac_cv_lib_crypt_crypt=no
ac_cv_func_fdatasync=no # Mac OS X wrongly reports it has fdatasync()
ac_cv_func_vfork=no
AS_IF([test $gcc_major -lt 4 -o \( $gcc_major -eq 4 -a $gcc_minor -lt 3 \)], [
    ac_cv_func___builtin_setjmp=no
])
with_setjmp_type=sigsetjmp # to hijack SIGCHLD handler
AC_CACHE_CHECK(for broken crypt with 8bit chars, rb_cv_broken_crypt,
    [AC_TRY_RUN([</pre>

<p>include &lt;stdio.h&gt; include &lt;unistd.h&gt; include &lt;string.h&gt;</p>

<p>void broken_crypt(const char *salt, const char *buf1, const char *buf2) {
if 0</p>

<pre>printf(&quot;%.2x%.2x: %s -&gt; %s\n&quot;, (unsigned char)salt[0], (unsigned char)salt[1],
       buf1+2, buf2+2);</pre>

<p>endif }</p>

<p>int main() {</p>

<pre>int i;
char salt[2], buf[256], *s;
for (i = 0; i &lt; 128*128; i++) {
    salt[0] = 0x80 | (i &amp; 0x7f);
    salt[1] = 0x80 | (i &gt;&gt; 7);
    strcpy(buf, crypt(&quot;&quot;, salt));
    if (strcmp(buf, s = crypt(&quot;&quot;, salt))) {
        broken_crypt(salt, buf, s);
        return 1;
    }
}
salt[0] = salt[1] = &#39; &#39;;
strcpy(buf, crypt(&quot;&quot;, salt));
salt[0] = salt[1] = 0x80 | &#39; &#39;;
if (strcmp(buf, s = crypt(&quot;&quot;, salt))) {
    broken_crypt(salt, buf, s);
    return 1;
}
return 0;</pre>

<p>} ],</p>

<pre>    rb_cv_broken_crypt=no,
    rb_cv_broken_crypt=yes,
    rb_cv_broken_crypt=yes)])
AS_IF([test &quot;$rb_cv_broken_crypt&quot; = yes], [
   AC_DEFINE(BROKEN_CRYPT, 1)
])
POSTLINK=&quot;&quot;
AC_CHECK_PROGS(codesign, codesign)
AC_CHECK_PROGS(dsymutil, dsymutil)
AS_IF([test -n &quot;$codesign&quot;], [
    POSTLINK=&quot;{ test -z &#39;\$(RUBY_CODESIGN)&#39; || $codesign -s &#39;\$(RUBY_CODESIGN)&#39; -f \$@; }${POSTLINK:+; $POSTLINK}&quot;
])
AS_IF([test -n &quot;$dsymutil&quot;], [
    POSTLINK=&quot;$dsymutil \$@${POSTLINK:+; $POSTLINK}&quot;
])
AS_IF([test -n &quot;${POSTLINK}&quot;], [
    LINK_SO=&quot;$LINK_SO</pre>

<p>$(POSTLINK)“</p>

<pre>])
AC_CHECK_HEADERS(crt_externs.h, [], [], [
    #include &lt;crt_externs.h&gt;
])
],</pre>

<p>[hpux*], [      LIBS=“-lm $LIBS”</p>

<pre>ac_cv_c_inline=no],</pre>

<p>[solaris*], [   LIBS=“-lm $LIBS”</p>

<pre>ac_cv_func_vfork=no
AC_MSG_CHECKING(whether _XOPEN_SOURCE is already given)
AC_TRY_COMPILE([#include &lt;unistd.h&gt;
        #ifndef _XOPEN_SOURCE
        #error _XOPEN_SOURCE is not defined
        #endif
        ], [],
        [given_xopen_source=yes], [given_xopen_source=no])
AC_MSG_RESULT($given_xopen_source)
AS_IF([test $given_xopen_source = no], [
  AC_MSG_CHECKING(appropriate _XOPEN_SOURCE value to define)
  define_xopen_source=&quot;&quot;
  for tmp_xpg in 7 6 5; do
    AS_IF([test x&quot;$define_xopen_source&quot; != x], [
      break
    ])
    RUBY_WERROR_FLAG([AC_TRY_COMPILE([
        #define _XOPEN_SOURCE ${tmp_xpg}00
        #include &lt;unistd.h&gt;
        #ifndef _XPG${tmp_xpg}
        #error _XPG${tmp_xpg} should be defined by _XOPEN_SOURCE=${tmp_xpg}00
        #endif
        ], [],
        [define_xopen_source=${tmp_xpg}00], [])
        ])
  done
  AS_IF([test x&quot;$define_xopen_source&quot; = x], [
    define_xopen_source=no
  ])
  AC_MSG_RESULT($define_xopen_source)
  AS_IF([test x&quot;$define_xopen_source&quot; != xno], [
    RUBY_APPEND_OPTIONS(CPPFLAGS, -D_XOPEN_SOURCE=$define_xopen_source)
  ])
])
],</pre>

<p>[haiku*], [</p>

<pre>LIBS=&quot;$LIBS&quot; # m lib is include in root
],</pre>

<p>[cygwin*], [    ac_cv_header_langinfo_h=yes</p>

<pre>RUBY_APPEND_OPTIONS(CPPFLAGS, -D_XOPEN_SOURCE -D_GNU_SOURCE)
AC_CHECK_FUNCS(cygwin_conv_path)
AC_LIBOBJ([langinfo])
],</pre>

<p>[mingw*], [     LIBS=“-lshell32 -lws2_32 -liphlpapi -limagehlp -lshlwapi
$LIBS”</p>

<pre>ac_cv_header_a_out_h=no
ac_cv_header_pwd_h=no
ac_cv_header_utime_h=no
ac_cv_header_sys_ioctl_h=no
ac_cv_header_sys_param_h=no
ac_cv_header_sys_resource_h=no
ac_cv_header_sys_select_h=no
ac_cv_header_sys_time_h=no
ac_cv_header_sys_times_h=no
ac_cv_header_sys_socket_h=no
ac_cv_func_lstat=yes
ac_cv_func_times=yes
ac_cv_func_waitpid=yes
ac_cv_func_fsync=yes
ac_cv_func_seekdir=yes
ac_cv_func_telldir=yes
ac_cv_func_lchown=yes
ac_cv_func_link=yes
ac_cv_func_readlink=yes
ac_cv_func_symlink=yes
ac_cv_lib_crypt_crypt=no
ac_cv_func_getpgrp_void=no
ac_cv_func_memcmp_working=yes
ac_cv_lib_dl_dlopen=no
rb_cv_binary_elf=no
rb_cv_negative_time_t=no
ac_cv_func_fcntl=yes
ac_cv_func_flock=yes
ac_cv_func_gmtime_r=yes
rb_cv_large_fd_select=yes
ac_cv_type_struct_timeval=yes
ac_cv_func_clock_gettime=yes
ac_cv_func_clock_getres=yes
ac_cv_func_malloc_usable_size=no
ac_cv_type_off_t=yes
ac_cv_sizeof_off_t=8
AS_IF([test &quot;$target_cpu&quot; = x64], [
    ac_cv_func___builtin_setjmp=yes
    ac_cv_func_round=no
    rb_cv_coroutine=yes
])
ac_cv_func_tgamma=no
rb_cv_negative_time_t=yes
AC_CHECK_TYPE([NET_LUID], [], [],
              [@%:@include &lt;winsock2.h&gt;
              @%:@include &lt;iphlpapi.h&gt;])
AS_IF([test x&quot;$ac_cv_type_NET_LUID&quot; = xyes], [
    AC_DEFINE(HAVE_TYPE_NET_LUID, 1)
])
AC_CHECK_FUNCS(_gmtime64_s)
AC_CHECK_FUNCS(_wfreopen_s)
AC_LIBOBJ([langinfo])
],</pre>

<p>[bsdi*], [      LIBS=“-lm $LIBS”</p>

<pre>AC_DEFINE(BROKEN_SETREUID, 1)
AC_DEFINE(BROKEN_SETREGID, 1)
ac_cv_sizeof_rlim_t=8],</pre>

<p>[freebsd*], [   LIBS=“-lm $LIBS”</p>

<pre>ac_cv_func_getpeername=no
ac_cv_func_getsockname=no
ac_cv_func_shutdown=no
ac_cv_func_close=no
],</pre>

<p>[netbsd*], [    LIBS=“-lm $LIBS”</p>

<pre>],</pre>

<p>[dragonfly*], [ LIBS=“-lm $LIBS”</p>

<pre>],</pre>

<p>[aix*],[        LIBS=“-lm $LIBS”</p>

<pre>ac_cv_func_round=no
ac_cv_func___builtin_setjmp=no
],</pre>

<p>[linux*],[      LIBS=“-lm $LIBS”</p>

<pre># __builtin_longjmp in ppc64* Linux does not restore
# the TOC register (r2), which is problematic
# when a global exit happens from JITted .so code.
AS_CASE([&quot;$target_cpu&quot;], [powerpc64*], [
        ac_cv_func___builtin_setjmp=no
])
# With gcc-8&#39;s -fcf-protection, MJIT&#39;s __builtin_longjmp fails.
AS_CASE([&quot;$CC $CFLAGS &quot;], [*&quot; -fcf-protection &quot;*], [cf_protection=yes], [cf_protection=no])
AS_IF([test &quot;$cf_protection&quot; = yes], [
        ac_cv_func___builtin_setjmp=no
])
],</pre>

<p>[       LIBS=“-lm $LIBS”]) : ${ORIG_LIBS=$LIBS}</p>

<p>AC_CHECK_LIB(crypt, crypt)      # glibc (GNU/Linux, GNU/Hurd, GNU/kFreeBSD)
AC_CHECK_LIB(dl, dlopen)        # Dynamic linking for SunOS/Solaris and
SYSV AC_CHECK_LIB(dld, shl_load)     # Dynamic linking for HP-UX
AC_CHECK_LIB(socket, shutdown)  # SunOS/Solaris</p>

<p>dnl Checks for header files. AC_HEADER_DIRENT dnl AC_HEADER_STDC has been
checked in AC_USE_SYSTEM_EXTENSIONS AC_HEADER_STDBOOL AC_HEADER_SYS_WAIT</p>

<p>AC_CHECK_HEADERS(a.out.h) AC_CHECK_HEADERS(atomic.h)
AC_CHECK_HEADERS(copyfile.h) AC_CHECK_HEADERS(direct.h)
AC_CHECK_HEADERS(grp.h) AC_CHECK_HEADERS(fcntl.h) AC_CHECK_HEADERS(float.h)
AC_CHECK_HEADERS(ieeefp.h) AC_CHECK_HEADERS(intrinsics.h)
AC_CHECK_HEADERS(langinfo.h) AC_CHECK_HEADERS(limits.h)
AC_CHECK_HEADERS(locale.h) AC_CHECK_HEADERS(malloc.h)
AC_CHECK_HEADERS(malloc/malloc.h) AC_CHECK_HEADERS(malloc_np.h)
AC_CHECK_HEADERS(net/socket.h) AC_CHECK_HEADERS(process.h)
AC_CHECK_HEADERS(pwd.h) AC_CHECK_HEADERS(sanitizer/asan_interface.h)
AC_CHECK_HEADERS(sanitizer/msan_interface.h) AC_CHECK_HEADERS(setjmpex.h)
AC_CHECK_HEADERS(stdalign.h) AC_CHECK_HEADERS(sys/attr.h)
AC_CHECK_HEADERS(sys/eventfd.h) AC_CHECK_HEADERS(sys/fcntl.h)
AC_CHECK_HEADERS(sys/file.h) AC_CHECK_HEADERS(sys/id.h)
AC_CHECK_HEADERS(sys/ioctl.h) AC_CHECK_HEADERS(sys/mkdev.h)
AC_CHECK_HEADERS(sys/param.h) AC_CHECK_HEADERS(sys/prctl.h)
AC_CHECK_HEADERS(sys/resource.h) AC_CHECK_HEADERS(sys/select.h)
AC_CHECK_HEADERS(sys/sendfile.h) AC_CHECK_HEADERS(sys/socket.h)
AC_CHECK_HEADERS(sys/syscall.h) AC_CHECK_HEADERS(sys/sysmacros.h)
AC_CHECK_HEADERS(sys/time.h) AC_CHECK_HEADERS(sys/times.h)
AC_CHECK_HEADERS(sys/uio.h) AC_CHECK_HEADERS(sys/utime.h)
AC_CHECK_HEADERS(syscall.h) AC_CHECK_HEADERS(time.h)
AC_CHECK_HEADERS(ucontext.h) AC_CHECK_HEADERS(utime.h)</p>

<p><a href="gmp">AC_ARG_WITH(</a>,</p>

<pre>[AS_HELP_STRING([--without-gmp],
  [disable GNU GMP to accelerate Bignum operations])],
[],
[with_gmp=yes])</pre>

<p>AS_IF([test “x$with_gmp” != xno],</p>

<pre>[AC_CHECK_HEADERS(gmp.h)
 AS_IF([test &quot;x$ac_cv_header_gmp_h&quot; != xno],
   AC_SEARCH_LIBS([__gmpz_init], [gmp],
     [AC_DEFINE(HAVE_LIBGMP, 1)]))])</pre>

<p><a href="jemalloc">AC_ARG_WITH(</a>,</p>

<pre>[AS_HELP_STRING([--with-jemalloc],[use jemalloc allocator])],
[with_jemalloc=$withval], [with_jemalloc=no])</pre>

<p>AS_IF([test “x$with_jemalloc” != xno],[</p>

<pre>AC_SEARCH_LIBS([malloc_conf], [jemalloc],
  [
    AC_DEFINE(HAVE_LIBJEMALLOC, 1)
    with_jemalloc=yes
  ],
  [test x$with_jemalloc = xyes &amp;&amp; with_jemalloc=no])
AC_CHECK_HEADER(jemalloc/jemalloc.h, [
  AC_DEFINE(RUBY_ALTERNATIVE_MALLOC_HEADER, [&lt;jemalloc/jemalloc.h&gt;])
],
[test x$with_jemalloc = xyes &amp;&amp; with_jemalloc=no])
AS_IF([test &quot;x$with_jemalloc&quot; != xyes], [
  AC_CACHE_CHECK([for jemalloc with JEMALLOC_MANGLE], rb_cv_jemalloc_demangle,
    [AC_LINK_IFELSE([AC_LANG_PROGRAM([@%:@define JEMALLOC_MANGLE 1
    @%:@ifdef RUBY_ALTERNATIVE_MALLOC_HEADER
    @%:@include RUBY_ALTERNATIVE_MALLOC_HEADER
    @%:@else
    @%:@include &lt;jemalloc.h&gt;
    @%:@endif], [return !&amp;malloc_conf])],
    [rb_cv_jemalloc_demangle=yes],
    [rb_cv_jemalloc_demangle=no])
  ])
])
AS_IF([test &quot;x$rb_cv_jemalloc_demangle&quot; = xyes], [
  AC_DEFINE(JEMALLOC_MANGLE)
  with_jemalloc=yes
])
AS_CASE([&quot;$with_jemalloc&quot;],
  [yes],
  [
    AC_DEFINE(HAVE_MALLOC_CONF)
    ac_cv_func_malloc_usable_size=yes
  ],
  [no],
  [AC_MSG_ERROR([jemalloc requested but not found])
])</pre>

<p>])</p>

<p>dnl check for large file stuff mv confdefs.h confdefs1.h : &gt; confdefs.h
AC_SYS_LARGEFILE # On 32-bit Solaris, it is safe to define
_LARGEFILE_SOURCE # which is not added by AC_SYS_LARGEFILE. AS_IF([test
x“$enable_largefile” != xno], [</p>

<pre>AS_CASE([&quot;$target_os&quot;], [solaris*], [
  AC_MSG_CHECKING([wheather _LARGEFILE_SOURCE should be defined])
  AS_CASE([&quot;${ac_cv_sys_file_offset_bits}:${ac_cv_sys_large_files}&quot;],
    [&quot;64:&quot;|&quot;64:no&quot;|&quot;64:unknown&quot;], [
      # insert _LARGEFILE_SOURCE before _FILE_OFFSET_BITS line
      # that is the same order as &quot;getconf LFS_CFLAGS&quot; output
      mv confdefs.h largefile0.h
      : &gt; confdefs.h
      AC_DEFINE(_LARGEFILE_SOURCE)
      cat largefile0.h &gt;&gt; confdefs.h
      rm largefile0.h
      AC_MSG_RESULT([yes])
    ], [AC_MSG_RESULT([no])])
])</pre>

<p>]) mv confdefs.h largefile.h mv confdefs1.h confdefs.h cat largefile.h
&gt;&gt; confdefs.h</p>

<p><a href=""$target_os"">AS_CASE(</a>,</p>

<pre>[aix*], [
AS_CASE([&quot;$target_cpu:$ac_cv_sys_large_files&quot;],
    [ppc64:*|powerpc64:*], [],
    [*:no|*:unknown], [],
    [
        # AIX currently does not support a 32-bit call to posix_fadvise()
        # if _LARGE_FILES is defined.
        ac_cv_func_posix_fadvise=no
    ])
])</pre>

<p>AC_C_BIGENDIAN AC_C_CONST AC_C_CHAR_UNSIGNED AC_C_INLINE AC_C_VOLATILE
AC_C_TYPEOF AC_C_RESTRICT</p>

<p>AS_CASE(“:$ac_cv_c_const:$ac_cv_c_volatile:”,</p>

<pre>[*:no:*], [AC_MSG_ERROR(ANSI C-conforming const and volatile are mandatory)])</pre>

<p>AC_CHECK_TYPES([long long, off_t])</p>

<p>AC_CACHE_CHECK([char bit], [rb_cv_char_bit],</p>

<pre>[test &quot;$universal_binary&quot; = yes &amp;&amp; cross_compiling=yes
AC_COMPUTE_INT([rb_cv_char_bit], [CHAR_BIT],
    [AC_INCLUDES_DEFAULT([@%:@include &lt;limits.h&gt;])], [rb_cv_char_bit=8])
test &quot;$universal_binary&quot; = yes &amp;&amp; cross_compiling=$real_cross_compiling])</pre>

<p>RUBY_CHECK_SIZEOF(int, [], [ILP]) RUBY_CHECK_SIZEOF(short)
RUBY_CHECK_SIZEOF(long, [int], [ILP LP]) RUBY_CHECK_SIZEOF(long long)
RUBY_CHECK_SIZEOF(__int64, [8], [ILP LP]) RUBY_CHECK_SIZEOF(__int128, [16],
[ILP LP]) RUBY_CHECK_SIZEOF(off_t) RUBY_CHECK_SIZEOF(void*, [int long “long
long”], [ILP LP LLP]) RUBY_CHECK_SIZEOF(float) RUBY_CHECK_SIZEOF(double)
RUBY_CHECK_SIZEOF(time_t, [long “long long”], [], [@%:@include
&lt;time.h&gt;]) RUBY_CHECK_SIZEOF(clock_t, [], [], [@%:@include
&lt;time.h&gt;])</p>

<p>AC_CACHE_CHECK(packed struct attribute, rb_cv_packed_struct,</p>

<pre>[rb_cv_packed_struct=no
for mac in \
    &quot;__pragma(pack(push, 1)) x __pragma(pack(pop))&quot; \
    &quot;x __attribute__((packed))&quot; \
    ; do
    AC_TRY_COMPILE([@%:@define PACKED_STRUCT(x) $mac
                    PACKED_STRUCT(struct { int a; });], [],
            [rb_cv_packed_struct=$mac; break])
done])</pre>

<p>AS_IF([test “$rb_cv_packed_struct” != no], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE_UNQUOTED</span>([<span class="ruby-constant">PACKED_STRUCT</span>(<span class="ruby-identifier">x</span>)], [<span class="ruby-identifier">$rb_cv_packed_struct</span>])
<span class="ruby-constant">RUBY_TRY_CFLAGS</span>(<span class="ruby-operator">-</span><span class="ruby-constant">Wno</span><span class="ruby-operator">-</span><span class="ruby-identifier">address</span><span class="ruby-operator">-</span><span class="ruby-identifier">of</span><span class="ruby-operator">-</span><span class="ruby-identifier">packed</span><span class="ruby-operator">-</span><span class="ruby-identifier">member</span>, [<span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">USE_UNALIGNED_MEMBER_ACCESS</span>)])
</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE_UNQUOTED</span>([<span class="ruby-constant">PACKED_STRUCT</span>(<span class="ruby-identifier">x</span>)], <span class="ruby-identifier">x</span>)
</pre>

<p>])</p>

<p>AS_IF([test “x$ac_cv_type_long_long” = xyes], [</p>

<pre>RUBY_CHECK_PRINTF_PREFIX(long long, ll I64, LL)</pre>

<p>], [test “x$ac_cv_type___int64” = xyes], [</p>

<pre>RUBY_CHECK_PRINTF_PREFIX(__int64, ll I64, LL)</pre>

<p>])</p>

<p>RUBY_REPLACE_TYPE(pid_t, int, PIDT) RUBY_REPLACE_TYPE(uid_t, int, UIDT)
RUBY_REPLACE_TYPE(gid_t, int, GIDT) RUBY_REPLACE_TYPE(time_t, [], TIMET,
[@%:@include &lt;time.h&gt;]) RUBY_REPLACE_TYPE(dev_t, [int long “long
long”], DEVT) RUBY_REPLACE_TYPE(mode_t, [“unsigned short” “unsigned int”
long], MODET, [@%:@include &lt;sys/stat.h&gt;]) RUBY_REPLACE_TYPE(rlim_t,
[int long “long long”], RLIM, [ @%:@ifdef HAVE_SYS_TYPES_H @%:@include
&lt;sys/types.h&gt; @%:@endif @%:@ifdef HAVE_SYS_TYPES_H @%:@include
&lt;sys/time.h&gt; @%:@endif @%:@include &lt;sys/resource.h&gt; ])
RUBY_REPLACE_TYPE(off_t, [], OFFT) RUBY_REPLACE_TYPE(clockid_t, [],
CLOCKID, [@%:@ifdef HAVE_TIME_H @%:@ include &lt;time.h&gt; @%:@endif
@%:@ifdef HAVE_SYS_TIME_H @%:@ include &lt;sys/time.h&gt; @%:@endif])</p>

<p>AC_CACHE_CHECK(for prototypes, rb_cv_have_prototypes,</p>

<pre>[AC_TRY_COMPILE([int foo(int x) { return 0; }], [return foo(10);],
      rb_cv_have_prototypes=yes,
      rb_cv_have_prototypes=no)])</pre>

<p>AS_IF([test “$rb_cv_have_prototypes” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_PROTOTYPES</span>)
</pre>

<p>])</p>

<p>AC_CACHE_CHECK(token paste string, rb_cv_tokenpaste,</p>

<pre>[AC_TRY_COMPILE([@%:@define paste(a,b) a@%:@@%:@b],
                [int xy = 1; return paste(x,y);],
                rb_cv_tokenpaste=ansi,
                rb_cv_tokenpaste=knr)])</pre>

<p>AS_IF([test “$rb_cv_tokenpaste” = ansi], [</p>

<pre>AC_DEFINE(TOKEN_PASTE(x,y),[x@%:@@%:@y])</pre>

<p>], [</p>

<pre>AC_DEFINE(TOKEN_PASTE(x,y),[x   /y])</pre>

<p>])</p>

<p>AC_CACHE_CHECK(stringization, rb_cv_stringization, [</p>

<pre>rb_cv_stringization=no
for string in &quot;#expr&quot; &#39;&quot;expr&quot;&#39;; do
  AC_COMPILE_IFELSE([
    AC_LANG_BOOL_COMPILE_TRY([</pre>

<p>define STRINGIZE0(expr) $string define STRINGIZE(expr) STRINGIZE0(expr)
undef real_test_for_stringization define test_for_stringization
-.real_test_for_stringization.- const char <a href="">stringized[</a>] =
STRINGIZE(test_for_stringization); ], [sizeof(stringized) == 32])],</p>

<pre>    [rb_cv_stringization=&quot;$string&quot;; break],
    [rb_cv_stringization=no])
done]</pre>

<p>) AC_DEFINE(STRINGIZE(expr),STRINGIZE0(expr)) AS_IF([test
x“$rb_cv_stringization” != xno -a “$rb_cv_stringization” != “#expr”], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE_UNQUOTED</span>(<span class="ruby-constant">STRINGIZE0</span>(<span class="ruby-identifier">expr</span>),<span class="ruby-identifier">$rb_cv_stringization</span>)
<span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">OLD_FASHIONED_STRINGIZATION</span>,<span class="ruby-value">1</span>)
</pre>

<p>])</p>

<p>AC_CACHE_CHECK([string literal concatenation],</p>

<pre>rb_cv_string_literal_concatenation, [
AC_COMPILE_IFELSE([
  AC_LANG_BOOL_COMPILE_TRY([</pre>

<p>const char <a href="">concatenated_literal[</a>] = “literals” “to”</p>

<pre class="ruby"><span class="ruby-string">&quot;be&quot;</span> <span class="ruby-string">&quot;concatenated.&quot;</span>;
</pre>

<p>], [sizeof(concatenated_literal) == 26])],</p>

<pre>[rb_cv_string_literal_concatenation=yes],
[rb_cv_string_literal_concatenation=no])]</pre>

<p>) AS_IF([test “$rb_cv_string_literal_concatenation” = no], [</p>

<pre>AC_MSG_ERROR([No string literal concatenation])</pre>

<p>])</p>

<p>AC_CACHE_CHECK(for variable length prototypes and stdarg.h, rb_cv_stdarg,</p>

<pre>[AC_TRY_COMPILE([</pre>

<p>include &lt;stdarg.h&gt; int foo(int x, …) {</p>

<pre>va_list va;
va_start(va, x);
va_arg(va, int);
va_arg(va, char *);
va_arg(va, double);
return 0;</pre>

<p>} ], [return foo(10, “”, 3.14);],</p>

<pre>rb_cv_stdarg=yes,
rb_cv_stdarg=no)])</pre>

<p>AS_IF([test “$rb_cv_stdarg” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_STDARG_PROTOTYPES</span>)
</pre>

<p>])</p>

<p>AC_CACHE_CHECK(for variable length macro, rb_cv_va_args_macro,</p>

<pre>[AC_TRY_COMPILE([</pre>

<p>int foo(int x, …); @%:@define FOO(a, …) foo(a, @%:@@%:@<em>VA_ARGS</em>) ],
[FOO(1);FOO(1,2);FOO(1,2,3);],</p>

<pre>rb_cv_va_args_macro=yes,
rb_cv_va_args_macro=no)])</pre>

<p>AS_IF([test “$rb_cv_va_args_macro” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_VA_ARGS_MACRO</span>)
</pre>

<p>])</p>

<p>AC_CACHE_CHECK([for alignas() syntax], rb_cv_have_alignas, [
rb_cv_have_alignas=no RUBY_WERROR_FLAG([ for attr in \</p>

<pre>&quot;_Alignas(x)&quot; \
&quot;alignas(x)&quot; \
&quot;@&lt;:@@&lt;:@alignas(x)@:&gt;@@:&gt;@&quot; \
&quot;__declspec(aligned(x))&quot; \
&quot;__attribute__((__aligned__(x)))&quot; \</pre>

<p>; do</p>

<pre># C11 _Alignas and GCC __attribute__((__aligned__)) behave
# slightly differently.  What we want is GCC&#39;s.  Check that
# here by something C11 does not allow (`struct ALIGNAS ...`)
AC_TRY_COMPILE(
    [@%:@define ALIGNAS(x) $attr
    struct ALIGNAS(128) conftest_tag { int foo; } foo; ], [],
    [rb_cv_have_alignas=&quot;$attr&quot;; break], [])</pre>

<p>done ])]) AS_IF([test “$rb_cv_have_alignas” != no], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE_UNQUOTED</span>([<span class="ruby-constant">RUBY_ALIGNAS</span>(<span class="ruby-identifier">x</span>)], <span class="ruby-identifier">$rb_cv_have_alignas</span>)
</pre>

<p>])</p>

<p>AC_CACHE_CHECK([for alignof() syntax], rb_cv_have_alignof,[
rb_cv_have_alignof=no RUBY_WERROR_FLAG([ for expr in \</p>

<pre>&quot;alignof&quot; \
&quot;_Alignof&quot; \
&quot;__alignof&quot; \
&quot;__alignof__&quot; \</pre>

<p>; do</p>

<pre>AC_TRY_COMPILE([
@%:@ifdef HAVE_STDALIGN_H
@%:@include &lt;stdalign.h&gt;
@%:@endif],[return (int)$expr(int);],
    [rb_cv_have_alignof=&quot;$expr&quot;; break], [])</pre>

<p>done ])]) AS_IF([test “$rb_cv_have_alignof” != no], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE_UNQUOTED</span>(<span class="ruby-constant">RUBY_ALIGNOF</span>, <span class="ruby-identifier">$rb_cv_have_alignof</span>)
</pre>

<p>])</p>

<p>RUBY_FUNC_ATTRIBUTE(__const__, CONSTFUNC) RUBY_FUNC_ATTRIBUTE(__pure__,
PUREFUNC) RUBY_FUNC_ATTRIBUTE(__noreturn__, NORETURN)
RUBY_FUNC_ATTRIBUTE(__deprecated__, DEPRECATED)
RUBY_FUNC_ATTRIBUTE(__deprecated__(“by ”@%:@n), DEPRECATED_BY(n,x),
rb_cv_func_deprecated_by) RUBY_TYPE_ATTRIBUTE(__deprecated__ mesg,
DEPRECATED_TYPE(mesg,x), rb_cv_type_deprecated)
RUBY_FUNC_ATTRIBUTE(__noinline__, NOINLINE)
RUBY_FUNC_ATTRIBUTE(<em>always_inline</em>, ALWAYS_INLINE)
RUBY_FUNC_ATTRIBUTE(<em>no_sanitize</em>(san), NO_SANITIZE(san, x),
rb_cv_func_no_sanitize) RUBY_FUNC_ATTRIBUTE(<em>no_sanitize_address</em>,
NO_SANITIZE_ADDRESS)
RUBY_FUNC_ATTRIBUTE(<em>no_address_safety_analysis</em>,
NO_ADDRESS_SAFETY_ANALYSIS)
RUBY_FUNC_ATTRIBUTE(<em>warn_unused_result</em>, WARN_UNUSED_RESULT)
RUBY_FUNC_ATTRIBUTE(__unused__, MAYBE_UNUSED) RUBY_FUNC_ATTRIBUTE(__error__
mesg, ERRORFUNC(mesg,x), rb_cv_func___error__)
RUBY_FUNC_ATTRIBUTE(__warning__ mesg, WARNINGFUNC(mesg,x),
rb_cv_func___warning__) RUBY_FUNC_ATTRIBUTE(__weak__, WEAK,
rb_cv_func_weak) AS_IF([test “$rb_cv_func_weak” != x], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_FUNC_WEAK</span>)
</pre>

<p>])</p>

<p>AC_CACHE_CHECK([for __attribute__((__depreacted__(msg))) in C++],</p>

<pre>rb_cv_CentOS6_CXX_workaround,
RUBY_WERROR_FLAG([
  AC_LANG_PUSH([C++])
  AC_COMPILE_IFELSE(
    [AC_LANG_PROGRAM(
      [],
      [__attribute__((__deprecated__(&quot;message&quot;))) int conftest(...);])],
    [rb_cv_CentOS6_CXX_workaround=yes],
    [rb_cv_CentOS6_CXX_workaround=no])
  AC_LANG_POP()]))</pre>

<p>AS_IF([test “$rb_cv_CentOS6_CXX_workaround” != no],[</p>

<pre>AC_DEFINE([RUBY_CXX_DEPRECATED(msg)],
  [__attribute__((__deprecated__(msg)))])])</pre>

<p>if_i386=${universal_binary+[defined <em>i386</em>]}
RUBY_FUNC_ATTRIBUTE(__stdcall__,  FUNC_STDCALL,  rb_cv_func_stdcall, 
${if_i386}) RUBY_FUNC_ATTRIBUTE(__cdecl__,    FUNC_CDECL,   
rb_cv_func_cdecl,    ${if_i386}) RUBY_FUNC_ATTRIBUTE(__fastcall__,
FUNC_FASTCALL, rb_cv_func_fastcall, ${if_i386})
RUBY_FUNC_ATTRIBUTE(__optimize__(“O0”), FUNC_UNOPTIMIZED,
rb_cv_func_unoptimized)
RUBY_FUNC_ATTRIBUTE(__optimize__(“-Os”,“-fomit-frame-pointer”),
FUNC_MINIMIZED, rb_cv_func_minimized)</p>

<p>AS_IF([test “$GCC” = yes], [</p>

<pre>AC_CACHE_CHECK([for function alias], [rb_cv_gcc_function_alias],
    [rb_cv_gcc_function_alias=no
    for a in alias weak,alias; do
        AC_TRY_LINK([void foo(void) {}
            void bar(void) __attribute__(($a(&quot;foo&quot;)));], [bar()],
            [rb_cv_gcc_function_alias=$a; break])
    done])
AS_IF([test &quot;$rb_cv_gcc_function_alias&quot; != no], [
    AC_DEFINE(HAVE_ATTRIBUTE_FUNCTION_ALIAS)
    AC_DEFINE_UNQUOTED([RUBY_ALIAS_FUNCTION_TYPE(type, prot, name, args)],
                       [type prot __attribute__(($rb_cv_gcc_function_alias(@%:@name)));])
    AC_DEFINE_UNQUOTED([RUBY_ALIAS_FUNCTION_VOID(prot, name, args)],
                       [RUBY_ALIAS_FUNCTION_TYPE(void, prot, name, args)])
])

AC_CACHE_CHECK([for __atomic builtins], [rb_cv_gcc_atomic_builtins], [
    AC_TRY_LINK([unsigned char atomic_var;],
                [
                    __atomic_exchange_n(&amp;atomic_var, 0, __ATOMIC_SEQ_CST);
                    __atomic_exchange_n(&amp;atomic_var, 1, __ATOMIC_SEQ_CST);
                    __atomic_fetch_add(&amp;atomic_var, 1, __ATOMIC_SEQ_CST);
                    __atomic_fetch_sub(&amp;atomic_var, 1, __ATOMIC_SEQ_CST);
                    __atomic_or_fetch(&amp;atomic_var, 1, __ATOMIC_SEQ_CST);
                ],
                [rb_cv_gcc_atomic_builtins=yes],
                [rb_cv_gcc_atomic_builtins=no])])
AS_IF([test &quot;$rb_cv_gcc_atomic_builtins&quot; = yes], [
    AC_DEFINE(HAVE_GCC_ATOMIC_BUILTINS)
])

AC_CACHE_CHECK([for __sync builtins], [rb_cv_gcc_sync_builtins], [
    AC_TRY_LINK([unsigned char atomic_var;],
                [
                    __sync_lock_test_and_set(&amp;atomic_var, 0);
                    __sync_lock_test_and_set(&amp;atomic_var, 1);
                    __sync_fetch_and_add(&amp;atomic_var, 1);
                    __sync_fetch_and_sub(&amp;atomic_var, 1);
                    __sync_or_and_fetch(&amp;atomic_var, 1);
                    __sync_val_compare_and_swap(&amp;atomic_var, 0, 1);
                ],
                [rb_cv_gcc_sync_builtins=yes],
                [rb_cv_gcc_sync_builtins=no])])
AS_IF([test &quot;$rb_cv_gcc_sync_builtins&quot; = yes], [
    AC_DEFINE(HAVE_GCC_SYNC_BUILTINS)
])

AC_CACHE_CHECK(for __builtin_unreachable, rb_cv_func___builtin_unreachable,
[RUBY_WERROR_FLAG(
[AC_TRY_LINK([volatile int zero;],
    [if (zero) __builtin_unreachable();],
    [rb_cv_func___builtin_unreachable=yes],
    [rb_cv_func___builtin_unreachable=no])
])
])
AS_IF([test &quot;$rb_cv_func___builtin_unreachable&quot; = yes], [
    AC_DEFINE_UNQUOTED(UNREACHABLE, [__builtin_unreachable()])
])</pre>

<p>])</p>

<p>AC_CACHE_CHECK(for exported function attribute, rb_cv_func_exported, [
rb_cv_func_exported=no RUBY_WERROR_FLAG([ for mac in &#39;__attribute__
((__visibility__(“default”)))&#39; &#39;__declspec(dllexport)&#39;; do</p>

<pre>AC_TRY_COMPILE([@%:@define RUBY_FUNC_EXPORTED $mac extern
  RUBY_FUNC_EXPORTED void conftest_attribute_check(void);], [],
  [rb_cv_func_exported=&quot;$mac&quot;; break])</pre>

<p>done ])]) AS_IF([test “$rb_cv_func_exported” != no], [</p>

<pre>AC_DEFINE_UNQUOTED(RUBY_FUNC_EXPORTED, [$rb_cv_func_exported extern])</pre>

<p>]) <a href="__nonnull__(n)">RUBY_DECL_ATTRIBUTE(</a>,
[RUBY_FUNC_NONNULL(n,x)], [rb_cv_func_nonnull],</p>

<pre>[], [function], [</pre>

<p>@%:@define x int conftest_attribute_check(void *p) @%:@define n 1 ])</p>

<p>RUBY_APPEND_OPTION(XCFLAGS, -DRUBY_EXPORT)</p>

<p>AC_ARG_ENABLE(mathn,</p>

<pre>AS_HELP_STRING([--disable-mathn], [disable canonicalization for mathn]),
[mathn=$enableval], [mathn=yes])</pre>

<p>test “x$mathn” = xyes || mathn= AC_SUBST(MATHN, $mathn)</p>

<p>AC_CACHE_CHECK(for function name string predefined identifier,</p>

<pre>rb_cv_function_name_string,
[rb_cv_function_name_string=no
RUBY_WERROR_FLAG([
    for func in __func__ __FUNCTION__; do
        AC_TRY_LINK([@%:@include &lt;stdio.h&gt;],
                    [puts($func);],
                    [rb_cv_function_name_string=$func
                    break])
    done
])]</pre>

<p>) AS_IF([test “$rb_cv_function_name_string” != no], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE_UNQUOTED</span>(<span class="ruby-constant">RUBY_FUNCTION_NAME_STRING</span>, [<span class="ruby-identifier">$rb_cv_function_name_string</span>])
</pre>

<p>])</p>

<p>AC_CACHE_CHECK(if enum over int is allowed, rb_cv_enum_over_int, [</p>

<pre>rb_cv_enum_over_int=no
AS_IF([test &quot;x$ac_cv_type_long_long&quot; = xyes], [
    type=&quot;unsigned long long&quot; max=&quot;ULLONG_MAX&quot;
], [
    type=&quot;unsigned long&quot; max=&quot;ULONG_MAX&quot;
])
RUBY_WERROR_FLAG([
    AC_COMPILE_IFELSE([
        AC_LANG_BOOL_COMPILE_TRY([
                @%:@include &lt;limits.h&gt;
                enum {conftest_max = $max};
            ], [
                (conftest_max == $max) &amp;&amp;
                (sizeof(conftest_max) == sizeof($type))
            ]
        )],
        [rb_cv_enum_over_int=yes],
        [rb_cv_enum_over_int=no]
    )
])</pre>

<p>]) AS_IF([test $rb_cv_enum_over_int = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">ENUM_OVER_INT</span>, <span class="ruby-value">1</span>)
</pre>

<p>])</p>

<p>dnl Check whether we need to define sys_nerr locally <a
href="sys_nerr">AC_CHECK_DECLS(</a>, [], [], [$ac_includes_default
@%:@include &lt;errno.h&gt;])</p>

<p><a href="getenv">AC_CHECK_DECLS(</a>)</p>

<p><a href=""$target_cpu"">AS_CASE(</a>, [alpha*|sh4|sh4el|sh4eb], [<a
href=""$target_os"::"$GCC"">AS_CASE(</a>,</p>

<pre>[*::yes],  # gcc
        [CFLAGS=&quot;-mieee $CFLAGS&quot;],
[osf*],    # ccc
        [CFLAGS=&quot;-ieee $CFLAGS&quot;],
)],</pre>

<p>[sparc*], [<a href="sparc">AC_LIBOBJ(</a>)])</p>

<p>ac_cv_header_net_socket_h=${ac_cv_header_net_socket_h=no} AS_IF([test
“$ac_cv_header_net_socket_h” = yes], [</p>

<pre>ac_cv_header_sys_socket_h=${ac_cv_header_sys_socket_h=no}</pre>

<p>], [</p>

<pre>ac_cv_header_sys_socket_h=${ac_cv_header_sys_socket_h=yes}</pre>

<p>])</p>

<p>AC_TYPE_SIZE_T RUBY_CHECK_SIGNEDNESS(size_t, [AC_MSG_ERROR(size_t is
signed)], [],</p>

<pre>[@%:@include &lt;sys/types.h&gt;])</pre>

<p>RUBY_CHECK_SIZEOF(size_t, [int long void*], [], [@%:@include
&lt;sys/types.h&gt;]) RUBY_CHECK_SIZEOF(ptrdiff_t, size_t, [], [@%:@include
&lt;stddef.h&gt;]) RUBY_CHECK_PRINTF_PREFIX(size_t, z)
RUBY_CHECK_PRINTF_PREFIX(ptrdiff_t, t) AC_STRUCT_ST_BLKSIZE
AC_STRUCT_ST_BLOCKS AC_STRUCT_ST_RDEV RUBY_CHECK_SIZEOF([struct
stat.st_size], [off_t int long “long long”], [], [@%:@include
&lt;sys/stat.h&gt;]) AS_IF([test “$ac_cv_member_struct_stat_st_blocks” =
yes], [</p>

<pre>RUBY_CHECK_SIZEOF([struct stat.st_blocks], [off_t int long &quot;long long&quot;], [], [@%:@include &lt;sys/stat.h&gt;])</pre>

<p>]) RUBY_CHECK_SIZEOF([struct stat.st_ino], [long “long long”], [],
[@%:@include &lt;sys/stat.h&gt;]) AC_CHECK_MEMBERS([struct stat.st_atim])
AC_CHECK_MEMBERS([struct stat.st_atimespec]) AC_CHECK_MEMBERS([struct
stat.st_atimensec]) AC_CHECK_MEMBERS([struct stat.st_mtim])
AC_CHECK_MEMBERS([struct stat.st_mtimespec]) AC_CHECK_MEMBERS([struct
stat.st_mtimensec]) AC_CHECK_MEMBERS([struct stat.st_ctim])
AC_CHECK_MEMBERS([struct stat.st_ctimespec]) AC_CHECK_MEMBERS([struct
stat.st_ctimensec]) AC_CHECK_MEMBERS([struct stat.st_birthtimespec])
AS_IF([test “x$ac_cv_member_struct_stat_st_birthtimespec” != xyes],</p>

<pre>[AC_CHECK_MEMBERS([struct statx.stx_btime])])</pre>

<p>AC_CHECK_TYPES([struct timeval], [], [], [@%:@ifdef HAVE_TIME_H @%:@include
&lt;time.h&gt; @%:@endif @%:@ifdef HAVE_SYS_TIME_H @%:@include
&lt;sys/time.h&gt; @%:@endif])</p>

<p>AS_IF([test “${ac_cv_type_struct_timeval}” = yes], [</p>

<pre>RUBY_CHECK_SIZEOF([struct timeval.tv_sec], [time_t long &quot;long long&quot;], [],
                  [@%:@ifdef HAVE_TIME_H</pre>

<p>@%:@include &lt;time.h&gt; @%:@endif @%:@ifdef HAVE_SYS_TIME_H @%:@include
&lt;sys/time.h&gt; @%:@endif])</p>

<pre>AS_CASE(${ac_cv_sizeof_struct_timeval_tv_sec},
        [SIZEOF_INT], [t=int],
        [SIZEOF_LONG], [t=long],
        [SIZEOF_LONG_LONG], [t=LONG_LONG],
        [t=])
AS_IF([test &quot;${t}&quot; != &quot;&quot;], [
    AC_DEFINE_UNQUOTED(TYPEOF_TIMEVAL_TV_SEC, [$t])
])</pre>

<p>])</p>

<p>AC_CHECK_TYPES([struct timespec], [], [], [@%:@ifdef HAVE_TIME_H
@%:@include &lt;time.h&gt; @%:@endif @%:@ifdef HAVE_SYS_TIME_H @%:@include
&lt;sys/time.h&gt; @%:@endif])</p>

<p>AC_CHECK_TYPES([struct timezone], [], [], [@%:@ifdef HAVE_TIME_H @%:@
include &lt;time.h&gt; @%:@endif @%:@ifdef HAVE_SYS_TIME_H @%:@ include
&lt;sys/time.h&gt; @%:@endif])</p>

<p><a href="rb_cv_large_fd_select">AC_CACHE_VAL(</a>,</p>

<pre>[AC_CHECK_TYPE(fd_mask, [rb_cv_large_fd_select=yes], [rb_cv_large_fd_select=no], [AC_INCLUDES_DEFAULT([])</pre>

<p>@%:@ifdef HAVE_SYS_SELECT_H @%:@ include &lt;sys/select.h&gt; @%:@endif])])
AS_IF([test “$rb_cv_large_fd_select” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_RB_FD_INIT</span>, <span class="ruby-value">1</span>)
</pre>

<p>])</p>

<p>RUBY_DEFINT(int8_t, 1) RUBY_DEFINT(uint8_t, 1, unsigned)
RUBY_DEFINT(int16_t, 2) RUBY_DEFINT(uint16_t, 2, unsigned)
RUBY_DEFINT(int32_t, 4) RUBY_DEFINT(uint32_t, 4, unsigned)
RUBY_DEFINT(int64_t, 8) RUBY_DEFINT(uint64_t, 8, unsigned)
RUBY_DEFINT(int128_t, 16) RUBY_DEFINT(uint128_t, 16, unsigned)
RUBY_DEFINT(intptr_t, void*) RUBY_DEFINT(uintptr_t, void*, unsigned)
AS_IF([test “x$rb_cv_type_intptr_t” != xno], [</p>

<pre>RUBY_CHECK_PRINTF_PREFIX(intptr_t, &#39;&#39; ll I64 l, PTR)</pre>

<p>]) RUBY_DEFINT(ssize_t, size_t, [], [@%:@include &lt;sys/types.h&gt;])  
dnl may differ from int, so not use AC_TYPE_SSIZE_T. AS_IF([test
“x$rb_cv_type_int64_t” != xno], [</p>

<pre>RUBY_CHECK_PRINTF_PREFIX(int64_t, ll I64 l, 64)</pre>

<p>])</p>

<p>AC_CACHE_CHECK(for stack end address, rb_cv_stack_end_address,
[rb_cv_stack_end_address=no</p>

<pre>AC_TRY_LINK(
  [extern void *__libc_stack_end;],
  [if (!__libc_stack_end) return 1;],
  [rb_cv_stack_end_address=&quot;__libc_stack_end&quot;])</pre>

<p>]) AS_IF([test $rb_cv_stack_end_address != no], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE_UNQUOTED</span>(<span class="ruby-constant">STACK_END_ADDRESS</span>, <span class="ruby-identifier">$rb_cv_stack_end_address</span>)
</pre>

<p>])</p>

<p>dnl Checks for library functions. AC_TYPE_GETGROUPS AC_TYPE_SIGNAL <a
href=""${target_cpu}-${target_os}:${target_archs}"">AS_CASE(</a>,
[powerpc-darwin*], [</p>

<pre>AC_LIBSOURCES(alloca.c)
AC_SUBST([ALLOCA], [\${LIBOBJDIR}alloca.${ac_objext}])
AC_DEFINE(C_ALLOCA)
AC_DEFINE_UNQUOTED(alloca, alloca)
],</pre>

<p>[universal-darwin*:<strong>ppc</strong>], [</p>

<pre>AC_LIBSOURCES(alloca.c)
AC_SUBST([ALLOCA], [\${LIBOBJDIR}alloca.${ac_objext}])
RUBY_DEFINE_IF([defined __powerpc__], C_ALLOCA, 1)
RUBY_DEFINE_IF([defined __powerpc__], alloca, alloca)
],</pre>

<p>[</p>

<pre>AC_FUNC_ALLOCA
])</pre>

<p>AS_IF([test “x$ALLOCA” = “x”], [</p>

<pre>AC_CACHE_CHECK([for dynamic size alloca], rb_cv_dynamic_alloca, [
for chk in ok __chkstk; do
    AC_TRY_LINK([
        @%:@ifdef HAVE_ALLOCA_H
        @%:@include &lt;alloca.h&gt;
        @%:@endif
        void $chk() {}
        int dynamic_alloca_test;
        int dynamic_alloca_result;],
        [dynamic_alloca_result = alloca(dynamic_alloca_test) != 0;],
        [rb_cv_dynamic_alloca=$chk; break])
done])
AS_IF([test &quot;x$rb_cv_dynamic_alloca&quot; = &quot;x__chkstk&quot;], [
    AC_DEFINE_UNQUOTED(RUBY_ALLOCA_CHKSTK, _$rb_cv_dynamic_alloca)
    AS_CASE(&quot;$target_cpu&quot;,
    [x64|x86_64], [
        AC_SUBST([ALLOCA], [\${LIBOBJDIR}x86_64-chkstk.${ac_objext}])
    ],)
])</pre>

<p>]) AC_FUNC_MEMCMP</p>

<p><a href=""$target_os"">AS_CASE(</a>,[freebsd*],[</p>

<pre>AC_DEFINE(BROKEN_CLOSE)
AC_REPLACE_FUNCS(close)
])</pre>

<p>AC_REPLACE_FUNCS(acosh) AC_REPLACE_FUNCS(cbrt) AC_REPLACE_FUNCS(crypt)
AC_REPLACE_FUNCS(dup2) AC_REPLACE_FUNCS(erf)
AC_REPLACE_FUNCS(explicit_bzero) AC_REPLACE_FUNCS(ffs)
AC_REPLACE_FUNCS(flock) AC_REPLACE_FUNCS(hypot) AC_REPLACE_FUNCS(lgamma_r)
AC_REPLACE_FUNCS(memmove) AC_REPLACE_FUNCS(nan) AC_REPLACE_FUNCS(nextafter)
AC_REPLACE_FUNCS(setproctitle) AC_REPLACE_FUNCS(strchr)
AC_REPLACE_FUNCS(strerror) AC_REPLACE_FUNCS(strlcat)
AC_REPLACE_FUNCS(strlcpy) AC_REPLACE_FUNCS(strstr) AC_REPLACE_FUNCS(tgamma)</p>

<p><a href="finite">RUBY_REPLACE_FUNC(</a>, [@%:@include &lt;math.h&gt;]) <a
href="isinf">RUBY_REPLACE_FUNC(</a>, [@%:@include &lt;math.h&gt;]) <a
href="isnan">RUBY_REPLACE_FUNC(</a>, [@%:@include &lt;math.h&gt;])</p>

<p># for missing/setproctitle.c <a href=""$target_os"">AS_CASE(</a>, [aix* |
k*bsd*-gnu | kopensolaris*-gnu | linux* | darwin*],
[AC_DEFINE(SPT_TYPE,SPT_REUSEARGV)], [hpux*],
[AC_DEFINE(SPT_TYPE,SPT_PSTAT) ], []) AC_CHECK_HEADERS(sys/pstat.h)</p>

<p>AC_CACHE_CHECK(for signbit, rb_cv_have_signbit,</p>

<pre>[AC_TRY_LINK([</pre>

<p>include &lt;math.h&gt; ], [int v = signbit(-0.0);],</p>

<pre>rb_cv_have_signbit=yes,
rb_cv_have_signbit=no)])</pre>

<p>AS_IF([test “$rb_cv_have_signbit” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_SIGNBIT</span>)
</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">AC_LIBOBJ</span>([<span class="ruby-identifier">signbit</span>])
</pre>

<p>])</p>

<p>AC_FUNC_FORK</p>

<p>AC_CHECK_FUNCS(__syscall) AC_CHECK_FUNCS(_longjmp)                # used
for AC_ARG_WITH(setjmp-type) # we don&#39;t use _setjmp if _longjmp
doesn&#39;t exist. test x$ac_cv_func__longjmp = xno &amp;&amp;
ac_cv_func__setjmp=no AC_CHECK_FUNCS(arc4random_buf) AC_CHECK_FUNCS(atan2l
atan2f) AC_CHECK_FUNCS(chroot) AC_CHECK_FUNCS(chsize)
AC_CHECK_FUNCS(clock_gettime) AC_CHECK_FUNCS(copy_file_range)
AC_CHECK_FUNCS(cosh) AC_CHECK_FUNCS(crypt_r) AC_CHECK_FUNCS(daemon)
AC_CHECK_FUNCS(dirfd) AC_CHECK_FUNCS(dl_iterate_phdr)
AC_CHECK_FUNCS(dlopen) AC_CHECK_FUNCS(dladdr) AC_CHECK_FUNCS(dup)
AC_CHECK_FUNCS(dup3) AC_CHECK_FUNCS(eaccess) AC_CHECK_FUNCS(endgrent)
AC_CHECK_FUNCS(eventfd) AC_CHECK_FUNCS(explicit_memset)
AC_CHECK_FUNCS(fcopyfile) AC_CHECK_FUNCS(fchmod) AC_CHECK_FUNCS(fchown)
AC_CHECK_FUNCS(fcntl) AC_CHECK_FUNCS(fdatasync) AC_CHECK_FUNCS(fdopendir)
AC_CHECK_FUNCS(fgetattrlist) AC_CHECK_FUNCS(fmod) AC_CHECK_FUNCS(fstatat)
AC_CHECK_FUNCS(fsync) AC_CHECK_FUNCS(ftruncate) AC_CHECK_FUNCS(ftruncate64)
# used for Win32 platform AC_CHECK_FUNCS(getattrlist)
AC_CHECK_FUNCS(getcwd) AC_CHECK_FUNCS(getgidx) AC_CHECK_FUNCS(getgrnam)
AC_CHECK_FUNCS(getgrnam_r) AC_CHECK_FUNCS(getgroups)
AC_CHECK_FUNCS(getpgid) AC_CHECK_FUNCS(getpgrp) AC_CHECK_FUNCS(getpriority)
AC_CHECK_FUNCS(getpwnam_r) AC_CHECK_FUNCS(getrandom)
AC_CHECK_FUNCS(getresgid) AC_CHECK_FUNCS(getresuid)
AC_CHECK_FUNCS(getrlimit) AC_CHECK_FUNCS(getsid)
AC_CHECK_FUNCS(gettimeofday)            # for making
ac_cv_func_gettimeofday AC_CHECK_FUNCS(getuidx) AC_CHECK_FUNCS(gmtime_r)
AC_CHECK_FUNCS(grantpt) AC_CHECK_FUNCS(initgroups) AC_CHECK_FUNCS(ioctl)
AC_CHECK_FUNCS(isfinite) AC_CHECK_FUNCS(issetugid) AC_CHECK_FUNCS(killpg)
AC_CHECK_FUNCS(lchmod) AC_CHECK_FUNCS(lchown) AC_CHECK_FUNCS(link)
AC_CHECK_FUNCS(llabs) AC_CHECK_FUNCS(lockf) AC_CHECK_FUNCS(log2)
AC_CHECK_FUNCS(lstat) AC_CHECK_FUNCS(lutimes)
AC_CHECK_FUNCS(malloc_usable_size) AC_CHECK_FUNCS(malloc_size)
AC_CHECK_FUNCS(mblen) AC_CHECK_FUNCS(memalign) AC_CHECK_FUNCS(memset_s)
AC_CHECK_FUNCS(writev) AC_CHECK_FUNCS(memrchr) AC_CHECK_FUNCS(memmem)
AC_CHECK_FUNCS(mkfifo) AC_CHECK_FUNCS(mknod) AC_CHECK_FUNCS(mktime)
AC_CHECK_FUNCS(openat) AC_CHECK_FUNCS(pipe2) AC_CHECK_FUNCS(poll)
AC_CHECK_FUNCS(posix_fadvise) AC_CHECK_FUNCS(posix_memalign)
AC_CHECK_FUNCS(ppoll) AC_CHECK_FUNCS(pread) AC_CHECK_FUNCS(pwrite)
AC_CHECK_FUNCS(qsort_r) AC_CHECK_FUNCS(qsort_s) AC_CHECK_FUNCS(readlink)
AC_CHECK_FUNCS(realpath) AC_CHECK_FUNCS(round)
AC_CHECK_FUNCS(sched_getaffinity) AC_CHECK_FUNCS(seekdir)
AC_CHECK_FUNCS(select_large_fdset) AC_CHECK_FUNCS(sendfile)
AC_CHECK_FUNCS(setegid) AC_CHECK_FUNCS(setenv) AC_CHECK_FUNCS(seteuid)
AC_CHECK_FUNCS(setgid) AC_CHECK_FUNCS(setgroups) AC_CHECK_FUNCS(setpgid)
AC_CHECK_FUNCS(setpgrp) AC_CHECK_FUNCS(setregid) AC_CHECK_FUNCS(setresgid)
AC_CHECK_FUNCS(setresuid) AC_CHECK_FUNCS(setreuid) AC_CHECK_FUNCS(setrgid)
AC_CHECK_FUNCS(setrlimit) AC_CHECK_FUNCS(setruid) AC_CHECK_FUNCS(setsid)
AC_CHECK_FUNCS(setuid) AC_CHECK_FUNCS(shutdown) AC_CHECK_FUNCS(sigaction)
AC_CHECK_FUNCS(sigaltstack) AC_CHECK_FUNCS(sigprocmask)
AC_CHECK_FUNCS(sinh) AC_CHECK_FUNCS(spawnv) AC_CHECK_FUNCS(symlink)
AC_CHECK_FUNCS(syscall) AC_CHECK_FUNCS(sysconf) AC_CHECK_FUNCS(tanh)
AC_CHECK_FUNCS(telldir) AC_CHECK_FUNCS(timegm) AC_CHECK_FUNCS(times)
AC_CHECK_FUNCS(truncate) AC_CHECK_FUNCS(truncate64)              # used for
Win32 AC_CHECK_FUNCS(unsetenv) AC_CHECK_FUNCS(utimensat)
AC_CHECK_FUNCS(utimes) AC_CHECK_FUNCS(wait4) AC_CHECK_FUNCS(waitpid)</p>

<p>AS_IF([test “x$ac_cv_member_struct_statx_stx_btime” = xyes],</p>

<pre>[AC_CHECK_FUNCS(statx)])</pre>

<p><a href=""$ac_cv_func_memset_s:$ac_cv_func_qsort_s"">AS_CASE(</a>,
[<strong>yes</strong>],</p>

<pre>[RUBY_DEFINE_IF([!defined __STDC_WANT_LIB_EXT1__], [__STDC_WANT_LIB_EXT1__], 1)])</pre>

<p>AS_IF([test “$ac_cv_func_getcwd” = yes], [</p>

<pre>AC_CACHE_CHECK(if getcwd allocates buffer if NULL is given, [rb_cv_getcwd_malloc],
    [AC_TRY_RUN([</pre>

<p>@%:@include &lt;stddef.h&gt; @%:@include &lt;stdio.h&gt; @%:@ifdef
HAVE_UNISTD_H @%:@include &lt;unistd.h&gt; @%:@endif @%:@ifndef
EXIT_SUCCESS @%:@define EXIT_SUCCESS 0 @%:@endif @%:@ifndef EXIT_FAILURE
@%:@define EXIT_FAILURE 1 @%:@endif</p>

<p>int main(int argc, char **argv) {</p>

<pre>if (!getcwd(NULL, 0)) return EXIT_FAILURE;
return EXIT_SUCCESS;</pre>

<p>} ],</p>

<pre>        rb_cv_getcwd_malloc=yes,
        rb_cv_getcwd_malloc=no,
        AS_CASE($target_os,
            [linux*|darwin*|*bsd|cygwin*|mingw*|mswin*],
            [rb_cv_getcwd_malloc=yes],
            [rb_cv_getcwd_malloc=no]))])
AS_IF([test &quot;$rb_cv_getcwd_malloc&quot; = no], [AC_DEFINE(NO_GETCWD_MALLOC, 1)])</pre>

<p>])</p>

<p>AS_IF([test “$ac_cv_func_crypt_r” = yes],</p>

<pre>[AC_CHECK_HEADERS(crypt.h)])</pre>

<p>AS_IF([test “$ac_cv_func_crypt_r:$ac_cv_header_crypt_h” = yes:yes],</p>

<pre>[AC_CHECK_MEMBERS([struct crypt_data.initialized], [], [],
                  [AC_INCLUDES_DEFAULT([@%:@include &lt;crypt.h&gt;])])])</pre>

<p>RUBY_CHECK_BUILTIN_FUNC(__builtin_alloca_with_align,
[__builtin_alloca_with_align(1, 4096)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_assume_aligned,
[__builtin_assume_aligned((void*)32, 32)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_bswap16, [__builtin_bswap16(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_bswap32, [__builtin_bswap32(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_bswap64, [__builtin_bswap64(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_popcount, [__builtin_popcount(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_popcountll, [__builtin_popcountll(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_clz, [__builtin_clz(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_clzl, [__builtin_clzl(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_clzll, [__builtin_clzll(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_ctz, [__builtin_ctz(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_ctzll, [__builtin_ctzll(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_add_overflow, [int
x;__builtin_add_overflow(0,0,&amp;x)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_sub_overflow, [int
x;__builtin_sub_overflow(0,0,&amp;x)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_mul_overflow, [int
x;__builtin_mul_overflow(0,0,&amp;x)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_mul_overflow_p,
[__builtin_mul_overflow_p(0,0,(int)0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_constant_p, [__builtin_constant_p(0)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_choose_expr, [</p>

<pre>[int x[__extension__(__builtin_choose_expr(1, 1, -1))]];
[int y[__extension__(__builtin_choose_expr(0, -1, 1))]];
])</pre>

<p>AS_IF([test x$rb_cv_builtin___builtin_choose_expr = xyes], [</p>

<pre>RUBY_CHECK_BUILTIN_FUNC(__builtin_choose_expr_constant_p, [
[int x[__extension__(__builtin_choose_expr(__builtin_constant_p(1), 1, -1))]];
[int y[__extension__(__builtin_choose_expr(__builtin_constant_p(foo), -1, 1))]];
])</pre>

<p>]) RUBY_CHECK_BUILTIN_FUNC(__builtin_types_compatible_p,
[__builtin_types_compatible_p(int, int)])
RUBY_CHECK_BUILTIN_FUNC(__builtin_trap, [__builtin_trap()])</p>

<p>AS_IF([test “$ac_cv_func_qsort_r” != no], [</p>

<pre>AC_CACHE_CHECK(whether qsort_r is GNU version, rb_cv_gnu_qsort_r,
  [AC_TRY_COMPILE([</pre>

<p>@%:@include &lt;stdlib.h&gt; void (qsort_r)(void *base, size_t nmemb,
size_t size,</p>

<pre>int (*compar)(const void *, const void *, void *),
void *arg);</pre>

<p>],[ ],</p>

<pre>    [rb_cv_gnu_qsort_r=yes],
    [rb_cv_gnu_qsort_r=no])
])
AC_CACHE_CHECK(whether qsort_r is BSD version, rb_cv_bsd_qsort_r,
  [AC_TRY_COMPILE([</pre>

<p>@%:@include &lt;stdlib.h&gt; void (qsort_r)(void *base, size_t nmemb,
size_t size,</p>

<pre>void *arg, int (*compar)(void *, const void *, const void *));</pre>

<p>],[ ],</p>

<pre>    [rb_cv_bsd_qsort_r=yes],
    [rb_cv_bsd_qsort_r=no])
])
AS_CASE(&quot;$rb_cv_gnu_qsort_r:$rb_cv_bsd_qsort_r&quot;,
[yes:no], [
  AC_DEFINE(HAVE_GNU_QSORT_R, 1)
],
[no:yes], [
  AC_DEFINE(HAVE_BSD_QSORT_R, 1)
])</pre>

<p>])</p>

<p>AC_CACHE_CHECK(whether atan2 handles Inf as C99, rb_cv_atan2_inf_c99, [</p>

<pre>AS_IF([test $ac_cv_func_atan2f:$ac_cv_func_atan2l = yes:yes], [
    AC_TRY_RUN([</pre>

<p>@%:@include &lt;math.h&gt; @%:@ifdef HAVE_UNISTD_H @%:@include
&lt;unistd.h&gt; @%:@endif @%:@ifndef EXIT_SUCCESS @%:@define EXIT_SUCCESS
0 @%:@endif @%:@ifndef EXIT_FAILURE @%:@define EXIT_FAILURE 1 @%:@endif</p>

<p>int main(int argc, char **argv) {</p>

<pre>if (fabs(atan2(INFINITY, INFINITY) - M_PI_4) &lt;= 0.01) return EXIT_SUCCESS;
return EXIT_FAILURE;</pre>

<p>} ],</p>

<pre>    [rb_cv_atan2_inf_c99=yes],
    [rb_cv_atan2_inf_c99=no],
    [AS_CASE($target_os, [mingw*|mswin*], [rb_cv_atan2_inf_c99=no], [rb_cv_atan2_inf_c99=yes])]
    )
], [rb_cv_atan2_inf_c99=no])</pre>

<p>]) AS_IF([test “x$rb_cv_atan2_inf_c99” = xyes], [AC_DEFINE(ATAN2_INF_C99)])</p>

<p># Some platform need -lrt for clock_gettime, but the other don&#39;t.
AS_IF([test x“$ac_cv_func_clock_gettime” != xyes], [</p>

<pre># glibc 2.17 moves clock_* functions from librt to the main C library.
# http://sourceware.org/ml/libc-announce/2012/msg00001.html
AC_CHECK_LIB(rt, clock_gettime)
AS_IF([test x&quot;$ac_cv_lib_rt_clock_gettime&quot; = xyes], [
    AC_DEFINE(HAVE_CLOCK_GETTIME, 1)
])</pre>

<p>]) AC_CHECK_FUNCS(clock_getres) # clock_getres should be tested after
clock_gettime test including librt test. <a href="rt">AC_CHECK_LIB(</a>,
[timer_create]) <a href="rt">AC_CHECK_LIB(</a>, [timer_settime])
AS_IF([test x“$ac_cv_lib_rt_timer_create” = xyes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_TIMER_CREATE</span>, <span class="ruby-value">1</span>)
</pre>

<p>]) AS_IF([test x“$ac_cv_lib_rt_timer_settime” = xyes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_TIMER_SETTIME</span>, <span class="ruby-value">1</span>)
</pre>

<p>])</p>

<p>AC_CACHE_CHECK(for unsetenv returns a value, rb_cv_unsetenv_return_value,</p>

<pre>[AC_TRY_COMPILE([</pre>

<p>include &lt;stdlib.h&gt; ], [int v = unsetenv(“foo”);],</p>

<pre>rb_cv_unsetenv_return_value=yes,
rb_cv_unsetenv_return_value=no)])</pre>

<p>AS_IF([test “$rb_cv_unsetenv_return_value” = no], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">VOID_UNSETENV</span>)
</pre>

<p>])</p>

<p># End of setjmp check.</p>

<p>AC_ARG_ENABLE(setreuid,</p>

<pre>AS_HELP_STRING([--enable-setreuid], [use setreuid()/setregid() according to need even if obsolete]),
[use_setreuid=$enableval])</pre>

<p>AS_IF([test “$use_setreuid” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">USE_SETREUID</span>)
<span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">USE_SETREGID</span>)
</pre>

<p>]) AC_STRUCT_TIMEZONE AC_CACHE_CHECK(for struct tm.tm_gmtoff,
rb_cv_member_struct_tm_tm_gmtoff,</p>

<pre>[AC_TRY_COMPILE([</pre>

<p>@%:@define _BSD_SOURCE @%:@define _DEFAULT_SOURCE @%:@include
&lt;time.h&gt;</p>

<pre> ],
  [struct tm t; t.tm_gmtoff = 3600;],
[rb_cv_member_struct_tm_tm_gmtoff=yes],
[rb_cv_member_struct_tm_tm_gmtoff=no])])</pre>

<p>AS_IF([test “$rb_cv_member_struct_tm_tm_gmtoff” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_STRUCT_TM_TM_GMTOFF</span>)
</pre>

<p>]) AC_CACHE_CHECK(for external int daylight, rb_cv_have_daylight,</p>

<pre>[AC_TRY_LINK([#include &lt;time.h&gt;
int i;],
      [i = daylight;],
      rb_cv_have_daylight=yes,
      rb_cv_have_daylight=no)])</pre>

<p>AS_IF([test “$rb_cv_have_daylight” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">HAVE_DAYLIGHT</span>)
</pre>

<p>])</p>

<p>AC_CACHE_CHECK(for negative time_t for gmtime(3), rb_cv_negative_time_t,</p>

<pre>[AC_TRY_RUN([</pre>

<p>include &lt;stdlib.h&gt; include &lt;time.h&gt;</p>

<p>void check(tm, y, m, d, h, s)</p>

<pre class="ruby"><span class="ruby-identifier">struct</span> <span class="ruby-identifier">tm</span> <span class="ruby-operator">*</span><span class="ruby-identifier">tm</span>;
<span class="ruby-identifier">int</span> <span class="ruby-identifier">y</span>, <span class="ruby-identifier">m</span>, <span class="ruby-identifier">d</span>, <span class="ruby-identifier">h</span>, <span class="ruby-identifier">s</span>;
</pre>

<p>{</p>

<pre>if (!tm ||
    tm-&gt;tm_year != y ||
    tm-&gt;tm_mon  != m-1 ||
    tm-&gt;tm_mday != d ||
    tm-&gt;tm_hour != h ||
    tm-&gt;tm_sec  != s) {
    exit(1);
}</pre>

<p>}</p>

<p>int main() {</p>

<pre>time_t t = -1;
struct tm *tm;

check(gmtime(&amp;t), 69, 12, 31, 23, 59);
t = ~(time_t)0 &lt;&lt; 31;
check(gmtime(&amp;t), 1, 12, 13, 20, 52);
return 0;</pre>

<p>} ],</p>

<pre>rb_cv_negative_time_t=yes,
rb_cv_negative_time_t=no,
rb_cv_negative_time_t=yes)])</pre>

<p>AS_IF([test “$rb_cv_negative_time_t” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">NEGATIVE_TIME_T</span>)
</pre>

<p>])</p>

<p># [ruby-dev:40910] overflow of time on FreeBSD # <a
href="http://www.freebsd.org/cgi/query-pr.cgi?pr=145341">www.freebsd.org/cgi/query-pr.cgi?pr=145341</a>
AC_CACHE_CHECK(for localtime(3) overflow correctly,
rb_cv_localtime_overflow,</p>

<pre>[AC_TRY_RUN([</pre>

<p>include &lt;stdlib.h&gt; include &lt;time.h&gt;</p>

<p>void check(time_t t1) {</p>

<pre>struct tm *tm;
time_t t2;
tm = localtime(&amp;t1);
if (!tm)
    return;    overflow detected.  ok. */
t2 = mktime(tm);
if (t1 == t2)
    return; /* round-trip.  ok. */
exit(1);</pre>

<p>}</p>

<p>int main() {</p>

<pre>time_t t;
if (~(time_t)0 &lt;= 0) {
    t = (((time_t)1) &lt;&lt; (sizeof(time_t) * 8 - 2));
    t |= t - 1;
}
else {
    t = ~(time_t)0;
}
check(t);
return 0;</pre>

<p>} ],</p>

<pre>rb_cv_localtime_overflow=yes,
rb_cv_localtime_overflow=no,
rb_cv_localtime_overflow=no)])</pre>

<p>AS_IF([test “$rb_cv_localtime_overflow” = no], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">LOCALTIME_OVERFLOW_PROBLEM</span>)
</pre>

<p>])</p>

<p>AS_IF([test “$ac_cv_func_sigprocmask” = yes &amp;&amp; test
“$ac_cv_func_sigaction” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">POSIX_SIGNAL</span>)
</pre>

<p>], [</p>

<pre>AC_CHECK_FUNCS(sigsetmask)
AC_CACHE_CHECK(for BSD signal semantics, rb_cv_bsd_signal,
  [AC_TRY_RUN([</pre>

<p>include &lt;stdio.h&gt; include &lt;signal.h&gt;</p>

<p>void sig_handler(dummy)</p>

<pre class="ruby"><span class="ruby-identifier">int</span> <span class="ruby-identifier">dummy</span>;
</pre>

<p>{ }</p>

<p>int main() {</p>

<pre class="ruby"><span class="ruby-identifier">signal</span>(<span class="ruby-constant">SIGINT</span>, <span class="ruby-identifier">sig_handler</span>);
<span class="ruby-identifier">kill</span>(<span class="ruby-identifier">getpid</span>(), <span class="ruby-constant">SIGINT</span>);
<span class="ruby-identifier">kill</span>(<span class="ruby-identifier">getpid</span>(), <span class="ruby-constant">SIGINT</span>);
<span class="ruby-keyword">return</span> <span class="ruby-value">0</span>;
</pre>

<p>} ],</p>

<pre>      rb_cv_bsd_signal=yes,
      rb_cv_bsd_signal=no,
      rb_cv_bsd_signal=$ac_cv_func_sigsetmask)])
AS_IF([test &quot;$rb_cv_bsd_signal&quot; = yes], [
  AC_DEFINE(BSD_SIGNAL)
])</pre>

<p>])</p>

<p><a href="sig_t">AC_CHECK_TYPES(</a>,[],[],[@%:@include &lt;signal.h&gt;])</p>

<p>AS_IF([test “$ac_cv_func_getpgid” = no], [</p>

<pre class="ruby"><span class="ruby-comment"># AC_FUNC_GETPGRP fails when cross-compiling with old autoconf.</span>
<span class="ruby-comment"># autoconf is changed between 2.52d and 2.52f?</span>
<span class="ruby-comment"># http://lists.gnu.org/archive/html/bug-gnu-utils/2001-09/msg00181.html</span>
<span class="ruby-comment"># &quot;autoconf cleanup for AC_FUNC_GETPGRP and GETPGRP_VOID&quot;</span>
</pre>

<p>AC_FUNC_GETPGRP ]) AS_IF([test “$ac_cv_func_setpgid:$ac_cv_func_setpgrp” =
no:yes], [</p>

<pre class="ruby"><span class="ruby-comment"># AC_FUNC_SETPGRP fails when cross-compiling.  (until autoconf 2.69?)</span>
<span class="ruby-comment"># https://lists.gnu.org/archive/html/bug-autoconf/2013-02/msg00002.html</span>
<span class="ruby-comment"># &quot;AC_FUNC_SETPGRP fails to work properly when cross-compiling&quot;</span>
</pre>

<p>AC_FUNC_SETPGRP ])</p>

<p>AS_IF([test x“$ac_cv_func_dirfd” = xno], [</p>

<pre>AS_CASE([&quot;$target_os&quot;],[solaris*],
        [AC_CHECK_MEMBERS([DIR.d_fd, DIR.dd_fd],,,[</pre>

<p>include &lt;sys/types.h&gt; include &lt;dirent.h&gt; ])]) ])</p>

<p>AC_CACHE_CHECK(whether right shift preserve sign bit, rb_cv_rshift_sign,</p>

<pre>[AC_COMPILE_IFELSE([AC_LANG_BOOL_COMPILE_TRY([], [(-1==(-1&gt;&gt;1))])],
    rb_cv_rshift_sign=yes,
    rb_cv_rshift_sign=no)])</pre>

<p>AS_IF([test “$rb_cv_rshift_sign” = yes], [</p>

<pre>AC_DEFINE(RSHIFT(x,y), ((x)&gt;&gt;(int)(y)))</pre>

<p>], [</p>

<pre>AC_DEFINE(RSHIFT(x,y), (((x)&lt;0) ? ~((~(x))&gt;&gt;(int)(y)) : (x)&gt;&gt;(int)(y)))</pre>

<p>])</p>

<p><a
href=""$ac_cv_func_gettimeofday:$ac_cv_func_clock_gettime"">AS_CASE(</a>,
[<strong>yes</strong>], [], [</p>

<pre>AC_MSG_ERROR(clock_gettime() or gettimeofday() must exist)</pre>

<p>])</p>

<p>AS_IF([test “$ac_cv_func_sysconf” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">RUBY_CHECK_SYSCONF</span>(<span class="ruby-constant">CLK_TCK</span>)
</pre>

<p>])</p>

<p>AS_IF([test “${universal_binary-no}” = yes ], [</p>

<pre>archflagpat=`eval echo &#39;&quot;&#39;&quot;${ARCH_FLAG}&quot;&#39;&quot;&#39; | sed &#39;s/[[][|.*]]/\\&amp;/g&#39;`
save_CFLAGS=&quot;$CFLAGS&quot; new_cflags=`echo &quot;$CFLAGS&quot; | sed &quot;s|$archflagpat&quot;&#39;||&#39;`
save_LDFLAGS=&quot;$LDFLAGS&quot; new_ldflags=`echo &quot;$LDFLAGS&quot; | sed &quot;s|$archflagpat&quot;&#39;||&#39;`
stack_dir=
for archs in ${universal_archnames}; do
    archs=`echo $archs | sed &#39;s/=.*//&#39;`
    CFLAGS=&quot;$new_cflags -arch $archs&quot;
    LDFLAGS=&quot;$new_ldflags -arch $archs&quot;
    RUBY_STACK_GROW_DIRECTION($archs, dir)
    AS_IF([test x$stack_dir = x], [
        stack_dir=$dir
    ], [test x$stack_dir != x$dir], [
        stack_dir=no
    ])
done
CFLAGS=&quot;$save_CFLAGS&quot; LDFLAGS=&quot;$save_LDFLAGS&quot;
AS_IF([test x$stack_dir = xno], [
    for archs in ${universal_archnames}; do
        archs=`echo $archs | sed &#39;s/=.*//&#39;`
        eval dir=\$[rb_cv_stack_grow_dir_]AS_TR_SH([$archs])
        RUBY_DEFINE_IF([defined __${archs}__], STACK_GROW_DIRECTION, $dir)
    done
], [
    AC_DEFINE_UNQUOTED(STACK_GROW_DIRECTION, $stack_dir)
])</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">RUBY_STACK_GROW_DIRECTION</span>(<span class="ruby-identifier">$target_cpu</span>, <span class="ruby-identifier">dir</span>)
<span class="ruby-constant">AC_DEFINE_UNQUOTED</span>(<span class="ruby-constant">STACK_GROW_DIRECTION</span>, <span class="ruby-identifier">$dir</span>)
</pre>

<p>])</p>

<p>AC_ARG_WITH(coroutine,</p>

<pre>AS_HELP_STRING([--with-coroutine=IMPLEMENTATION], [specify the coroutine implementation to use]),
[rb_cv_coroutine=$withval])</pre>

<p><a href="$rb_cv_coroutine">AS_CASE(</a>, [yes|&#39;&#39;], [</p>

<pre>AC_MSG_CHECKING(native coroutine implementation for ${target_cpu}-${target_os})
AS_CASE([&quot;$target_cpu-$target_os&quot;],
    [x*64-darwin*], [
        rb_cv_coroutine=amd64
    ],
    [x*64-linux*], [
        AS_CASE([&quot;$ac_cv_sizeof_voidp&quot;],
            [8], [ rb_cv_coroutine=amd64 ],
            [4], [ rb_cv_coroutine=x86 ],
            [*], [ rb_cv_coroutine= ]
        )
    ],
    [*86-linux*], [
        rb_cv_coroutine=x86
    ],
    [x64-mingw32], [
        rb_cv_coroutine=win64
    ],
    [*86-mingw32], [
        rb_cv_coroutine=win32
    ],
    [armv7*-linux*], [
        rb_cv_coroutine=ucontext
    ],
    [aarch64-linux*], [
        rb_cv_coroutine=arm64
    ],
    [powerpc64le-linux*], [
        rb_cv_coroutine=ppc64le
    ],
    [x86_64-openbsd*], [
        rb_cv_coroutine=amd64
    ],
    [i386-openbsd*], [
        rb_cv_coroutine=x86
    ],
    [*-openbsd*], [
        rb_cv_coroutine=copy
    ],
    [*], [
        rb_cv_coroutine=ucontext
    ]
)
AC_MSG_RESULT(${rb_cv_coroutine})</pre>

<p>]) COROUTINE_H=coroutine/$rb_cv_coroutine/Context.h <a
href="$rb_cv_coroutine">AS_CASE(</a>,</p>

<pre>[copy|ucontext], [
    COROUTINE_SRC=coroutine/$rb_cv_coroutine/Context.c
],
[*], [
    COROUTINE_SRC=coroutine/$rb_cv_coroutine/Context.&#39;$(ASMEXT)&#39;
],</pre>

<p>) AC_DEFINE_UNQUOTED(COROUTINE_H, [“$COROUTINE_H”]) AC_SUBST(X_COROUTINE_H,
[$COROUTINE_H]) AC_SUBST(X_COROUTINE_SRC, [$COROUTINE_SRC])</p>

<p>AS_IF([test x“$enable_pthread” = xyes], [</p>

<pre>for pthread_lib in thr pthread pthreads c c_r root; do
    AC_CHECK_LIB($pthread_lib, pthread_create,
                 rb_with_pthread=yes, rb_with_pthread=no)
    AS_IF([test &quot;$rb_with_pthread&quot; = &quot;yes&quot;], [break])
done
AS_IF([test x&quot;$rb_with_pthread&quot; = xyes], [
    AC_DEFINE(_REENTRANT)
    AC_DEFINE(_THREAD_SAFE)
    AC_DEFINE(HAVE_LIBPTHREAD)
    AC_CHECK_HEADERS(pthread_np.h, [], [], [@%:@include &lt;pthread.h&gt;])
    AS_CASE([&quot;$pthread_lib:$target_os&quot;],
            [c:*], [],
            [root:*], [],
            [c_r:*|*:openbsd*|*:mirbsd*],  [LIBS=&quot;-pthread $LIBS&quot;],
            [LIBS=&quot;-l$pthread_lib $LIBS&quot;])
], [
    AC_MSG_WARN(&quot;Don&#39;t know how to find pthread library on your system -- thread support disabled&quot;)
])
AC_CACHE_CHECK([whether pthread_t is scalar type], [rb_cv_scalar_pthread_t], [
    AC_TRY_COMPILE([
        @%:@include &lt;pthread.h&gt;
        ], [
        pthread_t thread_id;
        thread_id = 0;
        if (!thread_id) return 0;
        ], [rb_cv_scalar_pthread_t=yes], [rb_cv_scalar_pthread_t=no])
])
AS_IF([test x&quot;$rb_cv_scalar_pthread_t&quot; = xyes], [
    : # RUBY_CHECK_SIZEOF(pthread_t, [void* int long], [], [@%:@include &lt;pthread.h&gt;])
], [
    AC_DEFINE(NON_SCALAR_THREAD_ID)
])
AC_CHECK_FUNCS(sched_yield pthread_attr_setinheritsched \
    pthread_attr_get_np pthread_attr_getstack pthread_attr_getguardsize \
    pthread_get_stackaddr_np pthread_get_stacksize_np \
    thr_stksegment pthread_stackseg_np pthread_getthrds_np \
    pthread_condattr_setclock \
    pthread_sigmask pthread_setname_np pthread_set_name_np)
AS_CASE([&quot;$target_os&quot;],[aix*],[ac_cv_func_pthread_getattr_np=no],[AC_CHECK_FUNCS(pthread_getattr_np)])
set_current_thread_name=
AS_IF([test &quot;$ac_cv_func_pthread_setname_np&quot; = yes], [
    AC_CACHE_CHECK([arguments of pthread_setname_np], [rb_cv_func_pthread_setname_np_arguments],
        [rb_cv_func_pthread_setname_np_arguments=
        # Linux,AIX,  (pthread_self(), name)
        # NetBSD (pthread_self(), name, \&quot;%s\&quot;)
        # Darwin (name)
        for mac in \
            &quot;(pthread_self(), name)&quot; \
            &quot;(pthread_self(), name, \&quot;%s\&quot;)&quot; \
            &quot;(name)&quot; \
            ; do
            AC_TRY_COMPILE([
                @%:@include &lt;pthread.h&gt;
                @%:@ifdef HAVE_PTHREAD_NP_H
                @%:@include &lt;pthread_np.h&gt;
                @%:@endif
                @%:@define SET_THREAD_NAME(name) pthread_setname_np${mac}
                ],
                [if (SET_THREAD_NAME(&quot;conftest&quot;)) return 1;],
                [rb_cv_func_pthread_setname_np_arguments=&quot;${mac}&quot;
                break])
        done
        ]
    )
    AS_IF([test -n &quot;${rb_cv_func_pthread_setname_np_arguments}&quot;], [
        set_current_thread_name=&quot;pthread_setname_np${rb_cv_func_pthread_setname_np_arguments}&quot;
    ])
], [test &quot;$ac_cv_func_pthread_set_name_np&quot; = yes], [
    set_current_thread_name=&quot;pthread_set_name_np(pthread_self(), name)&quot;
])
AS_IF([test -n &quot;$set_current_thread_name&quot;], [
    AC_DEFINE_UNQUOTED(SET_CURRENT_THREAD_NAME(name), $set_current_thread_name)
    AS_CASE([$set_current_thread_name],
        [*&#39;pthread_self()&#39;*], [
            set_another_thread_name=`echo &quot;$set_current_thread_name&quot; | sed &#39;s/pthread_self()/thid/&#39;`
            AC_DEFINE_UNQUOTED(SET_ANOTHER_THREAD_NAME(thid,name), $set_another_thread_name)
        ])
])</pre>

<p>])</p>

<p>AS_IF([test x“$ac_cv_header_ucontext_h” = xno], [</p>

<pre>AC_CACHE_CHECK([if signal.h defines ucontext_t], [rb_cv_ucontext_in_signal_h],
    [AC_TRY_COMPILE([@%:@include &lt;signal.h&gt;],
    [size_t size = sizeof(ucontext_t);],
    [rb_cv_ucontext_in_signal_h=yes], [rb_cv_ucontext_in_signal_h=no])])
AS_IF([test x&quot;$rb_cv_ucontext_in_signal_h&quot; = xyes], [
        AC_DEFINE_UNQUOTED(UCONTEXT_IN_SIGNAL_H, 1)
])</pre>

<p>]) AS_IF([test x“$ac_cv_header_ucontext_h” = xyes -o
x“$rb_cv_ucontext_in_signal_h” = xyes], [</p>

<pre>AC_CACHE_CHECK([if mcontext_t is a pointer], [rb_cv_mcontext_t_ptr],
    [AC_TRY_COMPILE([
        @%:@include &lt;signal.h&gt;
        @%:@ifdef HAVE_UCONTEXT_H
        @%:@include &lt;ucontext.h&gt;
        @%:@endif
    mcontext_t test(mcontext_t mc) {return mc+1;}
    ],
    [test(0);],
    [rb_cv_mcontext_t_ptr=yes], [rb_cv_mcontext_t_ptr=no])])
AS_IF([test x&quot;$rb_cv_mcontext_t_ptr&quot; = xyes], [
    AC_DEFINE_UNQUOTED(DEFINE_MCONTEXT_PTR(mc, uc), mcontext_t mc = (uc)-&gt;uc_mcontext)
], [
    AC_DEFINE_UNQUOTED(DEFINE_MCONTEXT_PTR(mc, uc), mcontext_t *mc = &amp;(uc)-&gt;uc_mcontext)
])
AS_IF([test x&quot;$rb_with_pthread&quot; = xyes], [
    AC_CHECK_FUNCS(getcontext setcontext)
])</pre>

<p>])</p>

<p>AS_IF([test “$ac_cv_func_fork_works” = “yes” -a “$rb_with_pthread” =
“yes”], [</p>

<pre>AC_CACHE_CHECK([if fork works with pthread], rb_cv_fork_with_pthread,
    [AC_TRY_RUN([</pre>

<p>include &lt;stdlib.h&gt; include &lt;unistd.h&gt; include &lt;pthread.h&gt;
include &lt;stdio.h&gt; include &lt;sys/types.h&gt; include
&lt;sys/wait.h&gt; include &lt;signal.h&gt; ifndef EXIT_SUCCESS define
EXIT_SUCCESS 0 endif ifndef EXIT_FAILURE define EXIT_FAILURE 1 endif</p>

<p>void * thread_func(void *dmy) {</p>

<pre class="ruby"><span class="ruby-keyword">return</span> <span class="ruby-identifier">dmy</span>;
</pre>

<p>}</p>

<p>int use_threads(void) {</p>

<pre>pthread_t tid;
if (pthread_create(&amp;tid, 0, thread_func, 0) != 0) {
    return -1;
}
if (pthread_join(tid, 0) != 0) {
    return -1;
}
return 0;</pre>

<p>}</p>

<p>int main(int argc, char *argv[]) {</p>

<pre>pid_t pid;
if (use_threads()) return EXIT_FAILURE;
pid = fork();

if (pid) {
    int loc;
    sleep(1);
    if (waitpid(pid, &amp;loc, WNOHANG) == 0) {
        kill(pid, SIGKILL);
        return EXIT_FAILURE;
    }
    if (!WIFEXITED(loc) || WEXITSTATUS(loc) != EXIT_SUCCESS)
       return EXIT_FAILURE;
}
else {
    if (use_threads()) return EXIT_FAILURE;
}

return EXIT_SUCCESS;</pre>

<p>}],</p>

<pre>    rb_cv_fork_with_pthread=yes,
    rb_cv_fork_with_pthread=no,
    rb_cv_fork_with_pthread=yes)])
test x$rb_cv_fork_with_pthread = xyes || AC_DEFINE(CANNOT_FORK_WITH_PTHREAD)</pre>

<p>]) }</p>

<p>: “runtime section” &amp;&amp; { dnl wheather use dln_a_out or not
AC_ARG_WITH(dln-a-out,</p>

<pre>AS_HELP_STRING([--with-dln-a-out], [use dln_a_out if possible]),
[
AS_CASE([$withval],
[yes], [
    AS_IF([test &quot;$enable_shared&quot; = yes], [
        AC_MSG_ERROR(dln_a_out can not make shared library)
    ])
    with_dln_a_out=yes],
[
    with_dln_a_out=no])], [with_dln_a_out=no])</pre>

<p>AC_CACHE_CHECK(whether ELF binaries are produced, rb_cv_binary_elf, [<a
href="">AC_TRY_LINK([],</a>, [ AS_CASE([“`head -1 conftest$EXEEXT | tr -dc
&#39;177ELF&#39; | tr &#39;177&#39; .`”], [.ELF*], [rb_cv_binary_elf=yes],
[rb_cv_binary_elf=no])], rb_cv_binary_elf=no)])</p>

<p>AS_IF([test “$rb_cv_binary_elf” = yes], [</p>

<pre>AC_DEFINE(USE_ELF)
AS_IF([test &quot;$with_dln_a_out&quot; = yes], [
  AC_MSG_ERROR(dln_a_out does not work with ELF)
])
AC_CHECK_HEADERS([elf.h elf_abi.h])
AS_IF([test $ac_cv_header_elf_h = yes -o $ac_cv_header_elf_abi_h = yes], [
  AC_LIBOBJ([addr2line])
  AS_IF([test &quot;x$compress_debug_sections&quot; = xzlib], [
    AC_CHECK_LIB([z], [uncompress])
  ])
])</pre>

<p>])</p>

<p><a href="mach-o/loader.h">AC_CHECK_HEADERS(</a>) AS_IF([test
“$ac_cv_header_mach_o_loader_h” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">AC_LIBOBJ</span>([<span class="ruby-identifier">addr2line</span>])
</pre>

<p>])</p>

<p><a href=""$target_os"">AS_CASE(</a>, [linux* | gnu* | k*bsd*-gnu | bsdi* |
kopensolaris*-gnu], [</p>

<pre>AS_IF([test &quot;$rb_cv_binary_elf&quot; = no], [
    with_dln_a_out=yes
], [
    LDFLAGS=&quot;$LDFLAGS -rdynamic&quot;
])])</pre>

<p>LIBEXT=a</p>

<p>AC_SUBST(DLDFLAGS)dnl AC_SUBST(ARCH_FLAG)dnl AC_SUBST(MJIT_HEADER_FLAGS)dnl
AC_SUBST(MJIT_HEADER_INSTALL_DIR)dnl AC_SUBST(MJIT_CC)dnl AS_IF([test
“$GCC” = “yes”], [</p>

<pre>AS_CASE([&quot;$target_os&quot;],[aix*],[mjit_std_cflag=&quot;-std=gnu99&quot;])</pre>

<p>]) AC_SUBST(MJIT_CFLAGS, [${MJIT_CFLAGS-“-w ${mjit_std_cflag}
${orig_cflags}”}])dnl AC_SUBST(MJIT_OPTFLAGS,
[${MJIT_OPTFLAGS-&#39;$(optflags)&#39;}])dnl AC_SUBST(MJIT_DEBUGFLAGS,
[${MJIT_DEBUGFLAGS-&#39;$(debugflags)&#39;}])dnl AC_SUBST(MJIT_LDSHARED)dnl</p>

<p>AC_SUBST(STATIC)dnl AC_SUBST(CCDLFLAGS)dnl AC_SUBST(LDSHARED)dnl
AC_SUBST(LDSHAREDXX)dnl AC_SUBST(DLEXT)dnl AC_SUBST(DLEXT2)dnl
AC_SUBST(LIBEXT)dnl AC_SUBST(ASMEXT, S)dnl</p>

<p>STATIC=</p>

<p>AS_IF([test “$with_dln_a_out” != yes], [</p>

<pre>rb_cv_dlopen=unknown
AC_MSG_CHECKING(whether OS depend dynamic link works)
AS_IF([test &quot;$GCC&quot; = yes], [
  AS_CASE([&quot;$target_os&quot;],
  [darwin*], [
    # The -fno-common is needed if we wish to embed the Ruby interpreter
    # into a plugin module of some project (as opposed to embedding it
    # within the project&#39;s application).  The -I/usr/local/include is
    # needed because CPP as discovered by configure (cc -E -traditional)
    # fails to consult /usr/local/include by default.  This causes
    # mkmf.rb&#39;s have_header() to fail if the desired resource happens to be
    # installed in the /usr/local tree.
    RUBY_APPEND_OPTION(CCDLFLAGS, -fno-common)],
  [bsdi*|cygwin*|mingw*|aix*|interix*], [ ],
  [
    RUBY_APPEND_OPTION(CCDLFLAGS, -fPIC)])
], [
  AS_CASE([&quot;$target_os&quot;],
      [hpux*],          [CCDLFLAGS=&quot;$CCDLFLAGS +Z&quot;],
      [solaris*|irix*], [CCDLFLAGS=&quot;$CCDLFLAGS -KPIC&quot;],
      [sunos*],         [CCDLFLAGS=&quot;$CCDLFLAGS -PIC&quot;],
      [esix*|uxpds*],   [CCDLFLAGS=&quot;$CCDLFLAGS -KPIC&quot;],
                        [: ${CCDLFLAGS=&quot;&quot;}])
])

AC_ARG_ENABLE(rpath,
     AS_HELP_STRING([--enable-rpath], [embed run path into extension libraries.
     enabled by default on ELF platforms]),
     [enable_rpath=$enableval], [enable_rpath=&quot;$rb_cv_binary_elf&quot;])

AS_CASE([&quot;$target_os&quot;],
      [hpux*], [      DLDFLAGS=&quot;$DLDFLAGS -E&quot;
                      : ${LDSHARED=&#39;$(LD) -b&#39;}
                      XLDFLAGS=&quot;$XLDFLAGS -Wl,-E&quot;
                      : ${LIBPATHENV=SHLIB_PATH}
                      rb_cv_dlopen=yes],
      [solaris*], [   AS_IF([test &quot;$GCC&quot; = yes], [
                          : ${LDSHARED=&#39;$(CC) -shared&#39;}
                          AS_IF([test &quot;$rb_cv_prog_gnu_ld&quot; = yes], [
                              LDFLAGS=&quot;$LDFLAGS -Wl,-E&quot;
                          ])
                      ], [
                          : ${LDSHARED=&#39;$(CC) -G&#39;}
                      ])
                      AS_IF([test &quot;$ac_cv_sizeof_voidp&quot; = 8], [
                          : ${LIBPATHENV=LD_LIBRARY_PATH_64}
                          : ${PRELOADENV=LD_PRELOAD_64}
                      ], [
                          : ${LIBPATHENV=LD_LIBRARY_PATH_32}
                          : ${PRELOADENV=LD_PRELOAD_32}
                      ])
                      rb_cv_dlopen=yes],
      [sunos*], [     : ${LDSHARED=&#39;$(LD) -assert nodefinitions&#39;}
                      rb_cv_dlopen=yes],
      [irix*], [      : ${LDSHARED=&#39;$(LD) -shared&#39;}
                      rb_cv_dlopen=yes],
      [sysv4*], [     : ${LDSHARED=&#39;$(LD) -G&#39;}
                      rb_cv_dlopen=yes],
      [nto-qnx*], [   : ${LDSHARED=&#39;$(CC) -shared&#39;}
                      rb_cv_dlopen=yes],
      [esix*|uxpds*], [ : ${LDSHARED=&#39;$(LD) -G&#39;}
                      rb_cv_dlopen=yes],
      [osf*], [       : ${LDSHARED=&#39;$(LD) -shared -expect_unresolved &quot;*&quot;&#39;}
                      rb_cv_dlopen=yes],
      [bsdi3*], [     AS_CASE([&quot;$CC&quot;],
                      [*shlicc*], [   : ${LDSHARED=&#39;$(CC) -r&#39;}
                                      rb_cv_dlopen=yes])],
      [linux* | gnu* | k*bsd*-gnu | netbsd* | bsdi* | kopensolaris*-gnu | haiku*], [
                      : ${LDSHARED=&#39;$(CC) -shared&#39;}
                      AS_IF([test &quot;$rb_cv_binary_elf&quot; = yes], [
                          LDFLAGS=&quot;$LDFLAGS -Wl,-export-dynamic&quot;
                      ])
                      rb_cv_dlopen=yes],
      [interix*], [   : ${LDSHARED=&#39;$(CC) -shared&#39;}
                      XLDFLAGS=&quot;$XLDFLAGS -Wl,-E&quot;
                      LIBPATHFLAG=&quot; -L%1\$-s&quot;
                      rb_cv_dlopen=yes],
      [freebsd*|dragonfly*], [
                      : ${LDSHARED=&#39;$(CC) -shared&#39;}
                      AS_IF([test &quot;$rb_cv_binary_elf&quot; = yes], [
                          LDFLAGS=&quot;$LDFLAGS -rdynamic&quot;
                          DLDFLAGS=&quot;$DLDFLAGS &quot;&#39;-Wl,-soname,$@&#39;
                      ], [
                        test &quot;$GCC&quot; = yes &amp;&amp; test &quot;$rb_cv_prog_gnu_ld&quot; = yes || LDSHARED=&#39;$(LD) -Bshareable&#39;
                      ])
                      rb_cv_dlopen=yes],
      [openbsd*|mirbsd*], [   : ${LDSHARED=&#39;$(CC) -shared ${CCDLFLAGS}&#39;}
                      AS_IF([test &quot;$rb_cv_binary_elf&quot; = yes], [
                          LDFLAGS=&quot;$LDFLAGS -Wl,-E&quot;
                      ])
                      rb_cv_dlopen=yes],
      [darwin*], [    : ${LDSHARED=&#39;$(CC) -dynamic -bundle&#39;}
                      : ${DLDSHARED=&#39;$(CC) -dynamiclib&#39;}
                      : ${LDFLAGS=&quot;&quot;}
                      : ${LIBPATHENV=DYLD_FALLBACK_LIBRARY_PATH}
                      : ${PRELOADENV=DYLD_INSERT_LIBRARIES}
                      rb_cv_dlopen=yes],
      [aix*], [       : ${LDSHARED=&#39;$(CC)&#39;}
                      AS_IF([test &quot;$GCC&quot; = yes], [
                          LDSHARED=&quot;$LDSHARED ${linker_flag}-G -shared&quot;
                      ], [
                          LDSHARED=&quot;$LDSHARED ${linker_flag}-G&quot;
                      ])
                      EXTDLDFLAGS=&#39;-e$(TARGET_ENTRY)&#39;
                      XLDFLAGS=&quot;${linker_flag}&quot;&#39;-bE:$(ARCHFILE)&#39;&quot; ${linker_flag}-brtl&quot;
                      XLDFLAGS=&quot;$XLDFLAGS ${linker_flag}-blibpath:${prefix}/lib:${LIBPATH:-/usr/lib:/lib}&quot;
                      : ${ARCHFILE=&quot;ruby.imp&quot;}
                      TRY_LINK=&#39;$(CC) -oconftest $(INCFLAGS) -I$(hdrdir) $(CPPFLAGS)&#39;
                      TRY_LINK=&quot;$TRY_LINK&quot;&#39; $(CFLAGS) $(src) $(LIBPATH) $(LDFLAGS) $(LOCAL_LIBS) $(LIBS)&#39;
                      : ${LIBPATHENV=LIBPATH}
                      : ${PRELOADENV=LDR_PRELOAD}
                      rb_cv_dlopen=yes],
      [nto-qnx*], [   DLDFLAGS=&quot;$DLDFLAGS -L/lib -L/usr/lib -L/usr/local/lib&quot;
                      : ${LDSHARED=&#39;$(LD) -Bshareable -x&#39;}
                      LDFLAGS=&quot;$LDFLAGS -L/lib -L/usr/lib -L/usr/local/lib&quot;
                      rb_cv_dlopen=yes],
      [cygwin*|mingw*], [
                      : ${LDSHARED=&#39;$(CC) -shared&#39;}
                      XLDFLAGS=&quot;$XLDFLAGS -Wl,--stack,0x00200000,--enable-auto-import&quot;
                      DLDFLAGS=&quot;${DLDFLAGS} -Wl,--enable-auto-image-base,--enable-auto-import&quot;
                      : ${LIBPATHENV=PATH}
                      : ${PRELOADENV=&quot;&quot;}
                      rb_cv_dlopen=yes],
      [hiuxmpp], [    : ${LDSHARED=&#39;$(LD) -r&#39;}],
      [atheos*], [    : ${LDSHARED=&#39;$(CC) -shared&#39;}
                      rb_cv_dlopen=yes],
      [       : ${LDSHARED=&#39;$(LD)&#39;}])
AC_MSG_RESULT($rb_cv_dlopen)

AS_IF([test &quot;$rb_cv_dlopen&quot; = yes], [
  AS_CASE([&quot;$target_os&quot;],
    [darwin*], [
      for flag in \
        &quot;-undefined dynamic_lookup&quot; \
        &quot;-multiply_defined suppress&quot; \
        ; do
        test &quot;x${linker_flag}&quot; = x || flag=&quot;${linker_flag}`echo ${flag} | tr &#39; &#39; ,`&quot;
        RUBY_TRY_LDFLAGS([$flag], [], [flag=])
        AS_IF([test &quot;x$flag&quot; != x], [
          RUBY_APPEND_OPTIONS(DLDFLAGS, [$flag])
        ])
      done
    ])
])

AS_IF([test &quot;$enable_rpath:${RPATHFLAG}&quot; = yes:], [
    AS_IF([test &quot;x$rpathflag&quot; != x], [
        RPATHFLAG=&quot; ${rpathflag}%1\$-s&quot;
    ])
])</pre>

<p>]) AS_IF([test “${LDSHAREDXX}” = “”], [</p>

<pre>AS_CASE([&quot;${LDSHARED}&quot;],
    [*&#39;$(CC)&#39;*], [
        LDSHAREDXX=`echo &quot;${LDSHARED}&quot; | sed &#39;s/\$(CC)/$(CXX)/&#39;`
        ],
    [*&#39;${CC}&#39;*], [
        LDSHAREDXX=`echo &quot;${LDSHARED}&quot; | sed &#39;s/\${CC}/${CXX}/&#39;`
        ],
    [*$CC*], [
        LDSHAREDXX=`echo &quot;${LDSHARED}&quot; | sed &quot;s|$CC|$CXX|&quot;`
        ],
    [ld&quot; &quot;*], [
        ])</pre>

<p>]) <a href="${RPATHFLAG}">AS_CASE(</a>,[*&#39;%1$&#39;*],[:
${LIBPATHFLAG=&#39; -L%1$-s&#39;}],[: ${LIBPATHFLAG=&#39; -L%s&#39;}])</p>

<p>AC_SUBST(LINK_SO) AC_SUBST(LIBPATHFLAG) AC_SUBST(RPATHFLAG)
AC_SUBST(LIBPATHENV, “${LIBPATHENV-LD_LIBRARY_PATH}”) AC_SUBST(PRELOADENV,
“${PRELOADENV-LD_PRELOAD}”) AC_SUBST(TRY_LINK)</p>

<p>AS_IF([test “x$OPT_DIR” != x], [</p>

<pre>pat=`echo &quot;${LDFLAGS_OPTDIR}&quot; | sed [&#39;s/[][\\.*|]/\\\\&amp;/&#39;]`
LDFLAGS=`echo &quot;${LDFLAGS}&quot; | sed &quot;s| ${pat}||&quot;`
val=`IFS=&quot;$PATH_SEPARATOR&quot;
    for dir in $OPT_DIR; do
        echo x ${LIBPATHFLAG} ${RPATHFLAG} |
        sed &quot;s/^x *//;s${IFS}&quot;&#39;%1\\$-s&#39;&quot;${IFS}${dir}/lib${IFS}g;s${IFS}%s${IFS}${dir}/lib${IFS}g&quot;
    done | tr &#39;\012&#39; &#39; &#39; | sed &#39;s/ *$//&#39;`
AS_IF([test x&quot;$val&quot; != x], [
    test x&quot;${LDFLAGS}&quot; = x || LDFLAGS=&quot;$LDFLAGS &quot;
    LDFLAGS=&quot;$LDFLAGS$val&quot;
    test x&quot;${DLDFLAGS}&quot; = x || DLDFLAGS=&quot;$DLDFLAGS &quot;
    DLDFLAGS=&quot;$DLDFLAGS$val&quot;
])
LDFLAGS_OPTDIR=&quot;$val&quot;</pre>

<p>])</p>

<p><a href=""$target_os"">AS_CASE(</a>, [freebsd*], [</p>

<pre>AC_CHECK_LIB([procstat], [procstat_open_sysctl])
AS_IF([test &quot;x$ac_cv_lib_procstat_procstat_open_sysctl&quot; = xyes], [
    AC_CHECK_FUNCS(procstat_getvmmap)
])
])</pre>

<p><a href=""$target_cpu-$target_os"">AS_CASE(</a>,
[<strong>-darwin</strong>], [</p>

<pre>AC_CHECK_HEADERS([libproc.h])
AC_CHECK_HEADERS([execinfo.h])
AS_IF([test &quot;x$ac_cv_header_execinfo_h&quot; = xyes], [
    AC_CHECK_LIB([execinfo], [backtrace])
    AC_CHECK_HEADERS([libunwind.h])
])],</pre>

<p>[<strong>-freebsd</strong>|x86_64-netbsd*], [</p>

<pre>AC_CHECK_HEADERS([execinfo.h])
AS_IF([test &quot;x$ac_cv_header_execinfo_h&quot; = xyes], [
    AC_CHECK_LIB([execinfo], [backtrace])
    AC_CHECK_LIB([unwind], [unw_backtrace])
])])</pre>

<p>AC_CHECK_FUNCS(backtrace)</p>

<p>AS_IF([test “x$ac_cv_func_backtrace” = xyes], [</p>

<pre>AC_CACHE_CHECK(for broken backtrace, rb_cv_broken_backtrace,
  [AC_TRY_RUN([</pre>

<p>include &lt;unistd.h&gt; include &lt;stdio.h&gt; include &lt;stdlib.h&gt;
include &lt;stdint.h&gt; include &lt;string.h&gt; include &lt;signal.h&gt;
include &lt;execinfo.h&gt;</p>

<p>define TRACE_SIZE 256</p>

<p>void sigsegv(int signum, siginfo_t *info, void *ctx){</p>

<pre>void *trace[TRACE_SIZE];
int n = backtrace(trace, TRACE_SIZE);
if (n &gt; 0) {
    /*fprintf(stdout, &quot;backtrace:%d\n&quot;,n);*/
} else {
    _exit(EXIT_FAILURE);
}
_exit(EXIT_SUCCESS);</pre>

<p>} int main(void) {</p>

<pre>volatile int *a = NULL;
stack_t ss;
struct sigaction sa;

ss.ss_sp = malloc(SIGSTKSZ);
if (ss.ss_sp == NULL) {
    fprintf(stderr, &quot;cannot allocate memory for sigaltstack\n&quot;);
    return EXIT_FAILURE;
}
ss.ss_size = SIGSTKSZ;
ss.ss_flags = 0;
if (sigaltstack(&amp;ss, NULL) == -1) {
    fprintf(stderr, &quot;sigaltstack failed\n&quot;);
    return EXIT_FAILURE;
}
memset(&amp;sa, 0, sizeof(struct sigaction));
sigemptyset(&amp;sa.sa_mask);
sa.sa_sigaction = sigsegv;
sa.sa_flags |= SA_SIGINFO;
sa.sa_flags |= SA_ONSTACK;
sigaction(SIGSEGV, &amp;sa, NULL);
a[0] = 1;
return EXIT_SUCCESS;</pre>

<p>} ],</p>

<pre>      rb_cv_broken_backtrace=no,
      rb_cv_broken_backtrace=yes,
      rb_cv_broken_backtrace=no)])
AS_IF([test &quot;$rb_cv_broken_backtrace&quot; = yes], [
  AC_DEFINE(BROKEN_BACKTRACE, 1)
])</pre>

<p>])</p>

<p>AC_ARG_WITH(valgrind,</p>

<pre>AS_HELP_STRING([--without-valgrind],[disable valgrind memcheck support]),
[], with_valgrind=yes)</pre>

<p>AS_IF([test x$with_valgrind != xno],</p>

<pre>[AC_CHECK_HEADERS(valgrind/memcheck.h)])</pre>

<p>dln_a_out_works=no AS_IF([test “$ac_cv_header_a_out_h” = yes], [</p>

<pre>AS_IF([test &quot;$with_dln_a_out&quot; = yes || test &quot;$rb_cv_dlopen&quot; = unknown], [
  cat confdefs.h &gt; config.h
  AC_CACHE_CHECK(whether matz&#39;s dln works, rb_cv_dln_a_out,
  [AC_TRY_COMPILE([</pre>

<p>define USE_DLN_A_OUT include “dln.c” ],</p>

<pre>      [],
      rb_cv_dln_a_out=yes,
      rb_cv_dln_a_out=no)])
  AS_IF([test &quot;$rb_cv_dln_a_out&quot; = yes], [
    dln_a_out_works=yes
    AC_DEFINE(USE_DLN_A_OUT)
  ])
])</pre>

<p>])</p>

<p>AS_IF([test “$dln_a_out_works” = yes], [</p>

<pre>AS_IF([test &quot;$GCC&quot; = yes], [
  STATIC=-static
], [
  STATIC=-Bstatic
])
DLEXT=so
CCDLFLAGS=</pre>

<p>], [</p>

<pre>AS_CASE([&quot;$target_os&quot;],
  [hpux*], [
      DLEXT=sl],
  [darwin*], [
      SOEXT=dylib
      DLEXT=bundle],
  [cygwin*|mingw*|*djgpp*], [
      LOAD_RELATIVE=1
      SOEXT=dll
      DLEXT=so],
  [
      DLEXT=so])</pre>

<p>]) : ${SOEXT=“${DLEXT}”} AC_SUBST(SOEXT) AS_IF([test
“$rb_cv_dlopen:$load_relative” = yes:yes], [</p>

<pre>AS_IF([test &quot;$ac_cv_func_dladdr&quot; = yes], [
    LOAD_RELATIVE=1
])</pre>

<p>]) AS_IF([test x“$LOAD_RELATIVE” = x1], [</p>

<pre class="ruby"><span class="ruby-identifier">load_relative</span>=<span class="ruby-identifier">yes</span>
</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-identifier">unset</span> <span class="ruby-identifier">load_relative</span>
</pre>

<p>])</p>

<p>len=2 # .rb n=`expr “$DLEXT”  : &#39;.*&#39;`; test “$n” -gt “$len”
&amp;&amp; len=$n n=`expr “$DLEXT2” : &#39;.*&#39;`; test “$n” -gt “$len”
&amp;&amp; len=$n AC_DEFINE_UNQUOTED(DLEXT_MAXLEN, `expr $len + 1`) test
“.$DLEXT”  = “.” || AC_DEFINE_UNQUOTED(DLEXT,  “.$DLEXT”) test “.$DLEXT2” =
“.” || AC_DEFINE_UNQUOTED(DLEXT2, “.$DLEXT2”) AC_SUBST(DLEXT)</p>

<p>AS_IF([test “$with_dln_a_out” = yes], [</p>

<pre class="ruby"><span class="ruby-constant">STRIP</span>=<span class="ruby-keyword">true</span>
</pre>

<p>], [</p>

<pre>AC_CHECK_TOOL(STRIP, strip, :)dnl</pre>

<p>])</p>

<p><a href=""$target_os"">AS_CASE(</a>,</p>

<pre>[linux* | gnu* | k*bsd*-gnu | kopensolaris*-gnu], [
      STRIP=&quot;$STRIP -S -x&quot;],
[darwin*], [
      STRIP=&quot;$STRIP -A -n&quot;])</pre>

<p>AC_ARG_WITH(ext,</p>

<pre>AC_HELP_STRING([--with-ext=EXTS],
               [pass to --with-ext option of extmk.rb]))</pre>

<p>AC_ARG_WITH(out-ext,</p>

<pre>AC_HELP_STRING([--with-out-ext=EXTS],
               [pass to --without-ext option of extmk.rb]))</pre>

<p>EXTSTATIC= AC_SUBST(EXTSTATIC)dnl AC_ARG_WITH(static-linked-ext,</p>

<pre>AS_HELP_STRING([--with-static-linked-ext], [link external modules statically]),
[AS_CASE([$withval],[yes],[STATIC=;EXTSTATIC=static],[no],[],[EXTSTATIC=&quot;$withval&quot;])])</pre>

<p><a href="",$EXTSTATIC,"">AS_CASE(</a>, [,static,|*,enc,*], [</p>

<pre class="ruby"><span class="ruby-constant">ENCOBJS</span>=<span class="ruby-string">&#39;enc/encinit.$(OBJEXT) enc/libenc.$(LIBEXT) enc/libtrans.$(LIBEXT)&#39;</span>
<span class="ruby-constant">EXTOBJS</span>=<span class="ruby-string">&#39;ext/extinit.$(OBJEXT)&#39;</span>
<span class="ruby-constant">AC_DEFINE_UNQUOTED</span>(<span class="ruby-constant">EXTSTATIC</span>, <span class="ruby-value">1</span>)
<span class="ruby-constant">AC_SUBST</span>(<span class="ruby-constant">ENCSTATIC</span>, <span class="ruby-identifier">static</span>)
</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">ENCOBJS</span>=<span class="ruby-string">&#39;dmyenc.$(OBJEXT)&#39;</span>
<span class="ruby-constant">EXTOBJS</span>=<span class="ruby-string">&#39;dmyext.$(OBJEXT)&#39;</span>
</pre>

<p>]) AC_SUBST(ENCOBJS) AC_SUBST(EXTOBJS)</p>

<p>AC_ARG_WITH(setup,</p>

<pre>AS_HELP_STRING([--with-setup=SETUP], [use extension libraries setup]),
[setup=$withval])</pre>

<p>AS_IF([test -n “$setup”], [</p>

<pre>AS_IF([! test -f &quot;ext/$setup&quot; -o -f &quot;$srcdir/ext/$setup&quot;], [
    AC_MSG_ERROR(Setup file $setup not found under ext or $srcdir/ext)
])</pre>

<p>], [test -f “$srcdir/ext/Setup.$target_os”], [</p>

<pre class="ruby"><span class="ruby-identifier">setup</span>=<span class="ruby-string">&quot;Setup.$target_os&quot;</span>
</pre>

<p>], [</p>

<pre>setup=
for file in &quot;$srcdir&quot;/ext/Setup.*; do
    AS_CASE([&quot;$file&quot;], [*~|*.bak|*.orig|*.rej|*.tmp], [continue])
    setup=`basename &quot;$file&quot;`
    AS_CASE([&quot;$target_os&quot;], [`expr &quot;$setup&quot; : &#39;Setup.\(.*\)&#39;`*], [break])
    platform=`sed &#39;/^option  *platform  */!d;s///;s/|/*|/g;q&#39; &quot;$file&quot;`
    AS_IF([test &quot;x$platform&quot; != x], [
        eval &quot;AS_CASE([\&quot;\$target_os\&quot;], [$platform*], [break])&quot;
    ])
    setup=
done
: ${setup:=Setup}</pre>

<p>]) AC_SUBST(setup)</p>

<p>rubylibprefix=&#39;${libdir}/${RUBY_BASE_NAME}&#39;
AC_ARG_WITH(rubylibprefix,</p>

<pre>AS_HELP_STRING([--with-rubylibprefix=DIR], [prefix for ruby libraries [[LIBDIR/RUBY_BASE_NAME]]]),
[AS_IF([test &quot;x$withval&quot; = xno], [
    AC_MSG_ERROR([No ruby, No libprefix])
])
rubylibprefix=&quot;$withval&quot;])</pre>

<p>AC_SUBST(rubylibprefix)</p>

<p>AS_IF([test x“${exec_prefix}” != xNONE], [</p>

<pre class="ruby"><span class="ruby-constant">RUBY_EXEC_PREFIX</span>=<span class="ruby-string">&quot;$exec_prefix&quot;</span>
</pre>

<p>], [test x“$prefix” != xNONE], [</p>

<pre class="ruby"><span class="ruby-constant">RUBY_EXEC_PREFIX</span>=<span class="ruby-string">&quot;$prefix&quot;</span>
</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">RUBY_EXEC_PREFIX</span>=<span class="ruby-identifier">$ac_default_prefix</span>
</pre>

<p>]) pat=`echo “${RUBY_EXEC_PREFIX}” | tr -c &#39;012&#39; .`&#39;(.*)&#39;
for var in bindir libdir rubylibprefix; do</p>

<pre>eval val=&#39;&quot;$&#39;$var&#39;&quot;&#39;
AS_CASE([&quot;$val&quot;], [&quot;${RUBY_EXEC_PREFIX}&quot;*], [val=&#39;${exec_prefix}&#39;&quot;`expr \&quot;$val\&quot; : \&quot;$pat\&quot;`&quot;])
eval $var=&#39;&quot;$val&quot;&#39;</pre>

<p>done</p>

<p>BTESTRUBY=&#39;$(MINIRUBY)&#39; BOOTSTRAPRUBY=&#39;$(BASERUBY)&#39;
AS_IF([test x“$cross_compiling” = xyes], [</p>

<pre>test x&quot;$MINIRUBY&quot; = x &amp;&amp; MINIRUBY=&quot;${RUBY-$BASERUBY} -I`$CHDIR .; pwd` &quot;-r&#39;$(arch)-fake&#39;
XRUBY_LIBDIR=`${RUBY-$BASERUBY} -rrbconfig -e [&#39;puts RbConfig::CONFIG[&quot;libdir&quot;]&#39;]`
XRUBY_RUBYLIBDIR=`${RUBY-$BASERUBY} -rrbconfig -e [&#39;puts RbConfig::CONFIG[&quot;rubylibdir&quot;]&#39;]`
XRUBY_RUBYHDRDIR=`${RUBY-$BASERUBY} -rrbconfig -e [&#39;puts RbConfig::CONFIG[&quot;rubyhdrdir&quot;]&#39;]`
AC_SUBST(XRUBY_LIBDIR)
AC_SUBST(XRUBY_RUBYLIBDIR)
AC_SUBST(XRUBY_RUBYHDRDIR)
PREP=&#39;$(arch)-fake.rb&#39;
RUNRUBY_COMMAND=&#39;$(MINIRUBY) -I`cd $(srcdir)/lib; pwd`&#39;
RUNRUBY=&#39;$(RUNRUBY_COMMAND)&#39;
XRUBY=&#39;$(MINIRUBY)&#39;
TEST_RUNNABLE=no
CROSS_COMPILING=yes
AC_DEFINE(CROSS_COMPILING, 1)</pre>

<p>], [</p>

<pre>MINIRUBY=&#39;./miniruby$(EXEEXT) -I$(srcdir)/lib -I.&#39;
MINIRUBY=&quot;$MINIRUBY&quot;&#39; -I$(EXTOUT)/common&#39;
PREP=&#39;miniruby$(EXEEXT)&#39;
RUNRUBY_COMMAND=&#39;$(MINIRUBY) $(srcdir)/tool/runruby.rb --extout=$(EXTOUT) $(RUNRUBYOPT)&#39;
RUNRUBY=&#39;$(RUNRUBY_COMMAND) --&#39;
XRUBY=&#39;$(RUNRUBY)&#39;
AS_CASE([&quot;$HAVE_BASERUBY:$build_os&quot;], [no:*|*:mingw*], [BOOTSTRAPRUBY=&#39;$(MINIRUBY)&#39;])
TEST_RUNNABLE=yes
CROSS_COMPILING=no</pre>

<p>]) AC_SUBST(TEST_RUNNABLE) AC_SUBST(CROSS_COMPILING) AC_SUBST(MINIRUBY)
AC_SUBST(BTESTRUBY) AC_SUBST(PREP) AC_SUBST(RUNRUBY_COMMAND)
AC_SUBST(RUNRUBY) AC_SUBST(XRUBY) AC_SUBST(BOOTSTRAPRUBY) AC_SUBST(EXTOUT,
[${EXTOUT=.ext}])</p>

<p>FIRSTMAKEFILE=“” LIBRUBY_A=&#39;lib$(RUBY_SO_NAME)-static.a&#39;
LIBRUBY=&#39;$(LIBRUBY_A)&#39;
LIBRUBYARG_STATIC=&#39;-l$(RUBY_SO_NAME)-static&#39;
LIBRUBYARG=&#39;$(LIBRUBYARG_STATIC)&#39; SOLIBS=&#39;$(MAINLIBS)&#39;</p>

<p><a href=""$target_os"">AS_CASE(</a>,</p>

<pre>[cygwin*|mingw*|haiku*|darwin*], [
  : ${DLDLIBS=&quot;&quot;}
  ],
[
  DLDLIBS=&quot;$DLDLIBS -lc&quot;
  ])</pre>

<p>AC_ARG_ENABLE(multiarch,</p>

<pre>AS_HELP_STRING([--enable-multiarch], [enable multiarch compatible directories]),
[multiarch=], [unset multiarch])</pre>

<p>AS_IF([test ${multiarch+set}], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE</span>(<span class="ruby-constant">ENABLE_MULTIARCH</span>)
<span class="ruby-constant">MJIT_HEADER_INSTALL_DIR</span>=<span class="ruby-identifier">include</span><span class="ruby-operator">/</span><span class="ruby-string">&#39;${arch}/${RUBY_VERSION_NAME}&#39;</span>
</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">MJIT_HEADER_INSTALL_DIR</span>=<span class="ruby-identifier">include</span><span class="ruby-operator">/</span><span class="ruby-string">&#39;${RUBY_VERSION_NAME}/${arch}&#39;</span>
</pre>

<p>])</p>

<p>archlibdir=&#39;${libdir}/${arch}&#39;
sitearchlibdir=&#39;${libdir}/${sitearch}&#39;
archincludedir=&#39;${includedir}/${arch}&#39;
sitearchincludedir=&#39;${includedir}/${sitearch}&#39;</p>

<p>AC_ARG_WITH(soname,</p>

<pre>AS_HELP_STRING([--with-soname=SONAME], [base name of shared library]),
[RUBY_SO_NAME=$withval],
[
    AS_CASE([&quot;$target_os&quot;],
    [darwin*], [
        RUBY_SO_NAME=&#39;$(RUBY_BASE_NAME).$(RUBY_API_VERSION)&#39;
    ],
    [cygwin*], [
        RUBY_SO_NAME=&#39;$(RUBY_BASE_NAME)$(MAJOR)$(MINOR)0&#39;
    ],
    [mingw*], [
        RUBY_SO_NAME=&quot;${rb_cv_msvcrt}&quot;&#39;-$(RUBY_BASE_NAME)$(MAJOR)$(MINOR)0&#39;
        AS_IF([test x&quot;${target_cpu}&quot; != xi386], [
            RUBY_SO_NAME=&quot;${target_cpu}-${RUBY_SO_NAME}&quot;
        ])
    ],
    [RUBY_SO_NAME=&#39;$(RUBY_BASE_NAME)&#39;])
])</pre>

<p>LIBRUBY_LDSHARED=${DLDSHARED=${LDSHARED}} LIBRUBY_DLDFLAGS=$DLDFLAGS
LIBRUBY_SO=&#39;lib$(RUBY_SO_NAME).$(SOEXT).$(RUBY_PROGRAM_VERSION)&#39;
LIBRUBY_SONAME=&#39;lib$(RUBY_SO_NAME).$(SOEXT).$(RUBY_API_VERSION)&#39;
LIBRUBY_ALIASES=&#39;lib$(RUBY_SO_NAME).$(SOEXT)&#39; ENABLE_SHARED=no</p>

<p>AC_ARG_ENABLE(shared,</p>

<pre>AS_HELP_STRING([--enable-shared], [build a shared library for Ruby]),
[enable_shared=$enableval])</pre>

<p>libprefix=${multiarch+&#39;$(archlibdir)&#39;}${multiarch-&#39;$(libdir)&#39;}
LIBRUBY_RELATIVE=${load_relative-no} AS_CASE(“$enable_shared”, [yes], [</p>

<pre>LIBRUBY=&#39;$(LIBRUBY_SO)&#39;
LIBRUBYARG_SHARED=&#39;-l$(RUBY_SO_NAME)&#39;
LIBRUBYARG=&#39;$(LIBRUBYARG_SHARED)&#39;
LIBRUBY_RELATIVE=no
test -z &quot;$CCDLFLAGS&quot; || CFLAGS=&quot;$CFLAGS $CCDLFLAGS&quot;
ENABLE_SHARED=yes

# libdir can be overridden in config.site file (on OpenSUSE at least).
libdir_basename=lib
AS_IF([test &quot;$bindir&quot; = &#39;${exec_prefix}/bin&#39;], [
  AS_CASE([&quot;$libdir&quot;], [&#39;${exec_prefix}/&#39;*], [libdir_basename=`basename &quot;$libdir&quot;`])
])
AC_DEFINE_UNQUOTED(LIBDIR_BASENAME, [&quot;${libdir_basename}&quot;])
libdir_basename=&quot;${libdir_basename}&quot;${multiarch+&#39;/${arch}&#39;}

AS_CASE([&quot;$target_os&quot;],
  [freebsd*|dragonfly*], [],
  [
   AS_IF([test &quot;$GCC&quot; = yes], [
     RUBY_TRY_LDFLAGS([${linker_flag}--no-undefined], [no_undefined=yes], [no_undefined=no])
     AS_IF([test &quot;no_undefined&quot; = yes], [
        RUBY_APPEND_OPTION(EXTLDFLAGS, [${linker_flag}--no-undefined])
     ])
   ])
  ])

AS_CASE([&quot;$target_os&quot;],
  [sunos4*], [
      LIBRUBY_ALIASES=&#39;$(LIBRUBY_SONAME) lib$(RUBY_SO_NAME).$(SOEXT)&#39;
      ],
  [linux* | gnu* | k*bsd*-gnu | atheos* | kopensolaris*-gnu | haiku*], [
      RUBY_APPEND_OPTIONS(LIBRUBY_DLDFLAGS, [&#39;-Wl,-soname,$(LIBRUBY_SONAME)&#39; &quot;$LDFLAGS_OPTDIR&quot;])
      LIBRUBY_ALIASES=&#39;$(LIBRUBY_SONAME) lib$(RUBY_SO_NAME).$(SOEXT)&#39;
      AS_IF([test &quot;$load_relative&quot; = yes], [
          libprefix=&quot;&#39;\$\${ORIGIN}/../${libdir_basename}&#39;&quot;
          LIBRUBY_RPATHFLAGS=&quot;-Wl,-rpath,${libprefix}&quot;
          LIBRUBY_RELATIVE=yes
      ])
      ],
  [freebsd*|dragonfly*], [
      LIBRUBY_SO=&#39;lib$(RUBY_SO_NAME).$(SOEXT).$(MAJOR)$(MINOR)&#39;
      LIBRUBY_SONAME=&#39;$(LIBRUBY_SO)&#39;
      AS_IF([test &quot;$rb_cv_binary_elf&quot; != &quot;yes&quot; ], [
          LIBRUBY_SO=&quot;$LIBRUBY_SO.\$(TEENY)&quot;
          LIBRUBY_ALIASES=&#39;&#39;
      ])
      ],
  [netbsd*], [
      LIBRUBY_SONAME=&#39;lib$(RUBY_SO_NAME).$(SOEXT).$(MAJOR)$(MINOR)&#39;
      LIBRUBY_SO=&quot;${LIBRUBY_SONAME}&quot;&#39;.$(TEENY)&#39;
      RUBY_APPEND_OPTIONS(LIBRUBY_DLDFLAGS, [&#39;-Wl,-soname,$(LIBRUBY_SONAME)&#39; &quot;$LDFLAGS_OPTDIR&quot;])
      AS_IF([test &quot;$rb_cv_binary_elf&quot; = yes], [ # ELF platforms
         LIBRUBY_ALIASES=&#39;$(LIBRUBY_SONAME) lib$(RUBY_SO_NAME).$(SOEXT)&#39;
      ], [    # a.out platforms
         LIBRUBY_ALIASES=&quot;&quot;
      ])
      ],
  [openbsd*|mirbsd*], [
      LIBRUBY_SO=&#39;lib$(RUBY_SO_NAME).$(SOEXT).$(MAJOR).&#39;`expr ${MINOR} \* 10 + ${TEENY}`
      ],
  [solaris*], [
      LIBRUBY_SO=&#39;lib$(RUBY_SO_NAME).$(SOEXT).$(MAJOR)&#39;
      LIBRUBY_SONAME=&#39;lib$(RUBY_SO_NAME).$(SOEXT).$(RUBY_PROGRAM_VERSION)&#39;
      LIBRUBY_ALIASES=&#39;$(LIBRUBY_SONAME) lib$(RUBY_SO_NAME).$(SOEXT)&#39;
      RUBY_APPEND_OPTIONS(LIBRUBY_DLDFLAGS, [&quot;${linker_flag}-h${linker_flag:+,}&quot;&#39;$(@F)&#39;])
      XLDFLAGS=&quot;$XLDFLAGS &quot;&#39;-R${libdir}&#39;
      ],
  [hpux*], [
      XLDFLAGS=&quot;$XLDFLAGS &quot;&#39;-Wl,+s,+b,$(libdir)&#39;
      LIBRUBY_ALIASES=&#39;$(LIBRUBY_SONAME) lib$(RUBY_SO_NAME).$(SOEXT)&#39;
      ],
  [aix*], [
      RUBY_APPEND_OPTIONS(LIBRUBY_DLDFLAGS, [&quot;${linker_flag}-bnoentry&quot; &quot;$XLDFLAGS&quot; &quot;$LDFLAGS_OPTDIR&quot;])
      LIBRUBYARG_SHARED=&#39;-L${libdir} -l${RUBY_SO_NAME}&#39;
      LIBS=&quot;$LIBS -lm -lc&quot;
      ],
  [darwin*], [
      LIBRUBY_SO=&#39;lib$(RUBY_SO_NAME).$(SOEXT)&#39;
      LIBRUBY_SONAME=&#39;$(LIBRUBY_SO)&#39;
      LIBRUBY_ALIASES=&#39;lib$(RUBY_INSTALL_NAME).$(SOEXT)&#39;
      AS_IF([test &quot;$load_relative&quot; = yes], [
          libprefix=&quot;@executable_path/../${libdir_basename}&quot;
          LIBRUBY_RELATIVE=yes
      ])
      LIBRUBY_DLDFLAGS=&quot;$LIBRUBY_DLDFLAGS -install_name ${libprefix}&quot;&#39;/$(LIBRUBY_SONAME)&#39;
      LIBRUBY_DLDFLAGS=&quot;$LIBRUBY_DLDFLAGS &quot;&#39;-compatibility_version $(RUBY_API_VERSION)&#39;
      LIBRUBY_DLDFLAGS=&quot;$LIBRUBY_DLDFLAGS &quot;&#39;-current_version $(RUBY_PROGRAM_VERSION)&#39;
      AS_IF([test &quot;$visibility_option&quot; = ld], [
          LIBRUBY_DLDFLAGS=&quot;$LIBRUBY_DLDFLAGS &quot;&#39;-Wl,-unexported_symbol,_Init_*&#39;
          LIBRUBY_DLDFLAGS=&quot;$LIBRUBY_DLDFLAGS &quot;&#39;-Wl,-unexported_symbol,_ruby_static_id_*&#39;
          LIBRUBY_DLDFLAGS=&quot;$LIBRUBY_DLDFLAGS &quot;&#39;-Wl,-unexported_symbol,*_threadptr_*&#39;
      ])
      LIBRUBY_DLDFLAGS=&quot;$LIBRUBY_DLDFLAGS &quot;&#39; $(XLDFLAGS)&#39;
      ],
  [interix*], [
      LIBRUBYARG_SHARED=&#39;-L. -L${libdir} -l$(RUBY_SO_NAME)&#39;
      ],
  [mingw*|cygwin*|mswin*], [
      LIBRUBY_RELATIVE=yes
      ])</pre>

<p>], [</p>

<pre>LIBRUBYARG_SHARED=

# enable PIE if possible
AC_ARG_ENABLE(pie,
        AS_HELP_STRING([--disable-pie], [disable PIE feature]),
        [pie=$enableval], [pie=])
AS_IF([test &quot;$GCC&quot; = yes -a -z &quot;$EXTSTATIC&quot; -a &quot;x$pie&quot; != xno], [
  RUBY_TRY_CFLAGS(-fPIE, [pie=yes], [pie=no])
  AS_IF([test &quot;$pie&quot; = yes], [
    # Use -fPIE when testing -pie.  RUBY_TRY_LDFLAGS sets
    # $save_CFLAGS internally, so set other name here.
    save_CFLAGS_before_pie=&quot;$CFLAGS&quot;
    CFLAGS=&quot;$CFLAGS -fPIE&quot;

    # gcc need -pie but clang need -Wl,-pie.
    for pie in -pie -Wl,-pie; do
      RUBY_TRY_LDFLAGS([$pie], [], [pie=])
      AS_IF([test &quot;x$pie&quot; != x], [
        RUBY_APPEND_OPTION(XCFLAGS, -fPIE)
        RUBY_APPEND_OPTION(XLDFLAGS, $pie)
        break
      ])
    done
    CFLAGS=&quot;$save_CFLAGS_before_pie&quot;
  ])
])</pre>

<p>]) AS_IF([test “$enable_rpath” = yes], [</p>

<pre>test -z &quot;$LIBRUBY_RPATHFLAGS&quot; || LIBRUBY_RPATHFLAGS=&quot;$LIBRUBY_RPATHFLAGS &quot;
rpathflag=&quot;${RPATHFLAG}&quot;
AS_CASE([&quot;${cross_compiling}${load_relative}&quot;], [*yes*], [], [rpathflag=&quot;$RPATHFLAG$LIBPATHFLAG&quot;])
rpathflag=`IFS=&quot;$PATH_SEPARATOR&quot;
    echo x &quot;$rpathflag&quot; |
    sed &quot;s/^x *//;s${IFS}&quot;&#39;%1\\$-s&#39;&quot;${IFS}${libprefix}${IFS}g;s${IFS}%s${IFS}${libprefix}${IFS}g&quot;
`
LIBRUBY_RPATHFLAGS=&quot;$LIBRUBY_RPATHFLAGS${rpathflag}&quot;
LIBRUBYARG_SHARED=&quot;$LIBRUBY_RPATHFLAGS $LIBRUBYARG_SHARED&quot;
LIBRUBYARG_STATIC=&quot;$LIBRUBY_RPATHFLAGS $LIBRUBYARG_STATIC&quot;</pre>

<p>]) AC_SUBST(LIBRUBY_RELATIVE)</p>

<p>LDFLAGS=“-L. $LDFLAGS” AC_SUBST(ARCHFILE)</p>

<p>AS_IF([test “$EXEEXT” = .exe], [</p>

<pre class="ruby"><span class="ruby-constant">EXECUTABLE_EXTS</span>=<span class="ruby-string">&#39;&quot;.exe&quot;,&quot;.com&quot;,&quot;.cmd&quot;,&quot;.bat&quot;&#39;</span>
<span class="ruby-constant">AC_DEFINE_UNQUOTED</span>(<span class="ruby-constant">EXECUTABLE_EXTS</span>, <span class="ruby-identifier">$EXECUTABLE_EXTS</span>)
<span class="ruby-constant">EXECUTABLE_EXTS</span>=<span class="ruby-value">%x`echo $EXECUTABLE_EXTS | tr -d &#39;&quot;&#39; | tr , &#39; &#39;`</span>
<span class="ruby-constant">AC_SUBST</span>(<span class="ruby-constant">EXECUTABLE_EXTS</span>)
</pre>

<p>])</p>

<p>AS_CASE(“$cross_compiling:${LIBPATHENV}”, [yes:* | no:], [], [</p>

<pre>AC_MSG_CHECKING(whether wrapper for $LIBPATHENV is needed)
AS_IF([env ${LIBPATHENV}=/lib /bin/sh -c &#39;: ${&#39;${LIBPATHENV}&#39;?}&#39; 2&gt;/dev/null],
    [AC_MSG_RESULT(no)],
    [PREP=&quot;$PREP&quot;&#39; exe/$(PROGRAM)&#39;
    AC_MSG_RESULT(yes)]
)</pre>

<p>])</p>

<p>AC_ARG_ENABLE(dtrace,</p>

<pre>AS_HELP_STRING([--enable-dtrace],
[enable DTrace for tracing inside ruby. enabled by default on systems having dtrace]),
[enable_dtrace=$enableval], [enable_dtrace=auto])</pre>

<p>LIBRUBY_A_OBJS=&#39;$(OBJS)&#39; DTRACE_REBUILD= <a
href=""${enable_dtrace}"">AS_CASE(</a>, [yes|auto], [</p>

<pre class="ruby"><span class="ruby-constant">RUBY_DTRACE_AVAILABLE</span>()
</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-identifier">rb_cv_dtrace_available</span>=<span class="ruby-identifier">no</span>
</pre>

<p>]) AS_IF([test “${enable_dtrace}” = yes], [dnl</p>

<pre>AS_IF([test -z &quot;$DTRACE&quot;], [dnl
    AC_MSG_ERROR([dtrace(1) is missing])
], [test &quot;$cross_compiling&quot; = yes], [dnl
    AC_MSG_ERROR([--enable-dtrace, however, cross compiling])
], [test &quot;${rb_cv_dtrace_available}&quot; = &quot;no&quot;], [dnl
   AC_MSG_ERROR([--enable-dtrace, however, USDT is not available])
])</pre>

<p>]) <a href="$rb_cv_dtrace_available">AS_CASE(</a>, [yes*], [dnl</p>

<pre>RUBY_DTRACE_POSTPROCESS()
AS_IF([test &quot;$rb_cv_prog_dtrace_g&quot; != no], [dnl
    DTRACE_OBJ=&#39;probes.$(OBJEXT)&#39;
])
AS_IF([test &quot;$rb_cv_prog_dtrace_g&quot; = rebuild], [dnl
    DTRACE_REBUILD=yes
    LIBRUBY_A_OBJS=&#39;$(DTRACE_GLOMMED_OBJ)&#39;
])
AS_CASE(&quot;${target_os}&quot;, [freebsd*], [dnl
    # FreeBSD&#39;s dtrace requires libelf
    LIBS=&quot;-lelf $LIBS&quot;
])
DTRACE_EXT=d</pre>

<p>], [dnl</p>

<pre class="ruby"><span class="ruby-identifier">enable_dtrace</span>=<span class="ruby-identifier">no</span>
<span class="ruby-constant">DTRACE_EXT</span>=<span class="ruby-identifier">dmyh</span>
</pre>

<p>]) AC_SUBST(DTRACE_EXT) AC_SUBST(DTRACE_OBJ) AC_SUBST(DTRACE_REBUILD)
AC_SUBST(DTRACE_OPT) AC_SUBST(LIBRUBY_A_OBJS)</p>

<p>AC_ARG_ENABLE(gcov,</p>

<pre>AS_HELP_STRING([--enable-gcov], [enable coverage measurement by gcov]),
[gcov=yes])</pre>

<p>AS_IF([test x“$gcov” = xyes], [</p>

<pre class="ruby"><span class="ruby-constant">CFLAGS</span>=<span class="ruby-string">&quot;$CFLAGS -coverage&quot;</span>
<span class="ruby-constant">LDFLAGS</span>=<span class="ruby-string">&quot;$LDFLAGS -coverage&quot;</span>
</pre>

<p>])</p>

<p>RUBY_SETJMP_TYPE }</p>

<p>: “build section” &amp;&amp; { dnl build rdoc index if requested
RDOCTARGET=“” CAPITARGET=“” AC_ARG_ENABLE(install-doc,</p>

<pre>AS_HELP_STRING([--disable-install-doc], [do not install either rdoc indexes or C API documents during install]),
[install_doc=$enableval], [install_doc=yes])</pre>

<p>AC_ARG_WITH(rdoc,</p>

<pre>AS_HELP_STRING([--with-rdoc=ri,html], [comma/space separated list of RDoc formats to install]),
[install_rdoc=`echo ,$withval, | sed &#39;y/,/ /;s/ ri / rdoc /;s/^ *//;s/ *$//&#39;`], [</pre>

<p>AC_ARG_ENABLE(install-rdoc,</p>

<pre>AS_HELP_STRING([--disable-install-rdoc], [do not install rdoc indexes during install]),
[install_rdoc=$enableval], [install_rdoc=yes])</pre>

<p>]) AC_ARG_ENABLE(install-capi,</p>

<pre>AS_HELP_STRING([--disable-install-capi], [do not install C API documents during install]),
[install_capi=$enableval], [install_capi=no])</pre>

<p>AS_IF([test “$install_doc” != no], [</p>

<pre>AS_CASE([&quot;$install_rdoc&quot;],
[yes], [
    RDOCTARGET=&quot;rdoc&quot;
],
[all], [
    RDOCTARGET=&quot;rdoc html&quot;
],
[no|&#39;&#39;], [
    RDOCTARGET=&quot;nodoc&quot;
],
[
    RDOCTARGET=&quot;$install_rdoc&quot;
])
AS_IF([test &quot;$install_capi&quot; != no -a -n &quot;$DOXYGEN&quot;], [
    CAPITARGET=&quot;capi&quot;
], [
    CAPITARGET=&quot;nodoc&quot;
])</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">RDOCTARGET</span>=<span class="ruby-string">&quot;nodoc&quot;</span>
<span class="ruby-constant">CAPITARGET</span>=<span class="ruby-string">&quot;nodoc&quot;</span>
</pre>

<p>])</p>

<p>AC_SUBST(RDOCTARGET) AC_SUBST(CAPITARGET)</p>

<p><a href=""$RDOCTARGET:$CAPITARGET"">AS_CASE(</a>,[<a
href="INSTALLDOC=nodoc">nodoc:nodoc],</a>,[INSTALLDOC=all])
AC_SUBST(INSTALLDOC)</p>

<p>AC_ARG_ENABLE(jit-support,</p>

<pre>AS_HELP_STRING([--disable-jit-support], [disable JIT features]),
[MJIT_SUPPORT=$enableval
 AS_IF([test x&quot;$enable_jit_support&quot; = &quot;xyes&quot;],
         [AC_DEFINE(USE_MJIT, 1)],
         [AC_DEFINE(USE_MJIT, 0)])],
[MJIT_SUPPORT=yes
 AC_DEFINE(USE_MJIT, 1)])</pre>

<p>AC_SUBST(MJIT_SUPPORT)</p>

<p>AC_ARG_ENABLE(install-static-library,</p>

<pre>AS_HELP_STRING([--disable-install-static-library], [do not install static ruby library]),
[INSTALL_STATIC_LIBRARY=$enableval],
AS_IF([test x&quot;$enable_shared&quot; = xyes],
    [INSTALL_STATIC_LIBRARY=no],
    [INSTALL_STATIC_LIBRARY=yes]))</pre>

<p>AC_SUBST(INSTALL_STATIC_LIBRARY)</p>

<p>AS_IF([test “$rb_with_pthread” = “yes”], [</p>

<pre class="ruby"><span class="ruby-constant">THREAD_MODEL</span>=<span class="ruby-identifier">pthread</span>
</pre>

<p>]) AC_CACHE_CHECK([for prefix of external symbols], rb_cv_symbol_prefix, [</p>

<pre>AC_TRY_COMPILE([extern void conftest_external(void) {}], [], [
    rb_cv_symbol_prefix=`$NM conftest.$ac_objext |
                         sed -n [&#39;/.*T[     ]\([^   ]*\)conftest_external.*/!d;s//\1/p;q&#39;]`
    ],
    [rb_cv_symbol_prefix=&#39;&#39;])
test -n &quot;$rb_cv_symbol_prefix&quot; || rb_cv_symbol_prefix=NONE</pre>

<p>]) SYMBOL_PREFIX=“$rb_cv_symbol_prefix” test “x$SYMBOL_PREFIX” = xNONE
&amp;&amp; SYMBOL_PREFIX=&#39;&#39; DLNOBJ=dln.o AC_ARG_ENABLE(dln,</p>

<pre>AC_HELP_STRING([--disable-dln], [disable dynamic link feature]),
[test &quot;$enableval&quot; = yes || DLNOBJ=dmydln.o])</pre>

<p>AC_SUBST(DLNOBJ) MINIDLNOBJ=dmydln.o</p>

<p><a href=""$target_os"">AS_CASE(</a>,</p>

<pre>[linux*], [
    ],
[netbsd*], [
    RUBY_APPEND_OPTION(CFLAGS, -pipe)
    ],
[darwin*], [
    RUBY_APPEND_OPTION(CFLAGS, -pipe)
    AC_COMPILE_IFELSE([
        AC_LANG_BOOL_COMPILE_TRY([@%:@include &lt;AvailabilityMacros.h&gt;],
            [MAC_OS_X_VERSION_MIN_REQUIRED &gt;= MAC_OS_X_VERSION_10_7])],
        [dnl
            RUBY_APPEND_OPTION(XLDFLAGS, [-framework Security])
            RUBY_APPEND_OPTION(LIBRUBYARG_STATIC, [-framework Security])
        ]dnl
    )
    RUBY_APPEND_OPTION(XLDFLAGS, [-framework Foundation])
    RUBY_APPEND_OPTION(LIBRUBYARG_STATIC, [-framework Foundation])
    ],
[osf*], [
    AS_IF([test &quot;$GCC&quot; != &quot;yes&quot; ], [
      # compile something small: taint.c is fine for this.
      # the main point is the &#39;-v&#39; flag of &#39;cc&#39;.
      AS_CASE([&quot;`cc -v -I. -c main.c -o /tmp/main.o 2&gt;&amp;1`&quot;],
      [*/gemc_cc*], [   # we have the new DEC GEM CC
                    CFLAGS=&quot;$CFLAGS -oldc&quot;
                    ],
      [            # we have the old MIPS CC
                    ])
      # cleanup
      rm -f /tmp/main.o
      CFLAGS=&quot;$CFLAGS -std&quot;
    ])
    ],
[cygwin*|mingw*], [
    LIBRUBY_DLDFLAGS=&quot;${LIBRUBY_DLDFLAGS}&quot;&#39; -Wl,--out-implib=$(LIBRUBY)&#39;
    AS_CASE([&quot;$target_os&quot;],
    [cygwin*], [
        AS_IF([test x&quot;$enable_shared&quot; = xyes], [
            LIBRUBY_SO=&#39;cyg$(RUBY_SO_NAME)&#39;.dll
            LIBRUBY_DLDFLAGS=&quot;${LIBRUBY_DLDFLAGS}&quot;&#39; $(RUBYDEF)&#39;
        ])
        ],
    [mingw*], [
        AS_IF([test x&quot;$enable_shared&quot; = xyes], [
            LIBRUBY_SO=&#39;$(RUBY_SO_NAME)&#39;.dll
            LIBRUBY_DLDFLAGS=&quot;${LIBRUBY_DLDFLAGS}&quot;&#39; $(RUBYDEF)&#39;
        ])
        EXPORT_PREFIX=&#39; &#39;
        DLDFLAGS=&quot;${DLDFLAGS}&quot;&#39; $(DEFFILE)&#39;
        AC_LIBOBJ([win32/win32])
        AC_LIBOBJ([win32/file])
        COMMON_LIBS=m</pre>

<p>#           COMMON_MACROS=“WIN32_LEAN_AND_MEAN=”</p>

<pre>        COMMON_HEADERS=&quot;winsock2.h windows.h&quot;
        THREAD_MODEL=win32
        PLATFORM_DIR=win32
        ])
    LIBRUBY_ALIASES=&#39;&#39;
    FIRSTMAKEFILE=GNUmakefile:cygwin/GNUmakefile.in
    AS_IF([test x&quot;$enable_shared&quot; = xyes], [
        LIBRUBY=&#39;lib$(RUBY_SO_NAME).dll.a&#39;
    ], [
        LIBRUBY_SO=dummy
        LIBRUBY=&#39;lib$(RUBY_SO_NAME).a&#39;
        LIBRUBYARG=&#39;-l$(RUBY_SO_NAME)&#39;
    ])
    ],
[hpux*], [
    AS_CASE([&quot;$YACC&quot;],[*yacc*], [
        XCFLAGS=&quot;$XCFLAGS -DYYMAXDEPTH=300&quot;
        YACC=&quot;$YACC -Nl40000 -Nm40000&quot;
    ])</pre>

<p>])</p>

<p>MINIOBJS=“$MINIDLNOBJ”</p>

<p><a href=""$THREAD_MODEL"">AS_CASE(</a>, [pthread],
[AC_CHECK_HEADERS(pthread.h)], [win32],   [], [“”],     
[AC_MSG_ERROR(thread model is missing)],</p>

<pre>[AC_MSG_ERROR(unknown thread model $THREAD_MODEL)])</pre>

<p>AC_ARG_ENABLE(debug-env,</p>

<pre>AS_HELP_STRING([--enable-debug-env], [enable RUBY_DEBUG environment variable]),
[AC_SUBST(ENABLE_DEBUG_ENV, yes)])</pre>

<p><a href=""$FIRSTMAKEFILE"">AS_CASE(</a>, [<strong>GNUmakefile:</strong>],
[gnumake=yes], [</p>

<pre>AC_MSG_CHECKING([if ${MAKE-make} is GNU make])
mkdir conftest.dir
echo &quot;all:; @echo yes&quot; &gt; conftest.dir/GNUmakefile
echo &quot;all:; @echo no&quot; &gt; conftest.dir/Makefile
gnumake=`(cd conftest.dir; ${MAKE-make})`
rm -fr conftest.dir
AS_CASE([&quot;$gnumake&quot;],
[*yes*], [
    FIRSTMAKEFILE=GNUmakefile:template/GNUmakefile.in
    gnumake=yes],
[
    gnumake=no])
AC_MSG_RESULT($gnumake)</pre>

<p>]) AS_IF([test “$gnumake” = yes], [ NULLCMD=: ], [</p>

<pre>AC_MSG_CHECKING([for safe null command for ${MAKE-make}])
mkdir conftest.dir
NULLCMD=
for cmd in : true; do
    echo &#39;A=1&#39; &gt; conftest.dir/Makefile
    echo &#39;B=$(A:1=@&#39;$cmd&#39;)&#39; &gt;&gt; conftest.dir/Makefile
    echo &#39;all:; $B 1 2 3 4 5 6 7 8 9&#39; &gt;&gt; conftest.dir/Makefile
    AS_IF([(cd conftest.dir; ${MAKE-make} &gt;/dev/null 2&gt;/dev/null)], [
        NULLCMD=$cmd
        break
    ])
done
rm -fr conftest.dir
AS_IF([test -z &quot;$NULLCMD&quot;], [
    AC_MSG_ERROR(no candidate for safe null command)
])
AC_MSG_RESULT($NULLCMD)</pre>

<p>]) AC_SUBST(NULLCMD)</p>

<p>AS_IF([test “${universal_binary-no}” = yes ], [</p>

<pre>AC_CACHE_CHECK([for architecture macros], rb_cv_architecture_macros, [
mv confdefs.h confdefs1.h
: &gt; confdefs.h
AC_TRY_COMPILE([@%:@if defined __`echo ${universal_archnames} |
sed &#39;s/=[^ ]*//g;s/ /__ || defined __/g&#39;`__</pre>

<p>@%:@else @%:@error &gt;&gt;&gt;&gt;&gt;&gt;&lt;&lt;&lt;&lt;&lt;&lt;
@%:@endif], [], [</p>

<pre>rb_cv_architecture_macros=yes
mv -f confdefs1.h confdefs.h</pre>

<p>], [</p>

<pre>rb_cv_architecture_macros=no
archflagpat=`eval echo &#39;&quot;&#39;&quot;${ARCH_FLAG}&quot;&#39;&quot;&#39; | sed &#39;s/[[][|.*]]/\\&amp;/g&#39;`
new_cflags=`echo &quot;$CFLAGS&quot; | sed &quot;s|$archflagpat&quot;&#39;||&#39;`
for archs in ${universal_archnames}; do
    cpu=${archs@%:@*=}
    archs=${archs%=*}
    CFLAGS=&quot;$new_cflags -arch $archs&quot;
    archs=&quot;__${archs}__&quot;
    AC_MSG_CHECKING([for macro ${archs} on ${cpu}])
    AC_TRY_COMPILE([@%:@ifndef ${archs}</pre>

<p>@%:@error @%:@endif], [], [<a href="yes">AC_MSG_RESULT(</a>)], [<a
href="no">AC_MSG_RESULT(</a>)])</p>

<pre>done
mv -f confdefs1.h confdefs.h
AC_MSG_ERROR([failed])
])])
AC_CACHE_CHECK(whether __ARCHITECTURE__ is available, rb_cv_architecture_available,
    AC_TRY_COMPILE([@%:@include &lt;stdio.h&gt;
            const char arch[[]] = __ARCHITECTURE__;], [puts(arch);],
            [rb_cv_architecture_available=yes], [rb_cv_architecture_available=no]))</pre>

<p>])</p>

<p>: ${MJIT_LDSHARED=`echo “$LDSHARED” | sed
[&#39;s|$(LD)|&#39;“${LD}”&#39;|g;s|$(CC)|$(MJIT_CC)|g&#39;]`}</p>

<p>MAINLIBS=“$LIBS” LIBS=$ORIG_LIBS AS_IF([test -n “${LIBS}”], [</p>

<pre class="ruby"><span class="ruby-identifier">libspat</span>=<span class="ruby-value">%x`echo &quot;${LIBS}&quot; | sed &#39;s/[[][|.*$^]]/\\&amp;/g;s/^  */ /;s/^  *$/ /&#39;`</span>
<span class="ruby-constant">MAINFLAGS</span>=<span class="ruby-value">%x`echo &quot; $MAINLIBS &quot; | sed &quot;s|$libspat&quot;&#39;||;s/^ *//;s/ *$//&#39;`</span>
</pre>

<p>]) LIBRUBYARG_STATIC=“${LIBRUBYARG_STATIC} $(MAINLIBS)” CPPFLAGS=“$CPPFLAGS
”&#39;$(DEFS)&#39; test -z “$CPPFLAGS” || CPPFLAGS=“$CPPFLAGS ”;
CPPFLAGS=“$CPPFLAGS”&#39;${cppflags}&#39; AS_IF([test -n “${cflags+set}”],
[</p>

<pre class="ruby"><span class="ruby-identifier">cflagspat</span>=<span class="ruby-value">%x`eval echo &#39;&quot;&#39;&quot;${cflags}&quot;&#39;&quot;&#39; | sed &#39;s/[[][|.*]]/\\&amp;/g;s/^  */ /;s/^  *$/ /&#39;`</span>
<span class="ruby-constant">CFLAGS</span>=<span class="ruby-value">%x`echo &quot; $CFLAGS &quot; | sed &quot;s|$cflagspat&quot;&#39;|${cflags}|;s/^ *//;s/ *$//&#39;`</span>
</pre>

<p>]) AS_IF([test -n “${cxxflags+set}”], [</p>

<pre class="ruby"><span class="ruby-identifier">cxxflagspat</span>=<span class="ruby-value">%x`eval echo &#39;&quot;&#39;&quot;${cxxflags}&quot;&#39;&quot;&#39; | sed &#39;s/[[][|.*]]/\\&amp;/g;s/^  */ /;s/^  *$/ /&#39;`</span>
<span class="ruby-constant">CXXFLAGS</span>=<span class="ruby-value">%x`echo &quot; $CXXFLAGS &quot; | sed &quot;s|$cxxflagspat&quot;&#39;|${cxxflags}|;s/^ *//;s/ *$//&#39;`</span>
</pre>

<p>]) AS_IF([test “${ARCH_FLAG}”], [</p>

<pre class="ruby"><span class="ruby-identifier">archflagpat</span>=<span class="ruby-value">%x`eval echo &#39;&quot;&#39;&quot;${ARCH_FLAG}&quot;&#39;&quot;&#39; | sed &#39;s/[[][|.*]]/\\&amp;/g&#39;`</span>
<span class="ruby-constant">CFLAGS</span>=<span class="ruby-value">%x`echo &quot;$CFLAGS&quot; | sed &quot;s| *$archflagpat&quot;&#39;||&#39;`</span>
<span class="ruby-constant">CXXFLAGS</span>=<span class="ruby-value">%x`echo &quot;$CXXFLAGS&quot; | sed &quot;s| *$archflagpat&quot;&#39;||&#39;`</span>
<span class="ruby-constant">LDFLAGS</span>=<span class="ruby-value">%x`echo &quot;$LDFLAGS&quot; | sed &quot;s| *$archflagpat&quot;&#39;||&#39;`</span>
</pre>

<p>]) rb_cv_warnflags=`echo “$rb_cv_warnflags” | sed &#39;s/^ *//;s/
*$//&#39;` warnflags=“$rb_cv_warnflags” AC_SUBST(cppflags)dnl
AC_SUBST(cflags, [“${orig_cflags:+$orig_cflags }”&#39;${optflags}
${debugflags} ${warnflags}&#39;])dnl AC_SUBST(cxxflags)dnl
AC_SUBST(optflags)dnl AC_SUBST(debugflags)dnl AC_SUBST(warnflags)dnl
AC_SUBST(strict_warnflags)dnl AC_SUBST(XCFLAGS)dnl AC_SUBST(XLDFLAGS)dnl
AC_SUBST(EXTLDFLAGS)dnl AC_SUBST(EXTDLDFLAGS)dnl AC_SUBST(LIBRUBY_LDSHARED)
AC_SUBST(LIBRUBY_DLDFLAGS) AC_SUBST(RUBY_INSTALL_NAME)
AC_SUBST(rubyw_install_name) AC_SUBST(RUBYW_INSTALL_NAME)
AC_SUBST(RUBY_SO_NAME) AC_SUBST(LIBRUBY_A) AC_SUBST(LIBRUBY_SO)
AC_SUBST(LIBRUBY_SONAME) AC_SUBST(LIBRUBY_ALIASES) AC_SUBST(LIBRUBY)
AC_SUBST(LIBRUBYARG) AC_SUBST(LIBRUBYARG_STATIC)
AC_SUBST(LIBRUBYARG_SHARED) AC_SUBST(SOLIBS) AC_SUBST(DLDLIBS)
AC_SUBST(DLDSHARED) AC_SUBST(ENABLE_SHARED) AC_SUBST(MAINLIBS)
AC_SUBST(COMMON_LIBS) AC_SUBST(COMMON_MACROS) AC_SUBST(COMMON_HEADERS)
AC_SUBST(EXPORT_PREFIX) AC_SUBST(SYMBOL_PREFIX) AC_SUBST(MINIOBJS)
AC_SUBST(THREAD_MODEL) AC_SUBST(PLATFORM_DIR)</p>

<p>firstmf=`echo $FIRSTMAKEFILE | sed &#39;s/:.*//&#39;` firsttmpl=`echo
$FIRSTMAKEFILE | sed &#39;s/.*://&#39;` MAKEFILES=“Makefile $firstmf”
MAKEFILES=“`echo $MAKEFILES`” AC_SUBST(MAKEFILES)</p>

<p>ri_prefix= test “$program_prefix” != NONE &amp;&amp;</p>

<pre class="ruby"><span class="ruby-identifier">ri_prefix</span>=<span class="ruby-identifier">$program_prefix</span>
</pre>

<p>ri_suffix= test “$program_suffix” != NONE &amp;&amp;</p>

<pre class="ruby"><span class="ruby-identifier">ri_suffix</span>=<span class="ruby-identifier">$program_suffix</span>
</pre>

<p>RUBY_INSTALL_NAME=“${ri_prefix}”&#39;$(RUBY_BASE_NAME)&#39;“${ri_suffix}”
<a href=""$target_os"">AS_CASE(</a>,</p>

<pre>[cygwin*|mingw*], [
  RUBYW_INSTALL_NAME=&quot;${ri_prefix}&quot;&#39;$(RUBYW_BASE_NAME)&#39;&quot;${ri_suffix}&quot;
  rubyw_install_name=&#39;$(RUBYW_INSTALL_NAME)&#39;
  ])</pre>

<p>rubylibdir=&#39;${rubylibprefix}/${ruby_version}&#39;
rubyarchdir=${multiarch+&#39;${rubyarchprefix}/${ruby_version}&#39;}${multiarch-&#39;${rubylibdir}/${arch}&#39;}</p>

<p>rubyarchprefix=${multiarch+&#39;${archlibdir}/${RUBY_BASE_NAME}&#39;}${multiarch-&#39;${rubylibprefix}/${arch}&#39;}
AC_ARG_WITH(rubyarchprefix,</p>

<pre>AS_HELP_STRING([--with-rubyarchprefix=DIR],
               [prefix for architecture dependent ruby libraries [[RUBYLIBPREFIX/ARCH]]]),
[rubyarchprefix=&quot;$withval&quot;])</pre>

<p>AC_SUBST(rubyarchprefix)</p>

<p>rubysitearchprefix=${multiarch+&#39;${sitearchlibdir}/${RUBY_BASE_NAME}&#39;}${multiarch-&#39;${rubylibprefix}/${sitearch}&#39;}
AC_ARG_WITH(rubysitearchprefix,</p>

<pre>AS_HELP_STRING([--with-rubysitearchprefix=DIR],
               [prefix for architecture dependent site libraries [[RUBYLIBPREFIX/SITEARCH]]]),
[rubysitearchprefix=&quot;$withval&quot;])</pre>

<p>AC_SUBST(rubysitearchprefix)</p>

<p>RI_BASE_NAME=`echo ${RUBY_BASE_NAME} | sed &#39;s/ruby/ri/&#39;`
ridir=&#39;${datarootdir}/${RI_BASE_NAME}&#39; AC_ARG_WITH(ridir,</p>

<pre>AS_HELP_STRING([--with-ridir=DIR], [ri documentation [[DATAROOTDIR/ri]]]),
[ridir=$withval])</pre>

<p>AC_SUBST(ridir) AC_SUBST(RI_BASE_NAME)</p>

<p>AC_ARG_WITH(ruby-version,</p>

<pre>AS_HELP_STRING([--with-ruby-version=STR], [ruby version string for version specific directories [[full]] (full|minor|STR)]),
[ruby_version=$withval],
[ruby_version=full])</pre>

<p>unset RUBY_LIB_VERSION unset RUBY_LIB_VERSION_STYLE <a
href=""$ruby_version"">AS_CASE(</a>,</p>

<pre>[full],  [RUBY_LIB_VERSION_STYLE=&#39;3   /* full */&#39;],
[minor], [RUBY_LIB_VERSION_STYLE=&#39;2   /* minor */&#39;])</pre>

<p>AS_IF([test ${RUBY_LIB_VERSION_STYLE+set}], [</p>

<pre>{
echo &quot;#define RUBY_LIB_VERSION_STYLE $RUBY_LIB_VERSION_STYLE&quot;
echo &#39;#define STRINGIZE(x) x&#39;
test -f revision.h -o -f &quot;${srcdir}/revision.h&quot; || echo &#39;#define RUBY_REVISION 0&#39;
echo &#39;#include &quot;version.h&quot;&#39;
echo &#39;ruby_version=RUBY_LIB_VERSION&#39;
} &gt; conftest.c
ruby_version=&quot;`$CPP -I. -I&quot;${srcdir}&quot; -I&quot;${srcdir}/include&quot; conftest.c | sed &#39;/^ruby_version=/!d;s/ //g&#39;`&quot;
eval $ruby_version</pre>

<p>], [test -z “${ruby_version}”], [</p>

<pre>AC_MSG_ERROR([No ruby version, No place for bundled libraries])</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">RUBY_LIB_VERSION</span>=<span class="ruby-string">&quot;${ruby_version}&quot;</span>
</pre>

<p>]) AC_SUBST(RUBY_LIB_VERSION_STYLE) AC_SUBST(RUBY_LIB_VERSION)</p>

<p>AC_ARG_WITH(sitedir,</p>

<pre>AS_HELP_STRING([--with-sitedir=DIR], [site libraries in DIR [[RUBY_LIB_PREFIX/site_ruby]], &quot;no&quot; to disable site directory]),
[sitedir=$withval],
[sitedir=&#39;${rubylibprefix}/site_ruby&#39;])</pre>

<p>sitelibdir=&#39;${sitedir}/${ruby_version}&#39;</p>

<p>AC_ARG_WITH(sitearchdir,</p>

<pre>AS_HELP_STRING([--with-sitearchdir=DIR],
               [architecture dependent site libraries in DIR [[SITEDIR/SITEARCH]], &quot;no&quot; to disable site directory]),
[sitearchdir=$withval],
[sitearchdir=${multiarch+&#39;${rubysitearchprefix}/site_ruby/${ruby_version}&#39;}${multiarch-&#39;${sitelibdir}/${sitearch}&#39;}])</pre>

<p>AC_ARG_WITH(vendordir,</p>

<pre>AS_HELP_STRING([--with-vendordir=DIR], [vendor libraries in DIR [[RUBY_LIB_PREFIX/vendor_ruby]], &quot;no&quot; to disable vendor directory]),
[vendordir=$withval],
[vendordir=&#39;${rubylibprefix}/vendor_ruby&#39;])</pre>

<p>vendorlibdir=&#39;${vendordir}/${ruby_version}&#39;</p>

<p>AC_ARG_WITH(vendorarchdir,</p>

<pre>AS_HELP_STRING([--with-vendorarchdir=DIR],
               [architecture dependent vendor libraries in DIR [[VENDORDIR/SITEARCH]], &quot;no&quot; to disable vendor directory]),
[vendorarchdir=$withval],
[vendorarchdir=${multiarch+&#39;${rubysitearchprefix}/vendor_ruby/${ruby_version}&#39;}${multiarch-&#39;${vendorlibdir}/${sitearch}&#39;}])</pre>

<p>AS_IF([test “${LOAD_RELATIVE+set}”], [</p>

<pre class="ruby"><span class="ruby-constant">AC_DEFINE_UNQUOTED</span>(<span class="ruby-constant">LOAD_RELATIVE</span>, <span class="ruby-identifier">$LOAD_RELATIVE</span>)
<span class="ruby-constant">RUBY_EXEC_PREFIX</span>=<span class="ruby-string">&#39;&#39;</span>
</pre>

<p>])</p>

<p>AC_SUBST(RUBY_EXEC_PREFIX)</p>

<p>AC_SUBST(libdirname, ${multiarch+arch}libdir) AC_SUBST(archlibdir)dnl
AC_SUBST(sitearchlibdir)dnl AC_SUBST(archincludedir)dnl
AC_SUBST(sitearchincludedir)dnl AC_SUBST(arch)dnl AC_SUBST(sitearch)dnl
AC_SUBST(ruby_version)dnl AC_SUBST(rubylibdir)dnl AC_SUBST(rubyarchdir)dnl
AC_SUBST(sitedir)dnl AC_SUBST(sitelibdir)dnl AC_SUBST(sitearchdir)dnl
AC_SUBST(vendordir)dnl AC_SUBST(vendorlibdir)dnl AC_SUBST(vendorarchdir)dnl</p>

<p>AC_SUBST(CONFIGURE, “`echo $0 | sed &#39;s|.*/||&#39;`”)dnl
AC_SUBST(configure_args, “`echo ”${ac_configure_args}“ | sed
&#39;s/\$/$$/g&#39;`”)dnl</p>

<p>AS_IF([test “${universal_binary-no}” = yes ], [</p>

<pre>arch=&quot;universal-${target_os}&quot;
AS_IF([test &quot;${rb_cv_architecture_available}&quot; = yes], [
    AC_DEFINE_UNQUOTED(RUBY_PLATFORM_CPU, __ARCHITECTURE__)
], [
    for archs in ${universal_archnames}; do
        cpu=`echo $archs | sed &#39;s/.*=//&#39;`
        archs=`echo $archs | sed &#39;s/=.*//&#39;`
        RUBY_DEFINE_IF([defined __${archs}__ &amp;&amp;! defined RUBY_PLATFORM_CPU], RUBY_PLATFORM_CPU, [&quot;${cpu}&quot;])
    done
])
ints=&#39;long int short&#39;
test &quot;$ac_cv_type_long_long&quot; = yes &amp;&amp; ints=&quot;&#39;long long&#39; $ints&quot;
AC_SUBST(UNIVERSAL_ARCHNAMES, &quot;${universal_archnames}&quot;)
AC_SUBST(UNIVERSAL_INTS, &quot;${ints}&quot;)
AC_DEFINE_UNQUOTED(RUBY_PLATFORM_OS, &quot;${target_os}&quot;)
AC_DEFINE_UNQUOTED(RUBY_ARCH, &quot;universal-&quot; RUBY_PLATFORM_OS)
AC_DEFINE_UNQUOTED(RUBY_PLATFORM, &quot;universal.&quot; RUBY_PLATFORM_CPU &quot;-&quot; RUBY_PLATFORM_OS)</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-identifier">arch</span>=<span class="ruby-string">&quot;${target_cpu}-${target_os}&quot;</span>
<span class="ruby-constant">AC_DEFINE_UNQUOTED</span>(<span class="ruby-constant">RUBY_PLATFORM</span>, <span class="ruby-string">&quot;$arch&quot;</span>)
</pre>

<p>])</p>

<p>unset sitearch <a href=""$target_os"">AS_CASE(</a>,[<a
href="sitearch="$target_cpu-$rb_cv_msvcrt"">mingw*],</a>) :
${sitearch=&#39;${arch}&#39;}</p>

<p>AC_ARG_WITH(search-path,</p>

<pre>AS_HELP_STRING([--with-search-path=DIR], [specify the additional search path]),
[search_path=$withval])</pre>

<p>AS_IF([test “$search_path” != “”], [</p>

<pre class="ruby"><span class="ruby-constant">AC_SUBST</span>(<span class="ruby-constant">RUBY_SEARCH_PATH</span>, <span class="ruby-identifier">$search_path</span>)
</pre>

<p>])</p>

<p>AC_ARG_WITH(rubyhdrdir,</p>

<pre>AS_HELP_STRING([--with-rubyhdrdir=DIR], [core headers in DIR [[INCLUDEDIR/RUBY_BASE_NAME-RUBY_VERSION]]]),
[rubyhdrdir=$withval],
[rubyhdrdir=&#39;${includedir}/${RUBY_VERSION_NAME}&#39;])</pre>

<p>AC_ARG_WITH(rubyarchhdrdir,</p>

<pre>AS_HELP_STRING([--with-rubyarchhdrdir=DIR],
               [architecture dependent core headers in DIR [[$(rubyhdrdir)/$(arch)]]]),
[rubyarchhdrdir=$withval],
[rubyarchhdrdir=${multiarch+&#39;${archincludedir}/${RUBY_VERSION_NAME}&#39;}${multiarch-&#39;${rubyhdrdir}/${arch}&#39;}])</pre>

<p>AC_ARG_WITH(sitehdrdir,</p>

<pre>AS_HELP_STRING([--with-sitehdrdir=DIR], [core site headers in DIR [[RUBYHDRDIR/site_ruby]]]),
[sitehdrdir=$withval],
[sitehdrdir=&#39;${rubyhdrdir}/site_ruby&#39;])</pre>

<p>AC_ARG_WITH(sitearchhdrdir,</p>

<pre>AS_HELP_STRING([--with-sitearchhdrdir=DIR],
               [architecture dependent core site headers in DIR [[RUBYHDRDIR/site_ruby]]]),
[sitearchhdrdir=$withval],
[sitearchhdrdir=${multiarch+&#39;${sitearchincludedir}/${RUBY_VERSION_NAME}/site_ruby&#39;}${multiarch-&#39;${sitehdrdir}/${sitearch}&#39;}])</pre>

<p>AC_ARG_WITH(vendorhdrdir,</p>

<pre>AS_HELP_STRING([--with-vendorhdrdir=DIR], [core vendor headers in DIR [[RUBYHDRDIR/vendor_ruby]]]),
[vendorhdrdir=$withval],
[vendorhdrdir=&#39;${rubyhdrdir}/vendor_ruby&#39;])</pre>

<p>AC_ARG_WITH(vendorarchhdrdir,</p>

<pre>AS_HELP_STRING([--with-vendorarchhdrdir=DIR],
               [architecture dependent core vendor headers in DIR [[RUBYHDRDIR/vendor_ruby]]]),
[vendorarchhdrdir=$withval],
[vendorarchhdrdir=${multiarch+&#39;${sitearchincludedir}/${RUBY_VERSION_NAME}/vendor_ruby&#39;}${multiarch-&#39;${vendorhdrdir}/${sitearch}&#39;}])</pre>

<p>AC_SUBST(rubyhdrdir)dnl AC_SUBST(sitehdrdir)dnl AC_SUBST(vendorhdrdir)dnl
AC_SUBST(rubyarchhdrdir)dnl AC_SUBST(sitearchhdrdir)dnl
AC_SUBST(vendorarchhdrdir)dnl</p>

<p>AC_ARG_WITH(mantype,</p>

<pre>AS_HELP_STRING([--with-mantype=TYPE], [specify man page type; TYPE is one of man and doc]),
        [
                AS_CASE([&quot;$withval&quot;],
                [man|man.gz|man.bz2|doc|doc.gz|doc.bz2], [MANTYPE=$withval],
                [AC_MSG_ERROR(invalid man type: $withval)])
        ])</pre>

<p>AS_IF([test -z “$MANTYPE”], [</p>

<pre>dnl Looks for nroff with -mdoc support.
AC_CACHE_VAL([ac_cv_path_NROFF], [
        AC_PATH_PROGS_FEATURE_CHECK([NROFF],
                [nroff awf mandoc],
                [$ac_path_NROFF -mdoc ${srcdir}/man/ruby.1 \
                        &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
                        ac_cv_path_NROFF=$ac_path_NROFF \
                        ac_path_NROFF_found=:],
                [], [&quot;/usr/bin:/usr/ucb&quot;]
        )
])
AS_IF([test -n &quot;$ac_cv_path_NROFF&quot;], [
        MANTYPE=doc
], [
        MANTYPE=man
])</pre>

<p>]) AC_SUBST(MANTYPE)</p>

<p>AC_ARG_ENABLE(rubygems,</p>

<pre>AS_HELP_STRING([--disable-rubygems], [disable rubygems by default]),
[enable_rubygems=&quot;$enableval&quot;], [enable_rubygems=yes])</pre>

<p>AS_IF([test x“$enable_rubygems” = xno], [</p>

<pre class="ruby"><span class="ruby-constant">USE_RUBYGEMS</span>=<span class="ruby-identifier">no</span>
</pre>

<p>], [</p>

<pre class="ruby"><span class="ruby-constant">USE_RUBYGEMS</span>=<span class="ruby-identifier">yes</span>
</pre>

<p>]) AC_SUBST(USE_RUBYGEMS)</p>

<p>arch_hdrdir=“${EXTOUT}/include/${arch}/ruby” AS_MKDIR_P(“${arch_hdrdir}”)
config_h=“${arch_hdrdir}/config.h” guard=INCLUDE_RUBY_CONFIG_H {</p>

<pre>echo &quot;#ifndef $guard&quot;
echo &quot;#define $guard 1&quot;
grep -v &quot;^#define PACKAGE_&quot; confdefs.h
echo &quot;#endif /* $guard */&quot;</pre>

<p>} | tr -d &#39;015&#39; | (</p>

<pre>AS_IF([test &quot;x$CONFIGURE_TTY&quot; = xyes], [color=--color], [color=])
exec ${srcdir}/tool/ifchange $color &quot;${config_h}&quot; -</pre>

<p>) &gt;&amp;AS_MESSAGE_FD || AC_MSG_ERROR([failed to create ${config_h}]) tr
-d &#39;015&#39; &lt; largefile.h &gt; confdefs.h rm largefile.h</p>

<p>BUILTIN_ENCS=[“`sed -n -e &#39;/^BUILTIN_ENCS[      ]*=/{&#39; \</p>

<pre>-e s/// -e :l -e &#39;/\\\\$/N&#39; -e &#39;s/\\\\\\n/ /&#39; -e &#39;t l&#39; -e p \
-e &#39;}&#39; &quot;${srcdir}/enc/Makefile.in&quot;`&quot;]</pre>

<p>BUILTIN_ENCOBJS= for e in $BUILTIN_ENCS; do
BUILTIN_ENCOBJS=“$BUILTIN_ENCOBJS ”`echo $e | sed
&#39;s/.c$/.$(OBJEXT)/&#39;`; done AC_SUBST(BUILTIN_ENCOBJS)</p>

<p>BUILTIN_TRANSES=[“`sed -n -e &#39;/^BUILTIN_TRANSES[        ]*=/{&#39; \</p>

<pre>-e s/// -e :l -e &#39;/\\\\$/N&#39; -e &#39;s/\\\\\\n/ /&#39; -e &#39;t l&#39; -e p \
-e &#39;}&#39; &quot;${srcdir}/enc/Makefile.in&quot;`&quot;]</pre>

<p>BUILTIN_TRANSSRCS= BUILTIN_TRANSOBJS= for e in $BUILTIN_TRANSES; do</p>

<pre>BUILTIN_TRANSSRCS=&quot;$BUILTIN_TRANSSRCS &quot;`echo $e | sed &#39;s/\.trans$/.c/&#39;`
BUILTIN_TRANSOBJS=&quot;$BUILTIN_TRANSOBJS &quot;`echo $e | sed &#39;s/\.trans$/.$(OBJEXT)/&#39;`</pre>

<p>done AC_SUBST(BUILTIN_TRANSSRCS) AC_SUBST(BUILTIN_TRANSOBJS)</p>

<p>PACKAGE=$RUBY_BASE_NAME AC_SUBST(PACKAGE) AS_MESSAGE([$PACKAGE library
version = $ruby_version])</p>

<p>AS_IF([test x“$CC_WRAPPER” != x], [</p>

<pre class="ruby"><span class="ruby-constant">CC</span>=<span class="ruby-string">&#39;$(CC_WRAPPER) &#39;</span><span class="ruby-string">&quot;${CC@%:@$CC_WRAPPER }&quot;</span>
<span class="ruby-constant">CPP</span>=<span class="ruby-string">&#39;$(CC_WRAPPER) &#39;</span><span class="ruby-string">&quot;${CPP@%:@$CC_WRAPPER }&quot;</span>
<span class="ruby-constant">CC_WRAPPER</span>=<span class="ruby-string">&#39;$(rubyarchdir)/darwin-cc&#39;</span>
<span class="ruby-constant">XCC_WRAPPER</span>=<span class="ruby-string">&#39;$(top_srcdir)/tool/darwin-cc&#39;</span>
</pre>

<p>]) AC_SUBST(CC_WRAPPER, &#39;&#39;) AC_SUBST(XCC_WRAPPER)</p>

<p>AS_CASE([“ $CPP ”], [*“ $CC ”*], [CPP=`echo “ $CPP ” | sed “s| $CC |”&#39;
$(CC) |;s/^ *//;s/  *$//&#39;`])</p>

<p>AS_IF([test x“$firstmf” != x], [</p>

<pre>AC_CONFIG_FILES($firstmf:$firsttmpl, [], [firstmf=&quot;$firstmf&quot; firsttmpl=&quot;$firsttmpl&quot;])</pre>

<p>]) AC_CONFIG_FILES(Makefile:template/Makefile.in, [</p>

<pre>tmpmk=confmk$$.tmp
{
    AS_IF([test ${VCS+set}], [
        :
    ], [git_dir=`$GIT --work-tree=&quot;$srcdir&quot; --git-dir=&quot;$srcdir/.git&quot; rev-parse --git-dir 2&gt;/dev/null`], [
        VCS=&#39;$(GIT)&#39;
    ], [
        VCS=&#39;echo cannot&#39;
    ])
    AS_CASE(&quot;$VCS&quot;,
            [&#39;$(GIT)&#39;|git], [VCSUP=&#39;$(VCS) pull $(GITPULLOPTIONS)&#39;],
            [VCSUP=&#39;$(VCS)&#39;])
    sed -n \
        -e &#39;[/^@%:@define \(RUBY_RELEASE_[A-Z]*\) \([0-9][0-9]*\)/]{&#39; \
        -e   &#39;s//\1 = \2/&#39; \
        -e   &#39;[s/ \([0-9]\)$/ 0\1/]&#39; \
        -e   p \
        -e &#39;}&#39; &quot;$srcdir/version.h&quot;
    sed &#39;/^MISSING/s/\$U\././g;/^VCS *=/s#@VCS@#&#39;&quot;$VCS&quot;&#39;#;/^VCSUP *=/s#@VCSUP@#&#39;&quot;$VCSUP&quot;&#39;#&#39; Makefile
    echo; test x&quot;$EXEEXT&quot; = x || echo &#39;miniruby: miniruby$(EXEEXT)&#39;
    AS_IF([test &quot;$gnumake&quot; != yes], [
        echo [&#39;$(MKFILES): $(srcdir)/common.mk&#39;]
        sed [&#39;s/{\$([^(){}]*)[^{}]*}//g&#39;] ${srcdir}/common.mk
    ], [
        echo &#39;distclean-local::; @$(RM) GNUmakefile uncommon.mk&#39;
    ])
} &gt; $tmpmk &amp;&amp; AS_IF([! grep &#39;^ruby:&#39; $tmpmk &gt; /dev/null], [
    AS_IF([test &quot;${gnumake}&quot; = yes], [
        tmpgmk=confgmk$$.tmp
        {
            echo &quot;include $tmpmk&quot;
            echo &quot;-include uncommon.mk&quot;
        } &gt; $tmpgmk
    ], [
        tmpgmk=$tmpmk
    ]) &amp;&amp;
    test -z &quot;`${MAKE-make} -f $tmpgmk info-program | grep &#39;^PROGRAM=ruby$&#39;`&quot; &amp;&amp;
    echo &#39;ruby: $(PROGRAM);&#39; &gt;&gt; $tmpmk
    test &quot;$tmpmk&quot; = &quot;$tmpgmk&quot; || rm -f &quot;$tmpgmk&quot;
]) &amp;&amp; mv -f $tmpmk Makefile],</pre>

<p>[EXEEXT=&#39;$EXEEXT&#39; gnumake=&#39;$gnumake&#39; GIT=&#39;$GIT&#39;])</p>

<p><a href="ruby-pc">AC_ARG_WITH(</a>,</p>

<pre>AC_HELP_STRING([--with-ruby-pc=FILENAME], [pc file basename]),
[ruby_pc=&quot;$withval&quot;],
[ruby_pc=&quot;${RUBY_BASE_NAME}-${MAJOR}.${MINOR}.pc&quot;])</pre>

<p>AC_SUBST(ruby_pc) AC_SUBST(exec, [exec])</p>

<p>AC_ARG_WITH(destdir,</p>

<pre>AS_HELP_STRING([--with-destdir=DESTDIR], [specify default directory to install]),
[DESTDIR=&quot;$withval&quot;])</pre>

<p>AC_SUBST(DESTDIR)</p>

<p>AC_CONFIG_FILES($ruby_pc:template/ruby.pc.in,</p>

<pre>[
AS_IF([sed [&#39;s/\$(\([A-Za-z_][A-Za-z0-9_]*\))/${\1}/g;s/@[A-Za-z_][A-Za-z0-9_]*@//&#39;] $ruby_pc &gt; ruby.tmp.pc &amp;&amp;
    {
        test -z &quot;$PKG_CONFIG&quot; ||
        PKG_CONFIG_PATH=. $PKG_CONFIG --print-errors ruby.tmp
    }],
[
    mv -f ruby.tmp.pc $ruby_pc
], [
    exit 1
])
],
[ruby_pc=&#39;$ruby_pc&#39; PKG_CONFIG=&#39;$PKG_CONFIG&#39;])</pre>

<p>AC_OUTPUT } }</p>

<p>AS_IF([test “$silent” = yes], [], [ AS_IF([${FOLD+:} false], [], [
AS_IF([test “`echo abcdefg hijklmno | fold -s -w10 | sed 1d`” = hijklmno],
[FOLD=“fold”], [FOLD=]) ]) fold_width=`expr $COLUMNS - 30 2&gt;/dev/null`
|| fold_width=50 <a href="config_summary">AS_REQUIRE_SHELL_FN(</a>,</p>

<pre>[AS_FUNCTION_DESCRIBE([config_summary], [NAME, VAL], [configuration summary])],
[AS_IF([test -z &quot;$2&quot;], [], [
    AS_ECHO_N([&quot;   * $1:                     &quot;]) | dd bs=1 count=26 2&gt;/dev/null
    AS_IF([test &quot;$FOLD&quot;], [
        echo &quot;$2&quot; | fold -s -w$fold_width |
        sed &#39;1!s/^/                          /;$!s/$/\\/&#39;
    ], [echo &quot;$2&quot;])
])]</pre>

<p>)</p>

<p>AS_IF([test $install_doc = yes],</p>

<pre>[DOCTARGETS=`echo &quot; $RDOCTARGET $CAPITARGET &quot; | sed &#39;s/ nodoc //g;s/^ *//;s/ *$//&#39;`],
[DOCTARGETS=no])</pre>

<p>echo “—” echo “Configuration summary for $RUBY_BASE_NAME version
$MAJOR.$MINOR.$TEENY” echo “” config_summary “Installation prefix”
“$prefix” config_summary “exec prefix”         “$exec_prefix”
config_summary “arch”                “$arch” config_summary “site arch”    
“$sitearch” config_summary “RUBY_BASE_NAME”      “$RUBY_BASE_NAME”
config_summary “enable shared”       “$enable_shared” config_summary “ruby
lib prefix”     “$rubylibprefix” config_summary “site libraries path”
“$rubysitearchprefix” config_summary “vendor path”         “$vendordir”
config_summary “target OS”           “$target_os” config_summary “compiler”
“$CC” config_summary “with pthread”        “$enable_pthread” config_summary
“with coroutine”      “$rb_cv_coroutine” config_summary “enable shared
libs”  “$ENABLE_SHARED” config_summary “dynamic library ext” “$DLEXT”
config_summary “CFLAGS”              “$cflags” config_summary “CPPFLAGS”   
“$cppflags” config_summary “LDFLAGS”             “$LDFLAGS” config_summary
“DLDFLAGS”            “$DLDFLAGS” config_summary “optflags”           
“$optflags” config_summary “debugflags”          “$debugflags”
config_summary “warnflags”           “$warnflags” config_summary “strip
command”       “$STRIP” config_summary “install doc”         “$DOCTARGETS”
config_summary “JIT support”         “$MJIT_SUPPORT” config_summary “man
page type”       “$MANTYPE” config_summary “search path”        
“$search_path” config_summary “static-linked-ext”   ${EXTSTATIC:+“yes”}
config_summary “BASERUBY -v”         “$BASERUBY_VERSION” echo “” echo “—”
])</p>

	</div>


                <div id="footer">
                
                <p><a href="http://ruby-doc.org">Ruby-doc.org</a> is a service of <a href="http://jamesbritt.com">James Britt</a> and <a href="http://neurogami.com">Neurogami</a>, an erratic source of art, music, and technology.  <div class='oio-inline'><ins data-revive-zoneid="1" data-revive-id="58924a5717c091dfee6dda3f7d38c4d7"></ins><script async src="//ras.ruby-doc.org/vvv/delivery/thesinkjs.php"></script></div></p>

                
                <p id="validator-badges"><small>Generated with Rubydoc Rdoc Generator 0.42.0</small>.</p>
              </div>


    


</body>

</html>

